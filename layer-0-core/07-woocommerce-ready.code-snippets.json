{"generator":"Code Snippets v3.7.0","date_created":"2025-09-15 14:39","snippets":[{"id":83,"name":"07-WooCommerce-Ready","code":"\/**\n * ============================================================================\n * Snippet: 07-WooCommerce-Ready\n * Title: WooCommerce \u6574\u5408\u6e96\u5099\n * Description: \u5efa\u7acb WooCommerce \u6574\u5408\u57fa\u790e\uff0c\u865b\u64ec\u7522\u54c1\u6a4b\u63a5\uff0c\u8cfc\u7269\u8eca\u8655\u7406\n * Version: 1.0.0\n * Author: 9o Van Development Team\n * Created: 2025-09-13\n * Modified: 2025-09-13\n * Priority: 8\n * Dependencies: 00-Global-Constants\n * Hook: Run everywhere\n * ============================================================================\n *\/\n\n\/\/ \u9632\u6b62\u76f4\u63a5\u8a2a\u554f\nif (!defined('ABSPATH')) {\n    exit;\n}\n\n\/**\n * WooCommerce \u6574\u5408\u985e\u5225\n *\/\nclass NineOVan_WooCommerce_Integration {\n    \n    private static $instance = null;\n    private $product_id_airport = null;\n    private $product_id_charter = null;\n    \n    \/**\n     * \u53d6\u5f97\u55ae\u4f8b\u5be6\u4f8b\n     *\/\n    public static function get_instance() {\n        if (null === self::$instance) {\n            self::$instance = new self();\n        }\n        return self::$instance;\n    }\n    \n    \/**\n     * \u5efa\u69cb\u51fd\u5f0f\n     *\/\n    private function __construct() {\n        \/\/ \u6aa2\u67e5 WooCommerce \u662f\u5426\u555f\u7528\n        if (!$this->is_woocommerce_active()) {\n            add_action('admin_notices', array($this, 'woocommerce_missing_notice'));\n            return;\n        }\n        \n        \/\/ \u521d\u59cb\u5316\n        add_action('init', array($this, 'init'));\n        add_action('woocommerce_init', array($this, 'woocommerce_init'));\n        \n        \/\/ \u7522\u54c1\u8a2d\u5b9a\n        add_action('init', array($this, 'create_virtual_products'));\n        \n        \/\/ \u8cfc\u7269\u8eca\u6574\u5408\n        add_filter('woocommerce_add_cart_item_data', array($this, 'add_booking_data_to_cart'), 10, 3);\n        add_filter('woocommerce_get_item_data', array($this, 'display_booking_data_in_cart'), 10, 2);\n        add_action('woocommerce_checkout_create_order_line_item', array($this, 'save_booking_data_to_order'), 10, 4);\n        \n        \/\/ \u50f9\u683c\u8abf\u6574\n        add_action('woocommerce_before_calculate_totals', array($this, 'adjust_cart_item_price'));\n        \n        \/\/ \u7d50\u5e33\u6b04\u4f4d\n        add_filter('woocommerce_checkout_fields', array($this, 'customize_checkout_fields'));\n        add_action('woocommerce_checkout_update_order_meta', array($this, 'save_checkout_fields'));\n        \n        \/\/ \u8a02\u55ae\u8655\u7406\n        add_action('woocommerce_order_status_completed', array($this, 'handle_order_completed'));\n        add_action('woocommerce_order_status_processing', array($this, 'handle_order_processing'));\n        add_action('woocommerce_order_status_cancelled', array($this, 'handle_order_cancelled'));\n        add_action('woocommerce_order_status_refunded', array($this, 'handle_order_refunded'));\n        \n        \/\/ \u7ba1\u7406\u54e1\u8a02\u55ae\u9801\u9762\n        add_action('woocommerce_admin_order_data_after_order_details', array($this, 'display_booking_info_in_order'));\n        \n        \/\/ AJAX \u8655\u7406\n        add_action('wp_ajax_9o_van_add_to_cart', array($this, 'ajax_add_to_cart'));\n        add_action('wp_ajax_nopriv_9o_van_add_to_cart', array($this, 'ajax_add_to_cart'));\n    }\n    \n    \/**\n     * \u6aa2\u67e5 WooCommerce \u662f\u5426\u555f\u7528\n     *\/\n    private function is_woocommerce_active() {\n        return class_exists('WooCommerce');\n    }\n    \n    \/**\n     * WooCommerce \u672a\u5b89\u88dd\u901a\u77e5\n     *\/\n    public function woocommerce_missing_notice() {\n        ?>\n        <div class=\"notice notice-warning\">\n            <p><strong>9o Van Strip:<\/strong> WooCommerce \u5c1a\u672a\u555f\u7528\u3002\u8acb\u5b89\u88dd\u4e26\u555f\u7528 WooCommerce \u4ee5\u4f7f\u7528\u5b8c\u6574\u529f\u80fd\u3002<\/p>\n        <\/div>\n        <?php\n    }\n    \n    \/**\n     * \u521d\u59cb\u5316\n     *\/\n    public function init() {\n        \/\/ \u53d6\u5f97\u865b\u64ec\u7522\u54c1 ID\n        $this->product_id_airport = get_option('9o_van_product_airport');\n        $this->product_id_charter = get_option('9o_van_product_charter');\n    }\n    \n    \/**\n     * WooCommerce \u521d\u59cb\u5316\n     *\/\n    public function woocommerce_init() {\n        \/\/ \u8a3b\u518a\u81ea\u8a02\u8a02\u55ae\u72c0\u614b\n        $this->register_custom_order_statuses();\n        \n        \/\/ \u65b0\u589e\u8a02\u55ae\u52d5\u4f5c\n        $this->add_order_actions();\n    }\n    \n    \/**\n     * \u5efa\u7acb\u865b\u64ec\u7522\u54c1\n     *\/\n    public function create_virtual_products() {\n        \/\/ \u6aa2\u67e5\u662f\u5426\u9700\u8981\u5efa\u7acb\u7522\u54c1\n        if (!$this->product_id_airport || !wc_get_product($this->product_id_airport)) {\n            $this->product_id_airport = $this->create_virtual_product('\u6a5f\u5834\u63a5\u9001\u670d\u52d9', 'airport');\n            update_option('9o_van_product_airport', $this->product_id_airport);\n        }\n        \n        if (!$this->product_id_charter || !wc_get_product($this->product_id_charter)) {\n            $this->product_id_charter = $this->create_virtual_product('\u5305\u8eca\u65c5\u904a\u670d\u52d9', 'charter');\n            update_option('9o_van_product_charter', $this->product_id_charter);\n        }\n    }\n    \n    \/**\n     * \u5efa\u7acb\u55ae\u4e00\u865b\u64ec\u7522\u54c1\n     *\/\n    private function create_virtual_product($name, $type) {\n        $product = new WC_Product_Simple();\n        $product->set_name($name);\n        $product->set_slug('9o-van-' . $type);\n        $product->set_regular_price(0); \/\/ \u52d5\u614b\u50f9\u683c\n        $product->set_price(0);\n        $product->set_virtual(true);\n        $product->set_sold_individually(true);\n        $product->set_manage_stock(false);\n        $product->set_stock_status('instock');\n        $product->set_catalog_visibility('hidden');\n        $product->set_description('9o Van Strip ' . $name);\n        \n        \/\/ \u8a2d\u5b9a\u5206\u985e\n        $cat_id = $this->get_or_create_product_category();\n        if ($cat_id) {\n            $product->set_category_ids(array($cat_id));\n        }\n        \n        $product->save();\n        \n        return $product->get_id();\n    }\n    \n    \/**\n     * \u53d6\u5f97\u6216\u5efa\u7acb\u7522\u54c1\u5206\u985e\n     *\/\n    private function get_or_create_product_category() {\n        $term = term_exists('9o-van-services', 'product_cat');\n        \n        if (!$term) {\n            $term = wp_insert_term(\n                '9o Van \u670d\u52d9',\n                'product_cat',\n                array(\n                    'description' => '9o Van Strip \u9810\u7d04\u670d\u52d9',\n                    'slug' => '9o-van-services'\n                )\n            );\n        }\n        \n        return is_array($term) ? $term['term_id'] : $term;\n    }\n    \n    \/**\n     * \u8a3b\u518a\u81ea\u8a02\u8a02\u55ae\u72c0\u614b\n     *\/\n    private function register_custom_order_statuses() {\n        \/\/ \u53f8\u6a5f\u5df2\u6d3e\u55ae\n        register_post_status('wc-driver-assigned', array(\n            'label' => '\u53f8\u6a5f\u5df2\u6d3e\u55ae',\n            'public' => true,\n            'show_in_admin_status_list' => true,\n            'show_in_admin_all_list' => true,\n            'exclude_from_search' => false,\n            'label_count' => _n_noop('\u53f8\u6a5f\u5df2\u6d3e\u55ae <span class=\"count\">(%s)<\/span>', '\u53f8\u6a5f\u5df2\u6d3e\u55ae <span class=\"count\">(%s)<\/span>')\n        ));\n        \n        \/\/ \u670d\u52d9\u9032\u884c\u4e2d\n        register_post_status('wc-in-service', array(\n            'label' => '\u670d\u52d9\u9032\u884c\u4e2d',\n            'public' => true,\n            'show_in_admin_status_list' => true,\n            'show_in_admin_all_list' => true,\n            'exclude_from_search' => false,\n            'label_count' => _n_noop('\u670d\u52d9\u9032\u884c\u4e2d <span class=\"count\">(%s)<\/span>', '\u670d\u52d9\u9032\u884c\u4e2d <span class=\"count\">(%s)<\/span>')\n        ));\n        \n        \/\/ \u52a0\u5165\u5230\u8a02\u55ae\u72c0\u614b\u5217\u8868\n        add_filter('wc_order_statuses', function($order_statuses) {\n            $order_statuses['wc-driver-assigned'] = '\u53f8\u6a5f\u5df2\u6d3e\u55ae';\n            $order_statuses['wc-in-service'] = '\u670d\u52d9\u9032\u884c\u4e2d';\n            return $order_statuses;\n        });\n    }\n    \n    \/**\n     * \u65b0\u589e\u8a02\u55ae\u52d5\u4f5c\n     *\/\n    private function add_order_actions() {\n        add_filter('woocommerce_admin_order_actions', array($this, 'add_custom_order_actions'), 10, 2);\n        add_action('admin_action_assign_driver', array($this, 'handle_assign_driver_action'));\n    }\n    \n    \/**\n     * \u52a0\u5165\u9810\u7d04\u8cc7\u6599\u5230\u8cfc\u7269\u8eca\n     *\/\n    public function add_booking_data_to_cart($cart_item_data, $product_id, $variation_id) {\n        if (isset($_POST['booking_data'])) {\n            $cart_item_data['9o_van_booking'] = json_decode(stripslashes($_POST['booking_data']), true);\n        }\n        return $cart_item_data;\n    }\n    \n    \/**\n     * \u5728\u8cfc\u7269\u8eca\u986f\u793a\u9810\u7d04\u8cc7\u6599\n     *\/\n    public function display_booking_data_in_cart($item_data, $cart_item) {\n        if (isset($cart_item['9o_van_booking'])) {\n            $booking = $cart_item['9o_van_booking'];\n            \n            $item_data[] = array(\n                'key' => '\u670d\u52d9\u985e\u578b',\n                'value' => $booking['service_type'] == 'airport' ? '\u6a5f\u5834\u63a5\u9001' : '\u5305\u8eca\u65c5\u904a'\n            );\n            \n            $item_data[] = array(\n                'key' => '\u670d\u52d9\u65e5\u671f',\n                'value' => $booking['service_date']\n            );\n            \n            $item_data[] = array(\n                'key' => '\u670d\u52d9\u6642\u9593',\n                'value' => $booking['service_time']\n            );\n            \n            if (isset($booking['pickup_location'])) {\n                $item_data[] = array(\n                    'key' => '\u4e0a\u8eca\u5730\u9ede',\n                    'value' => $booking['pickup_location']\n                );\n            }\n            \n            if (isset($booking['dropoff_location'])) {\n                $item_data[] = array(\n                    'key' => '\u4e0b\u8eca\u5730\u9ede',\n                    'value' => $booking['dropoff_location']\n                );\n            }\n        }\n        \n        return $item_data;\n    }\n    \n    \/**\n     * \u8abf\u6574\u8cfc\u7269\u8eca\u50f9\u683c\n     *\/\n    public function adjust_cart_item_price($cart) {\n        if (is_admin() && !defined('DOING_AJAX')) {\n            return;\n        }\n        \n        foreach ($cart->get_cart() as $cart_item_key => $cart_item) {\n            if (isset($cart_item['9o_van_booking'])) {\n                $booking = $cart_item['9o_van_booking'];\n                $price = isset($booking['total_price']) ? floatval($booking['total_price']) : 0;\n                \n                if ($price > 0) {\n                    $cart_item['data']->set_price($price);\n                }\n            }\n        }\n    }\n    \n    \/**\n     * \u5132\u5b58\u9810\u7d04\u8cc7\u6599\u5230\u8a02\u55ae\n     *\/\n    public function save_booking_data_to_order($item, $cart_item_key, $values, $order) {\n        if (isset($values['9o_van_booking'])) {\n            $booking = $values['9o_van_booking'];\n            \n            \/\/ \u5132\u5b58\u5230\u8a02\u55ae\u9805\u76ee meta\n            $item->add_meta_data('_9o_van_booking', $booking);\n            \n            \/\/ \u5132\u5b58\u91cd\u8981\u8cc7\u8a0a\u70ba\u7368\u7acb meta\n            $item->add_meta_data('\u670d\u52d9\u985e\u578b', $booking['service_type'] == 'airport' ? '\u6a5f\u5834\u63a5\u9001' : '\u5305\u8eca\u65c5\u904a');\n            $item->add_meta_data('\u670d\u52d9\u65e5\u671f', $booking['service_date']);\n            $item->add_meta_data('\u670d\u52d9\u6642\u9593', $booking['service_time']);\n            \n            \/\/ \u5efa\u7acb\u9810\u7d04\u8a18\u9304\n            $this->create_booking_from_order($order, $booking);\n        }\n    }\n    \n    \/**\n     * \u5f9e\u8a02\u55ae\u5efa\u7acb\u9810\u7d04\u8a18\u9304\n     *\/\n    private function create_booking_from_order($order, $booking_data) {\n        global $wpdb;\n        \n        $table = _9o_van_table('bookings');\n        if (!$table) return;\n        \n        $booking_number = _9o_van_generate_booking_number($booking_data['service_type'] == 'airport' ? 'APT' : 'CHT');\n        \n        $wpdb->insert(\n            $table,\n            array(\n                'booking_number' => $booking_number,\n                'service_type' => $booking_data['service_type'],\n                'status' => 'pending',\n                'customer_name' => $order->get_billing_first_name() . ' ' . $order->get_billing_last_name(),\n                'customer_phone' => $order->get_billing_phone(),\n                'customer_email' => $order->get_billing_email(),\n                'service_date' => $booking_data['service_date'],\n                'service_time' => $booking_data['service_time'],\n                'service_data' => json_encode($booking_data, JSON_UNESCAPED_UNICODE),\n                'price_data' => json_encode($booking_data['price_breakdown'] ?? array(), JSON_UNESCAPED_UNICODE),\n                'total_amount' => $booking_data['total_price'],\n                'payment_status' => 'pending',\n                'notes' => $booking_data['notes'] ?? ''\n            )\n        );\n        \n        \/\/ \u5132\u5b58\u9810\u7d04 ID \u5230\u8a02\u55ae\n        $booking_id = $wpdb->insert_id;\n        $order->update_meta_data('_9o_van_booking_id', $booking_id);\n        $order->update_meta_data('_9o_van_booking_number', $booking_number);\n        $order->save();\n        \n        return $booking_id;\n    }\n    \n    \/**\n     * \u81ea\u8a02\u7d50\u5e33\u6b04\u4f4d\n     *\/\n    public function customize_checkout_fields($fields) {\n        \/\/ \u65b0\u589e\u7279\u6b8a\u9700\u6c42\u6b04\u4f4d\n        $fields['order']['special_requirements'] = array(\n            'type' => 'textarea',\n            'label' => '\u7279\u6b8a\u9700\u6c42',\n            'placeholder' => '\u5982\u6709\u7279\u6b8a\u9700\u6c42\u8acb\u544a\u77e5\uff08\u4f8b\u5982\uff1a\u5b30\u5152\u5ea7\u6905\u3001\u8f2a\u6905\u7a7a\u9593\u7b49\uff09',\n            'class' => array('form-row-wide')\n        );\n        \n        \/\/ \u65b0\u589e\u822a\u73ed\u8cc7\u8a0a\uff08\u5982\u679c\u662f\u6a5f\u5834\u63a5\u9001\uff09\n        if ($this->cart_has_airport_service()) {\n            $fields['order']['flight_number'] = array(\n                'type' => 'text',\n                'label' => '\u822a\u73ed\u7de8\u865f',\n                'placeholder' => '\u4f8b\u5982\uff1aBR123',\n                'class' => array('form-row-wide')\n            );\n        }\n        \n        return $fields;\n    }\n    \n    \/**\n     * \u6aa2\u67e5\u8cfc\u7269\u8eca\u662f\u5426\u6709\u6a5f\u5834\u63a5\u9001\u670d\u52d9\n     *\/\n    private function cart_has_airport_service() {\n        if (!WC()->cart) return false;\n        \n        foreach (WC()->cart->get_cart() as $cart_item) {\n            if (isset($cart_item['9o_van_booking']) && $cart_item['9o_van_booking']['service_type'] == 'airport') {\n                return true;\n            }\n        }\n        \n        return false;\n    }\n    \n    \/**\n     * \u5132\u5b58\u7d50\u5e33\u6b04\u4f4d\n     *\/\n    public function save_checkout_fields($order_id) {\n        if (isset($_POST['special_requirements'])) {\n            update_post_meta($order_id, '_special_requirements', sanitize_textarea_field($_POST['special_requirements']));\n        }\n        \n        if (isset($_POST['flight_number'])) {\n            update_post_meta($order_id, '_flight_number', sanitize_text_field($_POST['flight_number']));\n        }\n    }\n    \n    \/**\n     * \u8655\u7406\u8a02\u55ae\u5b8c\u6210\n     *\/\n    public function handle_order_completed($order_id) {\n        $this->update_booking_status($order_id, 'completed', 'paid');\n        \n        \/\/ \u767c\u9001\u5b8c\u6210\u901a\u77e5\n        $this->send_completion_notification($order_id);\n    }\n    \n    \/**\n     * \u8655\u7406\u8a02\u55ae\u8655\u7406\u4e2d\n     *\/\n    public function handle_order_processing($order_id) {\n        $this->update_booking_status($order_id, 'confirmed', 'paid');\n        \n        \/\/ \u767c\u9001\u78ba\u8a8d\u901a\u77e5\n        $this->send_confirmation_notification($order_id);\n    }\n    \n    \/**\n     * \u8655\u7406\u8a02\u55ae\u53d6\u6d88\n     *\/\n    public function handle_order_cancelled($order_id) {\n        $this->update_booking_status($order_id, 'cancelled', 'cancelled');\n        \n        \/\/ \u767c\u9001\u53d6\u6d88\u901a\u77e5\n        $this->send_cancellation_notification($order_id);\n    }\n    \n    \/**\n     * \u8655\u7406\u8a02\u55ae\u9000\u6b3e\n     *\/\n    public function handle_order_refunded($order_id) {\n        $this->update_booking_status($order_id, 'cancelled', 'refunded');\n        \n        \/\/ \u767c\u9001\u9000\u6b3e\u901a\u77e5\n        $this->send_refund_notification($order_id);\n    }\n    \n    \/**\n     * \u66f4\u65b0\u9810\u7d04\u72c0\u614b\n     *\/\n    private function update_booking_status($order_id, $booking_status, $payment_status) {\n        global $wpdb;\n        \n        $order = wc_get_order($order_id);\n        $booking_id = $order->get_meta('_9o_van_booking_id');\n        \n        if ($booking_id) {\n            $table = _9o_van_table('bookings');\n            $wpdb->update(\n                $table,\n                array(\n                    'status' => $booking_status,\n                    'payment_status' => $payment_status\n                ),\n                array('id' => $booking_id)\n            );\n        }\n    }\n    \n    \/**\n     * \u767c\u9001\u78ba\u8a8d\u901a\u77e5\n     *\/\n    private function send_confirmation_notification($order_id) {\n        $order = wc_get_order($order_id);\n        $booking_number = $order->get_meta('_9o_van_booking_number');\n        \n        \/\/ \u4f7f\u7528\u90f5\u4ef6\u5f15\u64ce\u767c\u9001\n        if (function_exists('_9o_van_send_email')) {\n            _9o_van_send_email(\n                $order->get_billing_email(),\n                'payment_success',\n                array(\n                    'customer_name' => $order->get_billing_first_name(),\n                    'booking_number' => $booking_number,\n                    'payment_amount' => $order->get_total(),\n                    'payment_method' => $order->get_payment_method_title(),\n                    'transaction_id' => $order->get_transaction_id(),\n                    'payment_time' => current_time('Y-m-d H:i:s')\n                )\n            );\n        }\n    }\n    \n    \/**\n     * \u767c\u9001\u5b8c\u6210\u901a\u77e5\n     *\/\n    private function send_completion_notification($order_id) {\n        \/\/ \u5be6\u4f5c\u5b8c\u6210\u901a\u77e5\u908f\u8f2f\n    }\n    \n    \/**\n     * \u767c\u9001\u53d6\u6d88\u901a\u77e5\n     *\/\n    private function send_cancellation_notification($order_id) {\n        \/\/ \u5be6\u4f5c\u53d6\u6d88\u901a\u77e5\u908f\u8f2f\n    }\n    \n    \/**\n     * \u767c\u9001\u9000\u6b3e\u901a\u77e5\n     *\/\n    private function send_refund_notification($order_id) {\n        \/\/ \u5be6\u4f5c\u9000\u6b3e\u901a\u77e5\u908f\u8f2f\n    }\n    \n    \/**\n     * \u5728\u8a02\u55ae\u9801\u9762\u986f\u793a\u9810\u7d04\u8cc7\u8a0a\n     *\/\n    public function display_booking_info_in_order($order) {\n        $booking_id = $order->get_meta('_9o_van_booking_id');\n        $booking_number = $order->get_meta('_9o_van_booking_number');\n        \n        if ($booking_number) {\n            ?>\n            <div class=\"order_data_column\">\n                <h3>9o Van \u9810\u7d04\u8cc7\u8a0a<\/h3>\n                <p><strong>\u9810\u7d04\u7de8\u865f\uff1a<\/strong> <?php echo esc_html($booking_number); ?><\/p>\n                <?php if ($booking_id): ?>\n                <p><a href=\"<?php echo admin_url('admin.php?page=9o-van-dashboard&booking_id=' . $booking_id); ?>\" class=\"button\">\u67e5\u770b\u9810\u7d04\u8a73\u60c5<\/a><\/p>\n                <?php endif; ?>\n            <\/div>\n            <?php\n        }\n    }\n    \n    \/**\n     * AJAX \u52a0\u5165\u8cfc\u7269\u8eca\n     *\/\n    public function ajax_add_to_cart() {\n        \/\/ \u9a57\u8b49 nonce\n        if (!wp_verify_nonce($_POST['nonce'], '9o_van_ajax_nonce')) {\n            wp_send_json_error('\u5b89\u5168\u9a57\u8b49\u5931\u6557');\n        }\n        \n        $booking_data = json_decode(stripslashes($_POST['booking_data']), true);\n        $product_id = $booking_data['service_type'] == 'airport' ? $this->product_id_airport : $this->product_id_charter;\n        \n        if (!$product_id) {\n            wp_send_json_error('\u7522\u54c1\u4e0d\u5b58\u5728');\n        }\n        \n        \/\/ \u6e05\u7a7a\u8cfc\u7269\u8eca\uff08\u907f\u514d\u6df7\u5408\u4e0d\u540c\u9810\u7d04\uff09\n        WC()->cart->empty_cart();\n        \n        \/\/ \u52a0\u5165\u8cfc\u7269\u8eca\n        $cart_item_key = WC()->cart->add_to_cart(\n            $product_id,\n            1,\n            0,\n            array(),\n            array('9o_van_booking' => $booking_data)\n        );\n        \n        if ($cart_item_key) {\n            wp_send_json_success(array(\n                'cart_url' => wc_get_cart_url(),\n                'checkout_url' => wc_get_checkout_url()\n            ));\n        } else {\n            wp_send_json_error('\u7121\u6cd5\u52a0\u5165\u8cfc\u7269\u8eca');\n        }\n    }\n}\n\n\/\/ \u521d\u59cb\u5316 WooCommerce \u6574\u5408\nNineOVan_WooCommerce_Integration::get_instance();\n\n\/**\n * \u5168\u57df\u51fd\u6578\uff1a\u52a0\u5165\u9810\u7d04\u5230\u8cfc\u7269\u8eca\n *\/\nif (!function_exists('_9o_van_add_to_cart')) {\n    function _9o_van_add_to_cart($booking_data) {\n        $integration = NineOVan_WooCommerce_Integration::get_instance();\n        \n        \/\/ \u6a21\u64ec AJAX \u8acb\u6c42\n        $_POST['booking_data'] = json_encode($booking_data, JSON_UNESCAPED_UNICODE);\n        $_POST['nonce'] = wp_create_nonce('9o_van_ajax_nonce');\n        \n        $integration->ajax_add_to_cart();\n    }\n}","active":true,"priority":8,"modified":"2025-09-13 14:30:18","revision":"1"}]}