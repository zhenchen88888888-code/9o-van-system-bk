{"generator":"Code Snippets v3.7.0","date_created":"2025-09-15 14:39","snippets":[{"id":82,"name":"06-Admin-Menu-Base","code":"\/**\n * ============================================================================\n * Snippet: 06-Admin-Menu-Base\n * Title: 9o Van \u5f8c\u53f0\u9078\u55ae\u57fa\u790e\n * Description: \u5efa\u7acb\u5f8c\u53f0\u7ba1\u7406\u9078\u55ae\u7d50\u69cb\u3001\u6b0a\u9650\u63a7\u5236\u3001\u57fa\u790e\u9801\u9762\u6846\u67b6\n * Version: 1.0.0\n * Author: 9o Van Development Team\n * Created: 2025-09-13\n * Modified: 2025-09-13\n * Priority: 7\n * Dependencies: 00-Global-Constants\n * Hook: Run everywhere\n * ============================================================================\n *\/\n\n\/\/ \u9632\u6b62\u76f4\u63a5\u8a2a\u554f\nif (!defined('ABSPATH')) {\n    exit;\n}\n\n\/**\n * \u5f8c\u53f0\u7ba1\u7406\u4ecb\u9762\u985e\u5225\n *\/\nclass NineOVan_Admin_Menu {\n    \n    private static $instance = null;\n    private $menu_slug = '9o-van-dashboard';\n    private $capability = 'manage_options';\n    \n    \/**\n     * \u53d6\u5f97\u55ae\u4f8b\u5be6\u4f8b\n     *\/\n    public static function get_instance() {\n        if (null === self::$instance) {\n            self::$instance = new self();\n        }\n        return self::$instance;\n    }\n    \n    \/**\n     * \u5efa\u69cb\u51fd\u5f0f\n     *\/\n    private function __construct() {\n        add_action('admin_menu', array($this, 'create_admin_menu'));\n        add_action('admin_enqueue_scripts', array($this, 'enqueue_admin_assets'));\n        add_action('admin_init', array($this, 'register_settings'));\n        \n        \/\/ \u81ea\u8a02\u6b0a\u9650\n        add_action('init', array($this, 'add_custom_capabilities'));\n        \n        \/\/ Dashboard widgets\n        add_action('wp_dashboard_setup', array($this, 'add_dashboard_widgets'));\n        \n        \/\/ Admin notices\n        add_action('admin_notices', array($this, 'show_admin_notices'));\n    }\n    \n    \/**\n     * \u5efa\u7acb\u7ba1\u7406\u9078\u55ae\n     *\/\n    public function create_admin_menu() {\n        \/\/ \u4e3b\u9078\u55ae\n        add_menu_page(\n            '9o Van \u7ba1\u7406\u7cfb\u7d71',           \/\/ \u9801\u9762\u6a19\u984c\n            '9o Van Strip',              \/\/ \u9078\u55ae\u6a19\u984c\n            $this->capability,           \/\/ \u6b0a\u9650\n            $this->menu_slug,           \/\/ Slug\n            array($this, 'render_dashboard'), \/\/ \u56de\u8abf\u51fd\u6578\n            'dashicons-car',            \/\/ \u5716\u793a\n            30                          \/\/ \u4f4d\u7f6e\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u5100\u8868\u677f\n        add_submenu_page(\n            $this->menu_slug,\n            '\u5100\u8868\u677f',\n            '\u5100\u8868\u677f',\n            $this->capability,\n            $this->menu_slug,\n            array($this, 'render_dashboard')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u6a5f\u5834\u63a5\u9001\n        add_submenu_page(\n            $this->menu_slug,\n            '\u6a5f\u5834\u63a5\u9001\u9810\u7d04',\n            '\u6a5f\u5834\u63a5\u9001',\n            $this->capability,\n            '9o-van-airport',\n            array($this, 'render_airport_bookings')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u5305\u8eca\u65c5\u904a\n        add_submenu_page(\n            $this->menu_slug,\n            '\u5305\u8eca\u65c5\u904a\u9810\u7d04',\n            '\u5305\u8eca\u65c5\u904a',\n            $this->capability,\n            '9o-van-charter',\n            array($this, 'render_charter_bookings')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u4ed8\u6b3e\u7ba1\u7406\n        add_submenu_page(\n            $this->menu_slug,\n            '\u4ed8\u6b3e\u7ba1\u7406',\n            '\u4ed8\u6b3e\u7ba1\u7406',\n            $this->capability,\n            '9o-van-payments',\n            array($this, 'render_payments')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u53f8\u6a5f\u7ba1\u7406\n        add_submenu_page(\n            $this->menu_slug,\n            '\u53f8\u6a5f\u7ba1\u7406',\n            '\u53f8\u6a5f\u7ba1\u7406',\n            $this->capability,\n            '9o-van-drivers',\n            array($this, 'render_drivers')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u5831\u8868\n        add_submenu_page(\n            $this->menu_slug,\n            '\u5831\u8868\u5206\u6790',\n            '\u5831\u8868',\n            $this->capability,\n            '9o-van-reports',\n            array($this, 'render_reports')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u8a2d\u5b9a\n        add_submenu_page(\n            $this->menu_slug,\n            '\u7cfb\u7d71\u8a2d\u5b9a',\n            '\u8a2d\u5b9a',\n            $this->capability,\n            '9o-van-settings',\n            array($this, 'render_settings')\n        );\n        \n        \/\/ \u5b50\u9078\u55ae - \u65e5\u8a8c\n        add_submenu_page(\n            $this->menu_slug,\n            '\u7cfb\u7d71\u65e5\u8a8c',\n            '\u65e5\u8a8c',\n            $this->capability,\n            '9o-van-logs',\n            array($this, 'render_logs')\n        );\n    }\n    \n    \/**\n     * \u8f09\u5165\u5f8c\u53f0\u8cc7\u6e90\n     *\/\n    public function enqueue_admin_assets($hook) {\n        \/\/ \u53ea\u5728\u6211\u5011\u7684\u9801\u9762\u8f09\u5165\n        if (strpos($hook, '9o-van') === false && strpos($hook, 'toplevel_page_9o-van') === false) {\n            return;\n        }\n        \n        \/\/ \u5167\u5efa CSS - \u76f4\u63a5 inline\n        wp_add_inline_style('wp-admin', $this->get_admin_css());\n        \n        \/\/ \u5167\u5efa JavaScript\n        wp_add_inline_script('jquery', $this->get_admin_js());\n        \n        \/\/ \u8f09\u5165 Chart.js for \u5831\u8868\n        if (strpos($hook, '9o-van-reports') !== false || strpos($hook, '9o-van-dashboard') !== false) {\n            wp_enqueue_script(\n                'chartjs',\n                'https:\/\/cdn.jsdelivr.net\/npm\/chart.js@3.9.1\/dist\/chart.min.js',\n                array(),\n                '3.9.1',\n                true\n            );\n        }\n    }\n    \n    \/**\n     * \u8a3b\u518a\u8a2d\u5b9a\n     *\/\n    public function register_settings() {\n        \/\/ \u6a5f\u5834\u63a5\u9001\u8a2d\u5b9a\n        register_setting('9o_van_airport_settings', '9o_van_airport_prices');\n        register_setting('9o_van_airport_settings', '9o_van_airport_surcharges');\n        register_setting('9o_van_airport_settings', '9o_van_remote_areas');\n        \n        \/\/ \u5305\u8eca\u65c5\u904a\u8a2d\u5b9a\n        register_setting('9o_van_charter_settings', '9o_van_charter_rates');\n        register_setting('9o_van_charter_settings', '9o_van_mountain_areas');\n        register_setting('9o_van_charter_settings', '9o_van_driver_allowances');\n        \n        \/\/ \u901a\u77e5\u8a2d\u5b9a\n        register_setting('9o_van_notification_settings', '9o_van_admin_emails');\n        register_setting('9o_van_notification_settings', '9o_van_email_templates');\n        \n        \/\/ \u4ed8\u6b3e\u8a2d\u5b9a\n        register_setting('9o_van_payment_settings', '9o_van_payment_methods');\n        register_setting('9o_van_payment_settings', '9o_van_payment_instructions');\n    }\n    \n    \/**\n     * \u65b0\u589e\u81ea\u8a02\u6b0a\u9650\n     *\/\n    public function add_custom_capabilities() {\n        $admin = get_role('administrator');\n        \n        if ($admin) {\n            \/\/ \u7ba1\u7406\u9810\u7d04\n            $admin->add_cap('9o_van_manage_bookings');\n            $admin->add_cap('9o_van_edit_booking');\n            $admin->add_cap('9o_van_delete_booking');\n            \n            \/\/ \u7ba1\u7406\u4ed8\u6b3e\n            $admin->add_cap('9o_van_manage_payments');\n            $admin->add_cap('9o_van_process_refund');\n            \n            \/\/ \u7ba1\u7406\u53f8\u6a5f\n            $admin->add_cap('9o_van_manage_drivers');\n            $admin->add_cap('9o_van_assign_driver');\n            \n            \/\/ \u67e5\u770b\u5831\u8868\n            $admin->add_cap('9o_van_view_reports');\n            $admin->add_cap('9o_van_export_data');\n            \n            \/\/ \u7cfb\u7d71\u8a2d\u5b9a\n            $admin->add_cap('9o_van_manage_settings');\n        }\n    }\n    \n    \/**\n     * \u65b0\u589e\u5100\u8868\u677f\u5c0f\u5de5\u5177\n     *\/\n    public function add_dashboard_widgets() {\n        wp_add_dashboard_widget(\n            '9o_van_today_bookings',\n            '\u4eca\u65e5\u9810\u7d04',\n            array($this, 'render_today_bookings_widget')\n        );\n        \n        wp_add_dashboard_widget(\n            '9o_van_revenue_summary',\n            '\u672c\u6708\u71df\u6536',\n            array($this, 'render_revenue_widget')\n        );\n    }\n    \n    \/**\n     * \u986f\u793a\u7ba1\u7406\u54e1\u901a\u77e5\n     *\/\n    public function show_admin_notices() {\n        \/\/ \u6aa2\u67e5\u662f\u5426\u5728\u6211\u5011\u7684\u9801\u9762\n        if (!isset($_GET['page']) || strpos($_GET['page'], '9o-van') === false) {\n            return;\n        }\n        \n        \/\/ \u6210\u529f\u8a0a\u606f\n        if (isset($_GET['message'])) {\n            $message = sanitize_text_field($_GET['message']);\n            $messages = array(\n                'saved' => '\u8a2d\u5b9a\u5df2\u5132\u5b58',\n                'tables_created' => '\u8cc7\u6599\u8868\u5df2\u5efa\u7acb',\n                'booking_created' => '\u9810\u7d04\u5df2\u5efa\u7acb',\n                'booking_updated' => '\u9810\u7d04\u5df2\u66f4\u65b0',\n                'booking_deleted' => '\u9810\u7d04\u5df2\u522a\u9664'\n            );\n            \n            if (isset($messages[$message])) {\n                echo '<div class=\"notice notice-success is-dismissible\"><p>' . esc_html($messages[$message]) . '<\/p><\/div>';\n            }\n        }\n        \n        \/\/ \u932f\u8aa4\u8a0a\u606f\n        if (isset($_GET['error'])) {\n            $error = sanitize_text_field($_GET['error']);\n            echo '<div class=\"notice notice-error is-dismissible\"><p>' . esc_html($error) . '<\/p><\/div>';\n        }\n    }\n    \n    \/\/ ===== \u9801\u9762\u6e32\u67d3\u51fd\u6578 =====\n    \n    \/**\n     * \u6e32\u67d3\u5100\u8868\u677f\n     *\/\n    public function render_dashboard() {\n        ?>\n        <div class=\"wrap\">\n            <h1>9o Van \u7ba1\u7406\u5100\u8868\u677f<\/h1>\n            \n            <div class=\"9o-van-dashboard\">\n                <!-- \u7d71\u8a08\u5361\u7247 -->\n                <div class=\"stats-cards\">\n                    <div class=\"stat-card\">\n                        <h3>\u4eca\u65e5\u9810\u7d04<\/h3>\n                        <p class=\"stat-number\"><?php echo $this->get_today_bookings_count(); ?><\/p>\n                    <\/div>\n                    <div class=\"stat-card\">\n                        <h3>\u672c\u6708\u71df\u6536<\/h3>\n                        <p class=\"stat-number\">NT$ <?php echo number_format($this->get_month_revenue()); ?><\/p>\n                    <\/div>\n                    <div class=\"stat-card\">\n                        <h3>\u5f85\u8655\u7406\u8a02\u55ae<\/h3>\n                        <p class=\"stat-number\"><?php echo $this->get_pending_bookings_count(); ?><\/p>\n                    <\/div>\n                    <div class=\"stat-card\">\n                        <h3>\u6d3b\u8e8d\u53f8\u6a5f<\/h3>\n                        <p class=\"stat-number\"><?php echo $this->get_active_drivers_count(); ?><\/p>\n                    <\/div>\n                <\/div>\n                \n                <!-- \u5feb\u901f\u64cd\u4f5c -->\n                <div class=\"quick-actions\">\n                    <h2>\u5feb\u901f\u64cd\u4f5c<\/h2>\n                    <a href=\"<?php echo admin_url('admin.php?page=9o-van-airport'); ?>\" class=\"button button-primary\">\u65b0\u589e\u6a5f\u5834\u63a5\u9001<\/a>\n                    <a href=\"<?php echo admin_url('admin.php?page=9o-van-charter'); ?>\" class=\"button button-primary\">\u65b0\u589e\u5305\u8eca\u9810\u7d04<\/a>\n                    <a href=\"<?php echo admin_url('admin.php?page=9o-van-drivers'); ?>\" class=\"button\">\u6d3e\u55ae\u7ba1\u7406<\/a>\n                    <a href=\"<?php echo admin_url('admin.php?page=9o-van-reports'); ?>\" class=\"button\">\u67e5\u770b\u5831\u8868<\/a>\n                <\/div>\n                \n                <!-- \u5716\u8868\u5340\u57df -->\n                <div class=\"chart-container\">\n                    <h2>\u672c\u9031\u9810\u7d04\u7d71\u8a08<\/h2>\n                    <canvas id=\"weeklyChart\" width=\"400\" height=\"150\"><\/canvas>\n                <\/div>\n                \n                <!-- \u6700\u8fd1\u9810\u7d04 -->\n                <div class=\"recent-bookings\">\n                    <h2>\u6700\u8fd1\u9810\u7d04<\/h2>\n                    <?php $this->render_recent_bookings_table(); ?>\n                <\/div>\n            <\/div>\n        <\/div>\n        <?php\n    }\n    \n    \/**\n     * \u6e32\u67d3\u6a5f\u5834\u63a5\u9001\u9801\u9762\n     *\/\n    public function render_airport_bookings() {\n        echo '<div class=\"wrap\">';\n        echo '<h1>\u6a5f\u5834\u63a5\u9001\u9810\u7d04\u7ba1\u7406<\/h1>';\n        echo '<p>\u6a5f\u5834\u63a5\u9001\u9810\u7d04\u5217\u8868\u8207\u7ba1\u7406\u529f\u80fd<\/p>';\n        \/\/ \u9019\u88e1\u5c07\u7531 Airport \u6a21\u7d44\u63a5\u7ba1\n        do_action('9o_van_render_airport_admin');\n        echo '<\/div>';\n    }\n    \n    \/**\n     * \u6e32\u67d3\u5305\u8eca\u65c5\u904a\u9801\u9762\n     *\/\n    public function render_charter_bookings() {\n        echo '<div class=\"wrap\">';\n        echo '<h1>\u5305\u8eca\u65c5\u904a\u9810\u7d04\u7ba1\u7406<\/h1>';\n        echo '<p>\u5305\u8eca\u65c5\u904a\u9810\u7d04\u5217\u8868\u8207\u7ba1\u7406\u529f\u80fd<\/p>';\n        \/\/ \u9019\u88e1\u5c07\u7531 Charter \u6a21\u7d44\u63a5\u7ba1\n        do_action('9o_van_render_charter_admin');\n        echo '<\/div>';\n    }\n    \n    \/**\n     * \u6e32\u67d3\u4ed8\u6b3e\u7ba1\u7406\u9801\u9762\n     *\/\n    public function render_payments() {\n        echo '<div class=\"wrap\">';\n        echo '<h1>\u4ed8\u6b3e\u7ba1\u7406<\/h1>';\n        echo '<p>\u4ed8\u6b3e\u8a18\u9304\u8207\u9000\u6b3e\u8655\u7406<\/p>';\n        \/\/ \u9019\u88e1\u5c07\u7531 Payment \u6a21\u7d44\u63a5\u7ba1\n        do_action('9o_van_render_payments_admin');\n        echo '<\/div>';\n    }\n    \n    \/**\n     * \u6e32\u67d3\u53f8\u6a5f\u7ba1\u7406\u9801\u9762\n     *\/\n    public function render_drivers() {\n        echo '<div class=\"wrap\">';\n        echo '<h1>\u53f8\u6a5f\u7ba1\u7406<\/h1>';\n        echo '<p>\u53f8\u6a5f\u8cc7\u6599\u8207\u6d3e\u55ae\u7ba1\u7406<\/p>';\n        \/\/ \u9019\u88e1\u5c07\u7531 Driver \u6a21\u7d44\u63a5\u7ba1\n        do_action('9o_van_render_drivers_admin');\n        echo '<\/div>';\n    }\n    \n    \/**\n     * \u6e32\u67d3\u5831\u8868\u9801\u9762\n     *\/\n    public function render_reports() {\n        echo '<div class=\"wrap\">';\n        echo '<h1>\u5831\u8868\u5206\u6790<\/h1>';\n        echo '<canvas id=\"revenueChart\"><\/canvas>';\n        \/\/ \u9019\u88e1\u5c07\u7531 Reports \u6a21\u7d44\u63a5\u7ba1\n        do_action('9o_van_render_reports_admin');\n        echo '<\/div>';\n    }\n    \n    \/**\n     * \u6e32\u67d3\u8a2d\u5b9a\u9801\u9762\n     *\/\n    public function render_settings() {\n        ?>\n        <div class=\"wrap\">\n            <h1>\u7cfb\u7d71\u8a2d\u5b9a<\/h1>\n            <form method=\"post\" action=\"options.php\">\n                <?php settings_fields('9o_van_settings'); ?>\n                \n                <h2 class=\"nav-tab-wrapper\">\n                    <a href=\"#general\" class=\"nav-tab nav-tab-active\">\u4e00\u822c\u8a2d\u5b9a<\/a>\n                    <a href=\"#airport\" class=\"nav-tab\">\u6a5f\u5834\u63a5\u9001<\/a>\n                    <a href=\"#charter\" class=\"nav-tab\">\u5305\u8eca\u65c5\u904a<\/a>\n                    <a href=\"#payment\" class=\"nav-tab\">\u4ed8\u6b3e\u8a2d\u5b9a<\/a>\n                    <a href=\"#email\" class=\"nav-tab\">\u90f5\u4ef6\u901a\u77e5<\/a>\n                <\/h2>\n                \n                <div id=\"general\" class=\"tab-content\">\n                    <!-- \u4e00\u822c\u8a2d\u5b9a\u5167\u5bb9 -->\n                <\/div>\n                \n                <?php submit_button(); ?>\n            <\/form>\n        <\/div>\n        <?php\n    }\n    \n    \/**\n     * \u6e32\u67d3\u65e5\u8a8c\u9801\u9762\n     *\/\n    public function render_logs() {\n        echo '<div class=\"wrap\">';\n        echo '<h1>\u7cfb\u7d71\u65e5\u8a8c<\/h1>';\n        $this->render_logs_table();\n        echo '<\/div>';\n    }\n    \n    \/\/ ===== \u8f14\u52a9\u51fd\u6578 =====\n    \n    \/**\n     * \u53d6\u5f97\u4eca\u65e5\u9810\u7d04\u6578\n     *\/\n    private function get_today_bookings_count() {\n        global $wpdb;\n        $table = _9o_van_table('bookings');\n        if (!$table) return 0;\n        \n        return $wpdb->get_var(\n            \"SELECT COUNT(*) FROM $table WHERE DATE(service_date) = CURDATE()\"\n        ) ?: 0;\n    }\n    \n    \/**\n     * \u53d6\u5f97\u672c\u6708\u71df\u6536\n     *\/\n    private function get_month_revenue() {\n        global $wpdb;\n        $table = _9o_van_table('bookings');\n        if (!$table) return 0;\n        \n        return $wpdb->get_var(\n            \"SELECT SUM(total_amount) FROM $table \n             WHERE MONTH(created_at) = MONTH(CURRENT_DATE()) \n             AND YEAR(created_at) = YEAR(CURRENT_DATE())\n             AND payment_status = 'paid'\"\n        ) ?: 0;\n    }\n    \n    \/**\n     * \u53d6\u5f97\u5f85\u8655\u7406\u9810\u7d04\u6578\n     *\/\n    private function get_pending_bookings_count() {\n        global $wpdb;\n        $table = _9o_van_table('bookings');\n        if (!$table) return 0;\n        \n        return $wpdb->get_var(\n            \"SELECT COUNT(*) FROM $table WHERE status = 'pending'\"\n        ) ?: 0;\n    }\n    \n    \/**\n     * \u53d6\u5f97\u6d3b\u8e8d\u53f8\u6a5f\u6578\n     *\/\n    private function get_active_drivers_count() {\n        \/\/ \u66ab\u6642\u8fd4\u56de\u56fa\u5b9a\u503c\uff0c\u5f85\u53f8\u6a5f\u6a21\u7d44\u5be6\u4f5c\n        return 8;\n    }\n    \n    \/**\n     * \u6e32\u67d3\u6700\u8fd1\u9810\u7d04\u8868\u683c\n     *\/\n    private function render_recent_bookings_table() {\n        global $wpdb;\n        $table = _9o_van_table('bookings');\n        \n        if (!$table) {\n            echo '<p>\u8cc7\u6599\u8868\u5c1a\u672a\u5efa\u7acb<\/p>';\n            return;\n        }\n        \n        $bookings = $wpdb->get_results(\n            \"SELECT * FROM $table ORDER BY created_at DESC LIMIT 10\"\n        );\n        \n        if (empty($bookings)) {\n            echo '<p>\u5c1a\u7121\u9810\u7d04\u8a18\u9304<\/p>';\n            return;\n        }\n        \n        ?>\n        <table class=\"wp-list-table widefat fixed striped\">\n            <thead>\n                <tr>\n                    <th>\u8a02\u55ae\u7de8\u865f<\/th>\n                    <th>\u5ba2\u6236\u59d3\u540d<\/th>\n                    <th>\u670d\u52d9\u985e\u578b<\/th>\n                    <th>\u670d\u52d9\u65e5\u671f<\/th>\n                    <th>\u91d1\u984d<\/th>\n                    <th>\u72c0\u614b<\/th>\n                    <th>\u64cd\u4f5c<\/th>\n                <\/tr>\n            <\/thead>\n            <tbody>\n                <?php foreach ($bookings as $booking): ?>\n                <tr>\n                    <td><?php echo esc_html($booking->booking_number); ?><\/td>\n                    <td><?php echo esc_html($booking->customer_name); ?><\/td>\n                    <td><?php echo $booking->service_type === 'airport' ? '\u6a5f\u5834\u63a5\u9001' : '\u5305\u8eca\u65c5\u904a'; ?><\/td>\n                    <td><?php echo esc_html($booking->service_date); ?><\/td>\n                    <td>NT$ <?php echo number_format($booking->total_amount); ?><\/td>\n                    <td><?php echo $this->get_status_badge($booking->status); ?><\/td>\n                    <td>\n                        <a href=\"#\" class=\"button button-small\">\u67e5\u770b<\/a>\n                    <\/td>\n                <\/tr>\n                <?php endforeach; ?>\n            <\/tbody>\n        <\/table>\n        <?php\n    }\n    \n    \/**\n     * \u6e32\u67d3\u65e5\u8a8c\u8868\u683c\n     *\/\n    private function render_logs_table() {\n        global $wpdb;\n        $table = _9o_van_table('logs');\n        \n        if (!$table) {\n            echo '<p>\u8cc7\u6599\u8868\u5c1a\u672a\u5efa\u7acb<\/p>';\n            return;\n        }\n        \n        $logs = $wpdb->get_results(\n            \"SELECT * FROM $table ORDER BY created_at DESC LIMIT 100\"\n        );\n        \n        ?>\n        <table class=\"wp-list-table widefat fixed striped\">\n            <thead>\n                <tr>\n                    <th width=\"150\">\u6642\u9593<\/th>\n                    <th width=\"80\">\u7b49\u7d1a<\/th>\n                    <th width=\"100\">\u5143\u4ef6<\/th>\n                    <th>\u8a0a\u606f<\/th>\n                    <th width=\"120\">IP<\/th>\n                <\/tr>\n            <\/thead>\n            <tbody>\n                <?php foreach ($logs as $log): ?>\n                <tr>\n                    <td><?php echo esc_html($log->created_at); ?><\/td>\n                    <td><span class=\"log-level log-<?php echo esc_attr($log->level); ?>\"><?php echo esc_html($log->level); ?><\/span><\/td>\n                    <td><?php echo esc_html($log->component); ?><\/td>\n                    <td><?php echo esc_html($log->message); ?><\/td>\n                    <td><?php echo esc_html($log->ip_address); ?><\/td>\n                <\/tr>\n                <?php endforeach; ?>\n            <\/tbody>\n        <\/table>\n        <?php\n    }\n    \n    \/**\n     * \u53d6\u5f97\u72c0\u614b\u6a19\u7c64\n     *\/\n    private function get_status_badge($status) {\n        $badges = array(\n            'pending' => '<span class=\"badge badge-warning\">\u5f85\u8655\u7406<\/span>',\n            'confirmed' => '<span class=\"badge badge-info\">\u5df2\u78ba\u8a8d<\/span>',\n            'completed' => '<span class=\"badge badge-success\">\u5df2\u5b8c\u6210<\/span>',\n            'cancelled' => '<span class=\"badge badge-danger\">\u5df2\u53d6\u6d88<\/span>'\n        );\n        \n        return isset($badges[$status]) ? $badges[$status] : $status;\n    }\n    \n    \/**\n     * Widget: \u4eca\u65e5\u9810\u7d04\n     *\/\n    public function render_today_bookings_widget() {\n        $count = $this->get_today_bookings_count();\n        echo \"<p style='font-size: 24px; text-align: center;'>$count<\/p>\";\n        echo '<p style=\"text-align: center;\"><a href=\"' . admin_url('admin.php?page=9o-van-dashboard') . '\">\u67e5\u770b\u8a73\u60c5<\/a><\/p>';\n    }\n    \n    \/**\n     * Widget: \u672c\u6708\u71df\u6536\n     *\/\n    public function render_revenue_widget() {\n        $revenue = $this->get_month_revenue();\n        echo \"<p style='font-size: 24px; text-align: center; color: #e74c3c;'>NT$ \" . number_format($revenue) . \"<\/p>\";\n        echo '<p style=\"text-align: center;\"><a href=\"' . admin_url('admin.php?page=9o-van-reports') . '\">\u67e5\u770b\u5831\u8868<\/a><\/p>';\n    }\n    \n    \/**\n     * \u53d6\u5f97\u7ba1\u7406\u54e1CSS\n     *\/\n    private function get_admin_css() {\n        return '\n        .9o-van-dashboard {\n            margin-top: 20px;\n        }\n        .stats-cards {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            margin-bottom: 30px;\n        }\n        .stat-card {\n            background: white;\n            border: 1px solid #ccc;\n            border-radius: 5px;\n            padding: 20px;\n            text-align: center;\n        }\n        .stat-card h3 {\n            margin: 0 0 10px 0;\n            color: #666;\n            font-size: 14px;\n        }\n        .stat-number {\n            font-size: 32px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 0;\n        }\n        .quick-actions {\n            background: white;\n            padding: 20px;\n            border: 1px solid #ccc;\n            border-radius: 5px;\n            margin-bottom: 30px;\n        }\n        .quick-actions .button {\n            margin-right: 10px;\n            margin-bottom: 10px;\n        }\n        .recent-bookings, .chart-container {\n            background: white;\n            padding: 20px;\n            border: 1px solid #ccc;\n            border-radius: 5px;\n            margin-bottom: 30px;\n        }\n        .badge {\n            padding: 2px 8px;\n            border-radius: 3px;\n            font-size: 12px;\n            font-weight: bold;\n        }\n        .badge-warning { background: #fff3cd; color: #856404; }\n        .badge-info { background: #d1ecf1; color: #0c5460; }\n        .badge-success { background: #d4edda; color: #155724; }\n        .badge-danger { background: #f8d7da; color: #721c24; }\n        .log-level {\n            padding: 2px 8px;\n            border-radius: 3px;\n            font-size: 12px;\n            font-weight: bold;\n        }\n        .log-info { background: #d4edda; color: #155724; }\n        .log-warning { background: #fff3cd; color: #856404; }\n        .log-error { background: #f8d7da; color: #721c24; }\n        ';\n    }\n    \n    \/**\n     * \u53d6\u5f97\u7ba1\u7406\u54e1JS\n     *\/\n    private function get_admin_js() {\n        return \"\n        jQuery(document).ready(function($) {\n            \/\/ Tab \u5207\u63db\n            $('.nav-tab').on('click', function(e) {\n                e.preventDefault();\n                $('.nav-tab').removeClass('nav-tab-active');\n                $(this).addClass('nav-tab-active');\n                $('.tab-content').hide();\n                $($(this).attr('href')).show();\n            });\n            \n            \/\/ \u521d\u59cb\u5316\u5716\u8868\n            if ($('#weeklyChart').length && typeof Chart !== 'undefined') {\n                var ctx = document.getElementById('weeklyChart').getContext('2d');\n                new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: ['\u9031\u4e00', '\u9031\u4e8c', '\u9031\u4e09', '\u9031\u56db', '\u9031\u4e94', '\u9031\u516d', '\u9031\u65e5'],\n                        datasets: [{\n                            label: '\u9810\u7d04\u6578\u91cf',\n                            data: [12, 19, 3, 5, 2, 15, 20],\n                            borderColor: '#e74c3c',\n                            tension: 0.1\n                        }]\n                    }\n                });\n            }\n        });\n        \";\n    }\n}\n\n\/\/ \u521d\u59cb\u5316\u5f8c\u53f0\u9078\u55ae\nNineOVan_Admin_Menu::get_instance();","active":true,"priority":7,"modified":"2025-09-13 14:28:01","revision":"1"}]}