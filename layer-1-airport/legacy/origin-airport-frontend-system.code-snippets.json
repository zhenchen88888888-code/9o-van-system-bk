{"generator":"Code Snippets v3.7.0","date_created":"2025-09-13 04:54","snippets":[{"id":35,"name":"Airport Frontend System","code":"\/\/ CSS \u6a23\u5f0f\nadd_action('wp_head', function() {\n    global $post;\n    $content = isset($post->post_content) ? $post->post_content : '';\n    \n    if (!is_page('\u6a5f\u5834\u63a5\u9001\u9810\u7d04') && !is_page('airport-booking') && !has_shortcode($content, 'airport_booking_form')) {\n        return;\n    }\n    ?>\n    \n    <style type=\"text\/css\">\n    \/* \u6a5f\u5834\u63a5\u9001\u7cfb\u7d71 CSS V6.3 - \u5305\u8eca\u65c5\u904a\u98a8\u683c *\/\n    :root {\n        --primary: #94989C;\n        --primary-dark: #7a7e82;\n        --secondary: #A8A094;\n        --danger: #dc2626;\n        --warning: #f59e0b;\n        --success: #16a34a;\n        --border: #D4CFC4;\n        --bg-light: #F5F2EE;\n        --text-main: #3C3834;\n        --text-sub: #5C5854;\n        --accent: #C8C2B8;\n        --radius: 8px;\n        --shadow: 0 1px 3px rgba(148,152,156,0.1);\n    }\n\n    #airport-booking-app {\n        max-width: 1400px;\n        margin: 0 auto;\n        padding: 20px;\n    }\n\n    .booking-container {\n        display: grid;\n        grid-template-columns: 2.5fr 1fr;\n        gap: 30px;\n    }\n\n    #airport-booking-form {\n        background: white;\n        border-radius: 12px;\n        box-shadow: var(--shadow);\n        overflow: hidden;\n        border: 1px solid var(--border);\n    }\n\n    .form-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 500px;\n        color: var(--text-sub);\n        font-size: 18px;\n    }\n\n    .form-header {\n        background: var(--primary);\n        color: white;\n        padding: 30px;\n        text-align: center;\n    }\n\n    .form-header h2 {\n        margin: 0 0 10px;\n        font-size: 28px;\n        font-weight: 600;\n    }\n\n    .form-header p {\n        margin: 0;\n        opacity: 0.95;\n        font-size: 16px;\n    }\n\n    .form-section {\n        padding: 25px;\n        border-bottom: 1px solid #f0f0f0;\n    }\n\n    .form-section:last-child {\n        border: none;\n    }\n\n    .form-section h3 {\n        margin: 0 0 20px;\n        font-size: 20px;\n        color: var(--text-main);\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-weight: 600;\n    }\n\n    .return-section {\n        background: var(--bg-light);\n    }\n\n    .return-section h3 {\n        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);\n        color: white;\n        padding: 12px 20px;\n        margin: -25px -25px 20px -25px;\n    }\n\n    .form-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n        gap: 15px;\n        margin-bottom: 20px;\n    }\n\n    .form-row.full-width {\n        grid-template-columns: 1fr;\n    }\n\n    .form-row.triple {\n        display: grid;\n        grid-template-columns: repeat(3, 1fr);\n        gap: 15px;\n    }\n\n    .form-group {\n        display: flex;\n        flex-direction: column;\n    }\n\n    \/* \u4fee\u6b63\uff1a\u589e\u52a0label\u8207\u6b04\u4f4d\u9593\u8ddd *\/\n    .form-group label {\n        margin-bottom: 6px; \n        color: var(--text-sub);\n        font-size: 14px;\n        font-weight: 500;\n        line-height: 1.4;\n    }\n\t.form-group label.stop-label {\n\t\tmargin-top: 15px;\n\t\tmargin-bottom: 12px;\n\t}\n\n    .form-group label .required {\n        color: var(--danger);\n    }\n\n    .form-group input,\n    .form-group select,\n    .form-group textarea {\n        padding: 10px 12px;\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n        font-size: 15px;\n        transition: all 0.2s;\n        min-height: 44px;\n        width: 100%;\n        box-sizing: border-box;\n        background: white;\n        -webkit-appearance: none;\n    }\n\n    .form-group input:focus,\n    .form-group select:focus,\n    .form-group textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(148,152,156,0.1);\n    }\n\n    \/* \u65e5\u671f\u6642\u9593\u8f38\u5165\u512a\u5316 *\/\n    input[type=\"date\"],\n    input[type=\"time\"] {\n        width: 100%;\n        max-width: 100%;\n        box-sizing: border-box;\n        -webkit-appearance: none;\n        appearance: none;\n    }\n\n    \/* Radio\u6309\u9215\u5361\u7247\u5f0f\u8a2d\u8a08 *\/\n    .radio-group {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n        margin-top: 12px; \/* \u589e\u52a0\u8207label\u7684\u9593\u8ddd *\/\n    }\n\n    .radio-item {\n        position: relative;\n        background: white;\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n        padding: 14px 16px;\n        cursor: pointer;\n        transition: all 0.2s;\n        text-align: center;\n        min-height: 50px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .radio-item:hover {\n        border-color: var(--primary);\n        background: var(--bg-light);\n        transform: translateY(-1px);\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n\n    .radio-item input[type=\"radio\"] {\n        position: absolute;\n        opacity: 0;\n        width: 0;\n        height: 0;\n    }\n\n    .radio-item label {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        font-size: 14px;\n        color: var(--text-main);\n        line-height: 1.3;\n        margin: 0 !important; \/* \u79fb\u9664radio\u5167label\u7684margin *\/\n        font-weight: 500;\n        width: 100%;\n    }\n\n    .radio-item label .price {\n        display: block;\n        font-size: 11px;\n        color: var(--text-sub);\n        margin-top: 3px;\n        font-weight: 400;\n    }\n\n    .radio-item.selected {\n        border-color: var(--primary);\n        background: var(--bg-light);\n        box-shadow: 0 0 0 2px rgba(148,152,156,0.15);\n    }\n\n    .radio-item.selected::after {\n        content: \"\u2713\";\n        position: absolute;\n        top: 6px;\n        right: 6px;\n        width: 18px;\n        height: 18px;\n        background: var(--primary);\n        color: white;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 11px;\n    }\n\n    \/* \u505c\u9760\u9ede\u5bb9\u5668 *\/\n    .stops-container {\n        margin-top: 12px;\n    }\n\n    .stop-item {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-bottom: 8px;\n        background: white;\n        padding: 8px;\n        border-radius: var(--radius);\n        border: 1px solid var(--border);\n    }\n\n    .stop-item input {\n        flex: 1;\n        min-width: 0;\n        border: none !important;\n        padding: 8px !important;\n        background: transparent !important;\n    }\n\n    .stop-controls {\n        display: flex;\n        gap: 4px;\n    }\n\n    .stop-btn {\n        width: 32px;\n        height: 32px;\n        padding: 0;\n        background: white;\n        border: 1px solid var(--border);\n        border-radius: 4px;\n        color: var(--text-sub);\n        cursor: pointer;\n        font-size: 16px;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .stop-btn:hover:not(:disabled) {\n        background: var(--primary);\n        color: white;\n        border-color: var(--primary);\n    }\n\n    .stop-btn:disabled {\n        opacity: 0.3;\n        cursor: not-allowed;\n    }\n\n    .stop-btn.delete {\n        color: var(--danger);\n    }\n\n    .stop-btn.delete:hover {\n        background: var(--danger);\n        color: white;\n        border-color: var(--danger);\n    }\n\n    .btn-add-stop {\n        padding: 10px 16px;\n        background: var(--secondary);\n        color: white;\n        border: none;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 14px;\n        transition: all 0.2s;\n        font-weight: 500;\n        margin-top: 10px;\n    }\n\n    .btn-add-stop:hover {\n        background: #968876;\n        transform: translateY(-1px);\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    }\n\n    .btn-submit {\n        background: var(--primary);\n        color: white;\n        width: 100%;\n        padding: 15px;\n        border: none;\n        border-radius: 10px;\n        font-size: 16px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.3s;\n        margin-top: 20px;\n        min-height: 50px;\n    }\n\n    .btn-submit:hover {\n        background: var(--primary-dark);\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(148,152,156,0.3);\n    }\n\n    .btn-submit:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n    }\n\n    \/* \u63d0\u793a\u6846 *\/\n    .info-box, .safety-alert {\n        background: var(--bg-light);\n        border-left: 4px solid var(--secondary);\n        padding: 14px 18px;\n        border-radius: 6px;\n        font-size: 14px;\n        line-height: 1.6;\n        color: var(--text-main);\n        margin: 20px 0;\n    }\n    \n    .safety-alert {\n        background: rgba(245, 158, 11, 0.08);\n        border-left-color: var(--warning);\n        color: #92400e;\n    }\n    \n    .safety-alert strong {\n        color: #b45309;\n    }\n\n    .email-notice {\n        font-size: 12px;\n        color: #6b7280;\n        margin-top: 5px;\n        font-style: italic;\n    }\n\n    \/* \u5373\u6642\u5831\u50f9\u9762\u677f *\/\n    #price-panel {\n        background: white;\n        border-radius: 12px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        padding: 0;\n        position: sticky;\n        top: 20px;\n        height: fit-content;\n        overflow: hidden;\n        border: 1px solid var(--border);\n    }\n\n    #price-panel h3 {\n        margin: 0;\n        padding: 20px 25px;\n        background: var(--primary);\n        color: white;\n        font-size: 18px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n\n    #price-panel h3:before {\n        content: \"\ud83d\udcb0\";\n        font-size: 20px;\n    }\n\n    .price-content {\n        padding: 20px 25px 25px;\n        background: white;\n    }\n\n    .price-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 150px;\n        color: var(--text-sub);\n        font-size: 14px;\n    }\n\n    \/* \u50f9\u683c\u9805\u76ee *\/\n    .price-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 0;\n        border-bottom: 1px solid #f3f4f6;\n        font-size: 14px;\n        transition: all 0.2s;\n    }\n\n    .price-item:hover {\n        padding-left: 5px;\n    }\n\n    .price-item span:first-child {\n        color: var(--text-main);\n        font-weight: 500;\n    }\n\n    .price-item span:last-child {\n        color: var(--primary);\n        font-weight: 600;\n        white-space: nowrap;\n    }\n\n    \/* \u7d30\u7bc0\u9805\u76ee *\/\n    .price-item.detail {\n        padding-left: 20px;\n        font-size: 13px;\n        border-bottom: 1px dashed #f9fafb;\n    }\n\n    .price-item.detail span:first-child {\n        color: var(--text-sub);\n        font-weight: 400;\n    }\n\n    .price-item.detail span:last-child {\n        color: var(--text-sub);\n    }\n\n    .price-item.free {\n        color: var(--success);\n    }\n\n    \/* \u7e3d\u8a08\u5340\u584a *\/\n    .price-total {\n        margin-top: 20px;\n        padding: 16px 14px;\n        background: var(--bg-light);\n        border-radius: 10px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border: 2px solid var(--primary);\n    }\n\n    .price-total span:first-child {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-main);\n        white-space: nowrap;\n    }\n\n    .price-total span:last-child {\n        font-size: 24px;\n        font-weight: bold;\n        color: var(--primary);\n        white-space: nowrap;\n    }\n\n    .stopover-details {\n        margin-top: 10px;\n        padding: 10px;\n        background: #f8f9fa;\n        border-radius: 4px;\n        font-size: 12px;\n    }\n\n    .stopover-details .detail-item {\n        padding: 2px 0;\n        color: #666;\n    }\n\n    .remote-area-notice {\n        margin-top: 15px;\n        padding: 10px;\n        background: #fff4e5;\n        border-left: 3px solid #ff9800;\n        border-radius: 4px;\n        color: #666;\n    }\n\n    .remote-area-notice small {\n        font-size: 12px;\n        line-height: 1.4;\n    }\n\n    .spinner {\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        border: 2px solid rgba(255,255,255,.3);\n        border-radius: 50%;\n        border-top-color: #fff;\n        animation: spin 0.8s linear infinite;\n    }\n\n    @keyframes spin {\n        to { transform: rotate(360deg); }\n    }\n\n    \/* \u97ff\u61c9\u5f0f\u8a2d\u8a08 *\/\n    @media (max-width: 1024px) {\n        .booking-container {\n            grid-template-columns: 1fr;\n        }\n        \n        #price-panel {\n            position: relative;\n            margin-top: 20px;\n        }\n    }\n\n    @media (max-width: 768px) {\n        #charter-booking-app {\n            padding: 10px;\n        }\n        \n        .form-section {\n            padding: 15px;\n        }\n        \n        .form-header {\n            padding: 20px 15px;\n        }\n        \n        .form-header h2 {\n            font-size: 22px;\n        }\n        \n        \/* \u8868\u55ae\u5217\u6539\u70ba\u55ae\u6b04 *\/\n        .form-row,\n        .form-row.triple {\n            grid-template-columns: 1fr !important;\n        }\n        \n        \/* \u624b\u6a5f\u7248radio\u6309\u9215\u4fdd\u63012\u5217 *\/\n        .radio-group {\n            grid-template-columns: 1fr 1fr;\n            gap: 8px;\n        }\n        \n        .radio-item {\n            padding: 10px 8px;\n        }\n        \n        .radio-item label {\n            font-size: 12px;\n        }\n        \n        .day-route-container {\n            padding: 15px;\n        }\n        \n        \/* \u65e5\u671f\u6b04\u4f4d\u512a\u5316 *\/\n        .day-header {\n            flex-direction: column;\n            align-items: flex-start;\n        }\n        \n        .day-date {\n            font-size: 13px;\n            word-break: break-word;\n        }\n        \n        .stop-item {\n            padding: 6px;\n            gap: 6px;\n        }\n        \n        .stop-btn {\n            width: 30px;\n            height: 30px;\n            font-size: 14px;\n        }\n        \n        .form-group input,\n        .form-group select,\n        .form-group textarea {\n            font-size: 16px;\n            padding: 12px;\n            min-height: 48px;\n        }\n        \n        \/* \u7279\u5225\u8655\u7406\u65e5\u671f\u8f38\u5165 *\/\n        input[type=\"date\"],\n        input[type=\"time\"] {\n            font-size: 16px;\n        }\n        \n        .btn-add-stop {\n            width: 100%;\n            padding: 12px;\n            font-size: 15px;\n        }\n        \n        .btn-submit {\n            padding: 16px;\n            font-size: 17px;\n            min-height: 54px;\n        }\n        \n        \/* \u50f9\u683c\u9762\u677f\u624b\u6a5f\u7248\u8abf\u6574 *\/\n        #price-panel h3 {\n            padding: 15px 20px;\n            font-size: 16px;\n        }\n        \n        .price-content {\n            padding: 15px 20px 20px;\n        }\n        \n        .price-total {\n            padding: 15px 12px;\n        }\n        \n        .price-total span:first-child {\n            font-size: 12px;\n        }\n        \n        .price-total span:last-child {\n            font-size: 20px;\n        }\n    }\n\n    @media (max-width: 380px) {\n        .form-section {\n            padding: 12px;\n        }\n        \n        .form-section h3 {\n            font-size: 18px;\n        }\n        \n        .radio-item {\n            padding: 8px 6px;\n        }\n        \n        .radio-item label {\n            font-size: 11px;\n        }\n        \n        .stop-btn {\n            width: 28px;\n            height: 28px;\n            font-size: 12px;\n        }\n        \n        .form-group label {\n            font-size: 13px;\n        }\n        \n        .price-total span:last-child {\n            font-size: 18px;\n        }\n    }\n    <\/style>\n    <?php\n});\n\n\/\/ JavaScript\nadd_action('wp_footer', function() {\n    global $post;\n    $content = isset($post->post_content) ? $post->post_content : '';\n    \n    if (!is_page('\u6a5f\u5834\u63a5\u9001\u9810\u7d04') && !is_page('airport-booking') && !has_shortcode($content, 'airport_booking_form')) {\n        return;\n    }\n    ?>\n    \n    <script type=\"text\/javascript\">\n    (function($) {\n        'use strict';\n        \n        \/\/ \u7b49\u5f85jQuery\u8f09\u5165\n        if (typeof jQuery === 'undefined') {\n            setTimeout(arguments.callee, 100);\n            return;\n        }\n        \n        $(document).ready(function() {\n            \/\/ \u5168\u57df\u914d\u7f6e\n            const CONFIG = {\n                ajaxUrl: '<?php echo admin_url(\"admin-ajax.php\"); ?>',\n                minDate: '<?php echo date(\"Y-m-d\", strtotime(\"+2 days\")); ?>',\n                maxStops: 5,\n                cities: {\n                    'taipei-city': '\u53f0\u5317\u5e02',\n                    'new-taipei': '\u65b0\u5317\u5e02',\n                    'keelung': '\u57fa\u9686\u5e02',\n                    'taoyuan': '\u6843\u5712\u5e02',\n                    'yilan': '\u5b9c\u862d\u7e23',\n                    'hsinchu-area': '\u65b0\u7af9(\u5e02\/\u7e23)',\n                    'miaoli': '\u82d7\u6817\u7e23',\n                    'taichung': '\u53f0\u4e2d\u5e02',\n                    'changhua': '\u5f70\u5316\u7e23',\n                    'nantou': '\u5357\u6295\u7e23',\n                    'yunlin': '\u96f2\u6797\u7e23',\n                    'chiayi-area': '\u5609\u7fa9(\u5e02\/\u7e23)',\n                    'tainan': '\u53f0\u5357\u5e02',\n                    'kaohsiung': '\u9ad8\u96c4\u5e02',\n                    'pingtung': '\u5c4f\u6771\u7e23',\n                    'hualien': '\u82b1\u84ee\u7e23',\n                    'taitung': '\u53f0\u6771\u7e23'\n                }\n            };\n            \n            \/\/ \u6a5f\u5834\u63a5\u9001\u61c9\u7528\u7a0b\u5f0f\n            const AirportBooking = {\n                \/\/ \u72c0\u614b\u7ba1\u7406\n                state: {\n                    stopovers: [],\n                    returnStopovers: [],\n                    calcTimeout: null,\n                    isSubmitting: false,\n                    lastTotalPrice: 0\n                },\n                \n                \/\/ \u521d\u59cb\u5316\n                init() {\n                    if (!$('#airport-booking-form').length) return false;\n                    \n                    this.buildForm();\n                    this.bindEvents();\n                    \n                    \/\/ \u5ef6\u9072\u521d\u59cb\u8a08\u7b97\n                    setTimeout(() => this.calculatePrice(), 1000);\n                    \n                    console.log('\u2705 \u6a5f\u5834\u63a5\u9001\u7cfb\u7d71 V6.3 \u5df2\u555f\u52d5');\n                    return true;\n                },\n                \n                \/\/ \u5efa\u7acb\u8868\u55ae\n                buildForm() {\n                    const formHTML = this.getFormTemplate();\n                    $('#airport-booking-form').html(formHTML);\n                },\n                \n                \/\/ \u8868\u55ae\u6a21\u677f\n                getFormTemplate() {\n                    let cityOptions = '';\n                    for (let key in CONFIG.cities) {\n                        cityOptions += `<option value=\"${key}\">${CONFIG.cities[key]}<\/option>`;\n                    }\n                    \n                    return `\n                        <div class=\"form-header\">\n                            <h2>\u2708\ufe0f \u6a5f\u5834\u63a5\u9001\u9810\u7d04<\/h2>\n                            <p>\u5c08\u696d\u53f8\u6a5f\u00b7\u8212\u9069\u4e58\u5750\u00b7\u6e96\u6642\u5b89\u5168<\/p>\n                        <\/div>\n                        \n                        <div class=\"form-section\">\n                            <h3>\ud83d\udccd \u57fa\u672c\u8cc7\u8a0a<\/h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u6a5f\u5834\u9078\u64c7 <span class=\"required\">*<\/span><\/label>\n                                    <select name=\"airport\" id=\"airport\" required>\n                                        <option value=\"tpe\">\u6843\u5712\u570b\u969b\u6a5f\u5834<\/option>\n                                        <option value=\"tsa\">\u53f0\u5317\u677e\u5c71\u6a5f\u5834<\/option>\n                                    <\/select>\n                                <\/div>\n                                <div class=\"form-group\">\n                                    <label>\u76ee\u7684\u5730\u7e23\u5e02 <span class=\"required\">*<\/span><\/label>\n                                    <select name=\"destination\" id=\"destination\" required>\n                                        ${cityOptions}\n                                    <\/select>\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u884c\u7a0b\u985e\u578b<\/label>\n                                    <div class=\"radio-group\">\n                                        <div class=\"radio-item\">\n                                            <input type=\"radio\" name=\"trip_type\" value=\"oneway\" id=\"trip_oneway\" checked>\n                                            <label for=\"trip_oneway\">\u55ae\u7a0b<\/label>\n                                        <\/div>\n                                        <div class=\"radio-item\">\n                                            <input type=\"radio\" name=\"trip_type\" value=\"roundtrip\" id=\"trip_roundtrip\">\n                                            <label for=\"trip_roundtrip\">\u4f86\u56de<\/label>\n                                        <\/div>\n                                    <\/div>\n                                <\/div>\n                                <div class=\"form-group\">\n                                    <label>\u670d\u52d9\u985e\u578b <span class=\"required\">*<\/span><\/label>\n                                    <div class=\"radio-group\">\n                                        <div class=\"radio-item\">\n                                            <input type=\"radio\" name=\"service_type\" value=\"pickup\" id=\"service_pickup\" checked>\n                                            <label for=\"service_pickup\">\u63a5\u6a5f<\/label>\n                                        <\/div>\n                                        <div class=\"radio-item\">\n                                            <input type=\"radio\" name=\"service_type\" value=\"dropoff\" id=\"service_dropoff\">\n                                            <label for=\"service_dropoff\">\u9001\u6a5f<\/label>\n                                        <\/div>\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                        \n                        <div class=\"form-section\">\n                            <h3>\ud83d\uddd3\ufe0f \u53bb\u7a0b\u8cc7\u8a0a<\/h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u65e5\u671f <span class=\"required\">*<\/span> (\u81f3\u5c11\u63d0\u524d2\u5929)<\/label>\n                                    <input type=\"date\" name=\"date\" id=\"date\" \n                                           min=\"${CONFIG.minDate}\" value=\"${CONFIG.minDate}\" required>\n                                <\/div>\n                                <div class=\"form-group\">\n                                    <label>\u6642\u9593 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"time\" name=\"time\" id=\"time\" value=\"10:00\" required>\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-row full-width\">\n                                <div class=\"form-group\">\n                                    <label>\u822a\u73ed\u865f\u78bc<\/label>\n                                    <input type=\"text\" name=\"flight\" id=\"flight\" placeholder=\"\u4f8b\uff1aBR123\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"pickup-fields\">\n                                <div class=\"form-group\">\n                                    <label>\u4e0b\u8eca\u5730\u5740 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"text\" name=\"dropoff_address\" id=\"dropoff_address\" \n                                           placeholder=\"\u8acb\u8f38\u5165\u5b8c\u6574\u5730\u5740\uff08\u542b\u7e23\u5e02\u5340\uff09\uff0c\u4f8b\u5982\uff1a\u53f0\u5317\u5e02\u4fe1\u7fa9\u5340\u5e02\u5e9c\u8def45\u865f3\u6a13\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"dropoff-fields\" style=\"display:none;\">\n                                <div class=\"form-group\">\n                                    <label>\u4e0a\u8eca\u5730\u5740 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"text\" name=\"pickup_address\" id=\"pickup_address\" \n                                           placeholder=\"\u8acb\u8f38\u5165\u5b8c\u6574\u5730\u5740\uff08\u542b\u7e23\u5e02\u5340\uff09\uff0c\u4f8b\u5982\uff1a\u53f0\u5317\u5e02\u4fe1\u7fa9\u5340\u5e02\u5e9c\u8def45\u865f3\u6a13\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-group\">\n                                <label class=\"stop-label\">\u505c\u9760\u9ede\uff08\u9078\u586b\uff0c\u6700\u591a${CONFIG.maxStops}\u500b\uff09<\/label>\n                                <div class=\"stops-container\" id=\"stops-container\"><\/div>\n                                <button type=\"button\" class=\"btn-add-stop\" id=\"add-stopover\">\n                                    + \u65b0\u589e\u505c\u9760\u9ede\n                                <\/button>\n                            <\/div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u4e58\u5ba2\u4eba\u6578 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"number\" name=\"passengers\" id=\"passengers\" \n                                           min=\"1\" max=\"8\" value=\"1\" required>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                        \n                        <div class=\"form-section return-section\" style=\"display:none;\">\n                            <h3>\ud83d\udd04 \u56de\u7a0b\u8cc7\u8a0a<\/h3>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u56de\u7a0b\u65e5\u671f <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"date\" name=\"return_date\" id=\"return_date\" \n                                           min=\"${CONFIG.minDate}\">\n                                <\/div>\n                                <div class=\"form-group\">\n                                    <label>\u56de\u7a0b\u6642\u9593 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"time\" name=\"return_time\" id=\"return_time\" value=\"10:00\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-row full-width\">\n                                <div class=\"form-group\">\n                                    <label>\u56de\u7a0b\u822a\u73ed\u865f\u78bc<\/label>\n                                    <input type=\"text\" name=\"return_flight\" id=\"return_flight\" placeholder=\"\u4f8b\uff1aBR124\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"return-pickup-fields\" style=\"display:none;\">\n                                <div class=\"form-group\">\n                                    <label class=\"return-pickup-label\">\u56de\u7a0b\u4e0a\u8eca\u5730\u5740 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"text\" name=\"return_pickup_address\" id=\"return_pickup_address\" \n                                           placeholder=\"\u8acb\u8f38\u5165\u5b8c\u6574\u5730\u5740\uff08\u542b\u7e23\u5e02\u5340\uff09\uff0c\u4f8b\u5982\uff1a\u53f0\u5317\u5e02\u4fe1\u7fa9\u5340\u5e02\u5e9c\u8def45\u865f3\u6a13\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"return-dropoff-fields\">\n                                <div class=\"form-group\">\n                                    <label class=\"return-dropoff-label\">\u56de\u7a0b\u4e0b\u8eca\u5730\u5740 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"text\" name=\"return_dropoff_address\" id=\"return_dropoff_address\" \n                                           placeholder=\"\u8acb\u8f38\u5165\u5b8c\u6574\u5730\u5740\uff08\u542b\u7e23\u5e02\u5340\uff09\uff0c\u4f8b\u5982\uff1a\u53f0\u5317\u5e02\u4fe1\u7fa9\u5340\u5e02\u5e9c\u8def45\u865f3\u6a13\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-group\">\n                                <label class=\"stop-label\">\u56de\u7a0b\u505c\u9760\u9ede\uff08\u9078\u586b\uff0c\u6700\u591a${CONFIG.maxStops}\u500b\uff09<\/label>\n                                <div class=\"stops-container\" id=\"return-stops-container\"><\/div>\n                                <button type=\"button\" class=\"btn-add-stop\" id=\"add-return-stopover\">\n                                    + \u65b0\u589e\u56de\u7a0b\u505c\u9760\u9ede\n                                <\/button>\n                            <\/div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u56de\u7a0b\u4e58\u5ba2\u4eba\u6578 <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"number\" name=\"return_passengers\" id=\"return_passengers\" \n                                           min=\"1\" max=\"8\" value=\"1\">\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                        \n                        <div class=\"form-section\">\n                            <h3>\ud83d\udee0\ufe0f \u52a0\u8cfc\u9805\u76ee<\/h3>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u8209\u724c\u670d\u52d9<\/label>\n                                    <div class=\"radio-group\">\n                                        <div class=\"radio-item\">\n                                            <input type=\"radio\" name=\"name_board\" value=\"no\" id=\"board_no\" checked>\n                                            <label for=\"board_no\">\n                                                \u4e0d\u9700\u8981\n                                            <\/label>\n                                        <\/div>\n                                        <div class=\"radio-item\">\n                                            <input type=\"radio\" name=\"name_board\" value=\"yes\" id=\"board_yes\">\n                                            <label for=\"board_yes\">\n                                                \u9700\u8981\u8209\u724c\n                                                <span class=\"price\">+200\u5143<\/span>\n                                            <\/label>\n                                        <\/div>\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"safety-alert\">\n                                \u6839\u64da\u300a\u5c0f\u578b\u8eca\u9644\u8f09\u5e7c\u7ae5\u5b89\u5168\u4e58\u5750\u5be6\u65bd\u53ca\u5ba3\u5c0e\u8fa6\u6cd5\u300b\uff0c<strong>4\u6b72\u4ee5\u4e0b\u5b69\u7ae5\u7686\u9700\u4f7f\u7528\u5b89\u5168\u5ea7\u6905<\/strong>\n                            <\/div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u5b30\u5152\u5b89\u5168\u5ea7\u6905 (\u6bcf\u5f35NT$100)<\/label>\n                                    <input type=\"number\" name=\"child_seats\" id=\"child_seats\" \n                                           min=\"0\" max=\"4\" value=\"0\">\n                                <\/div>\n                                <div class=\"form-group\">\n                                    <label>\u5152\u7ae5\u589e\u9ad8\u588a (\u6bcf\u5f35NT$100)<\/label>\n                                    <input type=\"number\" name=\"booster_seats\" id=\"booster_seats\" \n                                           min=\"0\" max=\"4\" value=\"0\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"return-section\" style=\"display:none;\">\n                                <div class=\"form-row\">\n                                    <div class=\"form-group\">\n                                        <label>\u56de\u7a0b\u8209\u724c\u670d\u52d9<\/label>\n                                        <div class=\"radio-group\">\n                                            <div class=\"radio-item\">\n                                                <input type=\"radio\" name=\"return_name_board\" value=\"no\" id=\"return_board_no\" checked>\n                                                <label for=\"return_board_no\">\u4e0d\u9700\u8981<\/label>\n                                            <\/div>\n                                            <div class=\"radio-item\">\n                                                <input type=\"radio\" name=\"return_name_board\" value=\"yes\" id=\"return_board_yes\">\n                                                <label for=\"return_board_yes\">\n                                                    \u9700\u8981\u8209\u724c\n                                                    <span class=\"price\">+200\u5143<\/span>\n                                                <\/label>\n                                            <\/div>\n                                        <\/div>\n                                    <\/div>\n                                <\/div>\n                                \n                                <div class=\"form-row\">\n                                    <div class=\"form-group\">\n                                        <label>\u56de\u7a0b\u5b30\u5152\u5b89\u5168\u5ea7\u6905 (\u6bcf\u5f35NT$100)<\/label>\n                                        <input type=\"number\" name=\"return_child_seats\" id=\"return_child_seats\" \n                                               min=\"0\" max=\"4\" value=\"0\">\n                                    <\/div>\n                                    <div class=\"form-group\">\n                                        <label>\u56de\u7a0b\u5152\u7ae5\u589e\u9ad8\u588a (\u6bcf\u5f35NT$100)<\/label>\n                                        <input type=\"number\" name=\"return_booster_seats\" id=\"return_booster_seats\" \n                                               min=\"0\" max=\"4\" value=\"0\">\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                        \n                        <div class=\"form-section\">\n                            <h3>\ud83d\udcde \u806f\u7d61\u8cc7\u8a0a<\/h3>\n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u59d3\u540d <span class=\"required\">*<\/span><\/label>\n                                    <input type=\"text\" name=\"customer_name\" \n                                           placeholder=\"\u8acb\u8f38\u5165\u60a8\u7684\u59d3\u540d\" required>\n                                <\/div>\n                                <div class=\"form-group\">\n                                    <label>\u96fb\u8a71 <span class=\"required\">*<\/span> (\u542b\u570b\u969b\u5340\u865f)<\/label>\n                                    <input type=\"tel\" name=\"customer_phone\" \n                                           placeholder=\"+886912345678 \u6216 0912345678\" required\n                                           pattern=\"(\\\\+[0-9]{1,4})?[0-9]{9,15}\"\n                                           title=\"\u8acb\u8f38\u5165\u6709\u6548\u96fb\u8a71\u865f\u78bc\uff0c\u53ef\u542b\u570b\u969b\u5340\u865f\">\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-row full-width\">\n                                <div class=\"form-group\">\n                                    <label>Email\uff08\u9078\u586b\uff09<\/label>\n                                    <input type=\"email\" name=\"customer_email\" \n                                           placeholder=\"example@email.com\">\n                                    <span class=\"email-notice\">\u203b \u672a\u586b\u5beb\u5c07\u4e0d\u6703\u6536\u5230\u78ba\u8a8d\u4fe1\u4ef6\u901a\u77e5<\/span>\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-row full-width\">\n                                <div class=\"form-group\">\n                                    <label>\u5099\u8a3b<\/label>\n                                    <textarea name=\"notes\" rows=\"3\" \n                                             placeholder=\"\u7279\u6b8a\u9700\u6c42\u6216\u5099\u8a3b\u4e8b\u9805...\"><\/textarea>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                        \n                        <button type=\"submit\" class=\"btn-submit\">\u7acb\u5373\u9810\u7d04<\/button>\n                    `;\n                },\n                \n                \/\/ \u65b0\u589e\u505c\u9760\u9ede\n                addStop(containerId, address = '') {\n                    const container = $(`#${containerId}`);\n                    const stops = container.find('.stop-item').length;\n                    \n                    if (stops >= CONFIG.maxStops) {\n                        alert(`\u6700\u591a\u53ea\u80fd\u65b0\u589e${CONFIG.maxStops}\u500b\u505c\u9760\u9ede`);\n                        return;\n                    }\n                    \n                    const stopId = `${containerId}_stop_${stops}`;\n                    const stopHTML = `\n                        <div class=\"stop-item\" data-index=\"${stops}\">\n                            <input type=\"text\" id=\"${stopId}\" class=\"stop-input\"\n                                   placeholder=\"\u505c\u9760\u9ede ${stops + 1} - \u8acb\u8f38\u5165\u5b8c\u6574\u5730\u5740\uff08\u542b\u7e23\u5e02\uff09\" \n                                   value=\"${address}\">\n                            <div class=\"stop-controls\">\n                                <button type=\"button\" class=\"stop-btn\" data-action=\"up\" \n                                        data-container=\"${containerId}\" ${stops === 0 ? 'disabled' : ''}>\u2191<\/button>\n                                <button type=\"button\" class=\"stop-btn\" data-action=\"down\" \n                                        data-container=\"${containerId}\" disabled>\u2193<\/button>\n                                <button type=\"button\" class=\"stop-btn delete\" data-action=\"delete\" \n                                        data-container=\"${containerId}\">\u00d7<\/button>\n                            <\/div>\n                        <\/div>\n                    `;\n                    \n                    container.append(stopHTML);\n                    this.updateStopButtons(containerId);\n                },\n                \n                \/\/ \u66f4\u65b0\u505c\u9760\u9ede\u6309\u9215\u72c0\u614b\n                updateStopButtons(containerId) {\n                    const items = $(`#${containerId} .stop-item`);\n                    \n                    items.each(function(index) {\n                        const $item = $(this);\n                        $item.attr('data-index', index);\n                        $item.find('.stop-input').attr('placeholder', `\u505c\u9760\u9ede ${index + 1} - \u8acb\u8f38\u5165\u5b8c\u6574\u5730\u5740\uff08\u542b\u7e23\u5e02\uff09`);\n                        \n                        const $upBtn = $item.find('[data-action=\"up\"]');\n                        const $downBtn = $item.find('[data-action=\"down\"]');\n                        \n                        $upBtn.prop('disabled', index === 0);\n                        $downBtn.prop('disabled', index === items.length - 1);\n                    });\n                    \n                    \/\/ \u66f4\u65b0\u72c0\u614b\n                    if (containerId === 'stops-container') {\n                        this.state.stopovers = items.map((i, el) => ({\n                            address: $(el).find('.stop-input').val()\n                        })).get();\n                    } else {\n                        this.state.returnStopovers = items.map((i, el) => ({\n                            address: $(el).find('.stop-input').val()\n                        })).get();\n                    }\n                },\n                \n                \/\/ \u66f4\u65b0Radio\u6a23\u5f0f\n                updateRadioStyles() {\n                    $('.radio-item input[type=\"radio\"]:checked').closest('.radio-item').addClass('selected');\n                },\n                \n                \/\/ \u9632\u6296\u8a08\u7b97\n                debouncedCalc() {\n                    clearTimeout(this.state.calcTimeout);\n                    this.state.calcTimeout = setTimeout(() => this.calculatePrice(), 500);\n                },\n                \n                \/\/ \u8a08\u7b97\u50f9\u683c\n                calculatePrice() {\n                    \/\/ \u6536\u96c6\u505c\u9760\u9ede\n                    const stopovers = [];\n                    $('#stops-container .stop-input').each(function() {\n                        const val = $(this).val().trim();\n                        if (val) stopovers.push({address: val});\n                    });\n                    \n                    const returnStopovers = [];\n                    $('#return-stops-container .stop-input').each(function() {\n                        const val = $(this).val().trim();\n                        if (val) returnStopovers.push({address: val});\n                    });\n                    \n                    \/\/ \u6e96\u5099\u8cc7\u6599\n                    const formData = $('#airport-booking-form').serialize();\n                    const ajaxData = formData + \n                        '&action=calculate_airport_price' +\n                        '&stopovers=' + encodeURIComponent(JSON.stringify(stopovers)) +\n                        '&return_stopovers=' + encodeURIComponent(JSON.stringify(returnStopovers));\n                    \n                    \/\/ \u986f\u793a\u8f09\u5165\u4e2d\n                    $('#price-panel .price-content').html('<div class=\"price-loading\">\u8a08\u7b97\u4e2d...<\/div>');\n                    \n                    \/\/ AJAX \u8acb\u6c42\n                    $.post(CONFIG.ajaxUrl, ajaxData)\n                        .done(response => {\n                            if (response?.success && response.data) {\n                                this.displayPrice(response.data);\n                                this.state.lastTotalPrice = response.data.total;\n                            } else {\n                                $('#price-panel .price-content').html('<div>\u8a08\u7b97\u5931\u6557<\/div>');\n                            }\n                        })\n                        .fail(() => {\n                            $('#price-panel .price-content').html('<div>\u7cfb\u7d71\u932f\u8aa4<\/div>');\n                        });\n                },\n                \n                \/\/ \u986f\u793a\u50f9\u683c\n                displayPrice(data) {\n                    let html = '';\n                    \n                    if (data.breakdown) {\n                        \/\/ \u57fa\u672c\u8cbb\u7528\n                        if (data.breakdown.base_price > 0) {\n                            html += `\n                                <div class=\"price-item\">\n                                    <span>\u57fa\u672c\u8cbb\u7528<\/span>\n                                    <span>NT$ ${data.breakdown.base_price.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                        \n                        \/\/ \u591c\u9593\u52a0\u50f9\n                        if (data.breakdown.night_surcharge > 0) {\n                            html += `\n                                <div class=\"price-item\">\n                                    <span>\u591c\u9593\u52a0\u50f9 (22:00-08:00)<\/span>\n                                    <span>NT$ ${data.breakdown.night_surcharge.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                        \n                        \/\/ \u504f\u9060\u5730\u5340\u52a0\u50f9\n                        if (data.breakdown.remote_surcharge > 0) {\n                            html += `\n                                <div class=\"price-item\">\n                                    <span>\u504f\u9060\u5730\u5340\u52a0\u50f9<\/span>\n                                    <span>NT$ ${data.breakdown.remote_surcharge.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                        \n                        \/\/ \u53bb\u7a0b\u505c\u9760\u9ede\u8cbb\u7528\n                        if (data.breakdown.stopover_charge > 0) {\n                            html += `\n                                <div class=\"price-item\">\n                                    <span>\u53bb\u7a0b\u505c\u9760\u9ede\u8cbb\u7528<\/span>\n                                    <span>NT$ ${data.breakdown.stopover_charge.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                            \n                            \/\/ \u986f\u793a\u53bb\u7a0b\u505c\u9760\u9ede\u8a73\u60c5\n                            if (data.breakdown.stopover_details && data.breakdown.stopover_details.length > 0) {\n                                html += '<div class=\"stopover-details\">';\n                                data.breakdown.stopover_details.forEach(function(detail) {\n                                    const chargeText = detail.charged ? \n                                        'NT$ ' + detail.fee : \n                                        '\u514d\u8cbb\uff08\u4e0d\u8a08\u8cbb\u8def\u6bb5\uff09';\n                                    const className = detail.charged ? '' : 'free';\n                                    \n                                    html += `\n                                        <div class=\"detail-item ${className}\">\n                                            ${detail.segment}: ${detail.distance}km - ${chargeText}\n                                        <\/div>\n                                    `;\n                                });\n                                html += '<\/div>';\n                            }\n                        }\n                        \n                        \/\/ \u53bb\u7a0b\u52a0\u8cfc\u9805\u76ee\n                        if (data.breakdown.addon_charge > 0) {\n                            html += `\n                                <div class=\"price-item\">\n                                    <span>\u53bb\u7a0b\u52a0\u8cfc\u9805\u76ee<\/span>\n                                    <span>NT$ ${data.breakdown.addon_charge.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                            \n                            \/\/ \u986f\u793a\u8209\u724c\u670d\u52d9\n                            if (data.breakdown.name_board_charge > 0) {\n                                html += `\n                                    <div class=\"price-item detail\">\n                                        <span>\u8209\u724c\u670d\u52d9<\/span>\n                                        <span>NT$ 200<\/span>\n                                    <\/div>\n                                `;\n                            }\n                        }\n                        \n                        \/\/ \u5982\u679c\u662f\u4f86\u56de\u7a0b\n                        if (data.breakdown.return_subtotal !== undefined) {\n                            html += `\n                                <div class=\"price-item\" style=\"margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd;\">\n                                    <span style=\"font-weight: 600;\">\u56de\u7a0b\u8cbb\u7528<\/span>\n                                    <span><\/span>\n                                <\/div>\n                            `;\n                            \n                            \/\/ \u56de\u7a0b\u57fa\u672c\u8cbb\u7528\n                            html += `\n                                <div class=\"price-item detail\">\n                                    <span>\u56de\u7a0b\u57fa\u672c\u8cbb\u7528<\/span>\n                                    <span>NT$ ${data.breakdown.base_price.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                            \n                            \/\/ \u56de\u7a0b\u504f\u9060\u5730\u5340\u52a0\u50f9\n                            if (data.breakdown.return_remote_surcharge > 0) {\n                                html += `\n                                    <div class=\"price-item detail\">\n                                        <span>\u56de\u7a0b\u504f\u9060\u5730\u5340\u52a0\u50f9<\/span>\n                                        <span>NT$ ${data.breakdown.return_remote_surcharge.toLocaleString()}<\/span>\n                                    <\/div>\n                                `;\n                            }\n                            \n                            \/\/ \u56de\u7a0b\u505c\u9760\u9ede\u8cbb\u7528\n                            if (data.breakdown.return_stopover_charge > 0) {\n                                html += `\n                                    <div class=\"price-item detail\">\n                                        <span>\u56de\u7a0b\u505c\u9760\u9ede\u8cbb\u7528<\/span>\n                                        <span>NT$ ${data.breakdown.return_stopover_charge.toLocaleString()}<\/span>\n                                    <\/div>\n                                `;\n                                \n                                \/\/ \u986f\u793a\u56de\u7a0b\u505c\u9760\u9ede\u8a73\u60c5\n                                if (data.breakdown.return_stopover_details && data.breakdown.return_stopover_details.length > 0) {\n                                    html += '<div class=\"stopover-details\">';\n                                    data.breakdown.return_stopover_details.forEach(function(detail) {\n                                        const chargeText = detail.charged ? \n                                            'NT$ ' + detail.fee : \n                                            '\u514d\u8cbb\uff08\u4e0d\u8a08\u8cbb\u8def\u6bb5\uff09';\n                                        const className = detail.charged ? '' : 'free';\n                                        \n                                        html += `\n                                            <div class=\"detail-item ${className}\">\n                                                ${detail.segment}: ${detail.distance}km - ${chargeText}\n                                            <\/div>\n                                        `;\n                                    });\n                                    html += '<\/div>';\n                                }\n                            }\n                            \n                            \/\/ \u56de\u7a0b\u52a0\u8cfc\u9805\u76ee\n                            if (data.breakdown.return_addon > 0) {\n                                html += `\n                                    <div class=\"price-item detail\">\n                                        <span>\u56de\u7a0b\u52a0\u8cfc\u9805\u76ee<\/span>\n                                        <span>NT$ ${data.breakdown.return_addon.toLocaleString()}<\/span>\n                                    <\/div>\n                                `;\n                            }\n                            \n                            \/\/ \u539f\u59cb\u7e3d\u50f9\uff08\u4f86\u56de\u7a0b\u6298\u6263\u524d\uff09\n                            if (data.breakdown.original_total !== undefined) {\n                                html += `\n                                    <div class=\"price-item\" style=\"margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;\">\n                                        <span>\u539f\u59cb\u7e3d\u50f9<\/span>\n                                        <span style=\"text-decoration: line-through; color: #999;\">\n                                            NT$ ${data.breakdown.original_total.toLocaleString()}\n                                        <\/span>\n                                    <\/div>\n                                `;\n                            }\n                            \n                            \/\/ \u4f86\u56de\u6298\u6263\n                            if (data.breakdown.discount && data.breakdown.discount < 0) {\n                                html += `\n                                    <div class=\"price-item\">\n                                        <span style=\"color: #16a34a; font-weight: 600;\">\u4f86\u56de\u7a0b9\u6298\u512a\u60e0<\/span>\n                                        <span style=\"color: #16a34a;\">\n                                            -NT$ ${Math.abs(data.breakdown.discount).toLocaleString()}\n                                        <\/span>\n                                    <\/div>\n                                `;\n                            }\n                        }\n                    }\n                    \n                    \/\/ \u7e3d\u8a08\n                    html += `\n                        <div class=\"price-total\">\n                            <span>\u7e3d\u8a08(\u542b\u7a05)<\/span>\n                            <span>NT$ ${(data.total || 0).toLocaleString()}<\/span>\n                        <\/div>\n                    `;\n                    \n                    \/\/ \u504f\u9060\u5730\u5340\u63d0\u793a\n                    if ((data.breakdown && data.breakdown.remote_surcharge > 0) || \n                        (data.breakdown && data.breakdown.return_remote_surcharge > 0)) {\n                        html += `\n                            <div class=\"remote-area-notice\">\n                                <small>\ud83d\udccd \u60a8\u7684\u76ee\u7684\u5730\u4f4d\u65bc\u504f\u9060\u5730\u5340\uff0c\u5df2\u81ea\u52d5\u52a0\u6536\u504f\u9060\u5730\u5340\u670d\u52d9\u8cbb<\/small>\n                            <\/div>\n                        `;\n                    }\n                    \n                    $('#price-panel .price-content').html(html);\n                },\n                \n                \/\/ \u7d81\u5b9a\u4e8b\u4ef6 - \u4fee\u6b63\u7248\n                bindEvents() {\n                    const self = this;\n                    \n                    \/\/ \u4f7f\u7528\u4e8b\u4ef6\u59d4\u6d3e\u6e1b\u5c11\u7d81\u5b9a\u6578\u91cf\n                    $(document)\n                        \/\/ \u670d\u52d9\u985e\u578b\u5207\u63db - \u4fee\u6b63\u56de\u7a0b\u908f\u8f2f\n                        .on('change', '[name=\"service_type\"]', function() {\n                            const isPickup = $(this).val() === 'pickup';\n                            \n                            \/\/ \u53bb\u7a0b\u6b04\u4f4d\u986f\u793a\u908f\u8f2f\n                            $('.pickup-fields').toggle(isPickup);\n                            $('.dropoff-fields').toggle(!isPickup);\n                            \n                            \/\/ \u56de\u7a0b\u6b04\u4f4d\u986f\u793a\u908f\u8f2f\uff08\u76f8\u53cd\uff09\n                            \/\/ \u5982\u679c\u53bb\u7a0b\u662f\u300c\u63a5\u6a5f\u300d\uff0c\u5247\u56de\u7a0b\u662f\u300c\u9001\u6a5f\u300d\uff0c\u9700\u8981\u4f7f\u7528\u8005\u586b\u5beb\u56de\u7a0b\u7684\u300c\u4e0a\u8eca\u5730\u5740\u300d\n                            $('.return-pickup-fields').toggle(!isPickup);\n                            \/\/ \u5982\u679c\u53bb\u7a0b\u662f\u300c\u9001\u6a5f\u300d\uff0c\u5247\u56de\u7a0b\u662f\u300c\u63a5\u6a5f\u300d\uff0c\u9700\u8981\u4f7f\u7528\u8005\u586b\u5beb\u56de\u7a0b\u7684\u300c\u4e0b\u8eca\u5730\u5740\u300d\n                            $('.return-dropoff-fields').toggle(isPickup);\n                            \n                            \/\/ \u66f4\u65b0\u56de\u7a0b\u6a19\u7c64\u6587\u5b57\n                            if (isPickup) {\n                                \/\/ \u53bb\u7a0b\u63a5\u6a5f\uff0c\u56de\u7a0b\u9001\u6a5f\n                                $('.return-pickup-label').html('\u56de\u7a0b\u4e0a\u8eca\u5730\u5740 <span class=\"required\">*<\/span>');\n                            } else {\n                                \/\/ \u53bb\u7a0b\u9001\u6a5f\uff0c\u56de\u7a0b\u63a5\u6a5f\n                                $('.return-dropoff-label').html('\u56de\u7a0b\u4e0b\u8eca\u5730\u5740 <span class=\"required\">*<\/span>');\n                            }\n                            \n                            self.debouncedCalc();\n                        })\n                        \n                        \/\/ \u884c\u7a0b\u985e\u578b\u5207\u63db\n                        .on('change', '[name=\"trip_type\"]', function() {\n                            const isRoundtrip = $(this).val() === 'roundtrip';\n                            $('.return-section').toggle(isRoundtrip);\n                            \n                            if (isRoundtrip) {\n                                const goDate = $('#date').val();\n                                if (goDate) {\n                                    const returnDate = new Date(goDate);\n                                    returnDate.setDate(returnDate.getDate() + 7);\n                                    $('#return_date').val(returnDate.toISOString().split('T')[0]);\n                                }\n                                \n                                $('#return_passengers').val($('#passengers').val());\n                                $('#return_child_seats').val($('#child_seats').val());\n                                $('#return_booster_seats').val($('#booster_seats').val());\n                                \n                                \/\/ \u89f8\u767c\u670d\u52d9\u985e\u578b\u8b8a\u66f4\u4ee5\u66f4\u65b0\u6a19\u7c64\n                                $('[name=\"service_type\"]:checked').trigger('change');\n                            }\n                            \n                            self.debouncedCalc();\n                        })\n                        \n                        \/\/ \u65b0\u589e\u505c\u9760\u9ede\n                        .on('click', '#add-stopover', function() {\n                            self.addStop('stops-container');\n                            self.debouncedCalc();\n                        })\n                        .on('click', '#add-return-stopover', function() {\n                            self.addStop('return-stops-container');\n                            self.debouncedCalc();\n                        })\n                        \n                        \/\/ \u505c\u9760\u9ede\u64cd\u4f5c\u6309\u9215\n                        .on('click', '.stop-btn', function() {\n                            const $btn = $(this);\n                            const action = $btn.data('action');\n                            const containerId = $btn.data('container');\n                            const $item = $btn.closest('.stop-item');\n                            const itemIndex = $item.index();\n                            \n                            if (action === 'delete') {\n                                $item.fadeOut(200, function() {\n                                    $(this).remove();\n                                    self.updateStopButtons(containerId);\n                                    self.debouncedCalc();\n                                });\n                            } else if (action === 'up' && itemIndex > 0) {\n                                $item.insertBefore($item.prev());\n                                self.updateStopButtons(containerId);\n                                self.debouncedCalc();\n                            } else if (action === 'down' && itemIndex < $item.siblings().length) {\n                                $item.insertAfter($item.next());\n                                self.updateStopButtons(containerId);\n                                self.debouncedCalc();\n                            }\n                        })\n                        \n                        \/\/ Radio\u6a23\u5f0f\u66f4\u65b0\n                        .on('change', '.radio-item input[type=\"radio\"]', function() {\n                            const name = $(this).attr('name');\n                            $(`.radio-item input[name=\"${name}\"]`).closest('.radio-item').removeClass('selected');\n                            $(this).closest('.radio-item').addClass('selected');\n                        })\n                        \n                        \/\/ \u50f9\u683c\u8a08\u7b97\u89f8\u767c\n                        .on('change', '#airport, #destination, #date, #time, #passengers, ' +\n                            '#child_seats, #booster_seats, [name=\"name_board\"], ' +\n                            '#return_date, #return_time, #return_passengers, ' +\n                            '#return_child_seats, #return_booster_seats, [name=\"return_name_board\"], ' +\n                            '#pickup_address, #dropoff_address, #return_pickup_address, #return_dropoff_address', \n                            function() {\n                                self.debouncedCalc();\n                            }\n                        )\n                        \n                        \/\/ \u505c\u9760\u9ede\u5730\u5740\u8b8a\u66f4\n                        .on('blur', '.stop-input', function() {\n                            self.debouncedCalc();\n                        });\n                    \n                    \/\/ \u8868\u55ae\u63d0\u4ea4\n                    $('#airport-booking-form').on('submit', function(e) {\n                        e.preventDefault();\n                        self.submitBooking();\n                    });\n                    \n                    \/\/ \u521d\u59cb\u5316Radio\u6a23\u5f0f\n                    setTimeout(() => {\n                        $('.radio-item input[type=\"radio\"]:checked').trigger('change');\n                    }, 100);\n                },\n                \n                \/\/ \u63d0\u4ea4\u9810\u7d04\n                submitBooking() {\n                    if (this.state.isSubmitting) return;\n                    \n                    \/\/ \u9a57\u8b49\u8868\u55ae\n                    const form = $('#airport-booking-form')[0];\n                    const emailField = $('[name=\"customer_email\"]');\n                    \n                    emailField.removeAttr('required');\n                    \n                    if (!form.checkValidity()) {\n                        form.reportValidity();\n                        return;\n                    }\n                    \n                    \/\/ \u5982\u679c\u662f\u4f86\u56de\u7a0b\uff0c\u9a57\u8b49\u56de\u7a0b\u5fc5\u586b\u6b04\u4f4d\n                    if ($('[name=\"trip_type\"]:checked').val() === 'roundtrip') {\n                        const returnRequired = ['#return_date', '#return_time'];\n                        let hasError = false;\n                        \n                        returnRequired.forEach(function(field) {\n                            if (!$(field).val()) {\n                                $(field).focus();\n                                alert('\u8acb\u586b\u5beb\u56de\u7a0b\u8cc7\u8a0a');\n                                hasError = true;\n                                return false;\n                            }\n                        });\n                        \n                        if (hasError) return;\n                        \n                        \/\/ \u9a57\u8b49\u56de\u7a0b\u5730\u5740\n                        const serviceType = $('[name=\"service_type\"]:checked').val();\n                        if (serviceType === 'pickup') {\n                            \/\/ \u53bb\u7a0b\u63a5\u6a5f\uff0c\u56de\u7a0b\u9700\u8981\u4e0a\u8eca\u5730\u5740\n                            if (!$('#return_pickup_address').val()) {\n                                $('#return_pickup_address').focus();\n                                alert('\u8acb\u586b\u5beb\u56de\u7a0b\u4e0a\u8eca\u5730\u5740');\n                                return;\n                            }\n                        } else {\n                            \/\/ \u53bb\u7a0b\u9001\u6a5f\uff0c\u56de\u7a0b\u9700\u8981\u4e0b\u8eca\u5730\u5740\n                            if (!$('#return_dropoff_address').val()) {\n                                $('#return_dropoff_address').focus();\n                                alert('\u8acb\u586b\u5beb\u56de\u7a0b\u4e0b\u8eca\u5730\u5740');\n                                return;\n                            }\n                        }\n                    }\n                    \n                    this.state.isSubmitting = true;\n                    $('.btn-submit').prop('disabled', true).html('<span class=\"spinner\"><\/span> \u8655\u7406\u4e2d...');\n                    \n                    \/\/ \u6536\u96c6\u505c\u9760\u9ede\n                    const stopovers = [];\n                    $('#stops-container .stop-input').each(function() {\n                        const val = $(this).val().trim();\n                        if (val) stopovers.push({address: val});\n                    });\n                    \n                    const returnStopovers = [];\n                    $('#return-stops-container .stop-input').each(function() {\n                        const val = $(this).val().trim();\n                        if (val) returnStopovers.push({address: val});\n                    });\n                    \n                    \/\/ \u6e96\u5099\u8cc7\u6599\n                    const formData = $('#airport-booking-form').serialize();\n                    const ajaxData = formData + \n                        '&action=submit_airport_booking' +\n                        '&stopovers=' + encodeURIComponent(JSON.stringify(stopovers)) +\n                        '&return_stopovers=' + encodeURIComponent(JSON.stringify(returnStopovers)) +\n                        '&total_price=' + this.state.lastTotalPrice;\n                    \n                    \/\/ \u63d0\u4ea4\n                    $.post(CONFIG.ajaxUrl, ajaxData)\n                        .done(res => {\n                            if (res?.success) {\n                                alert(res.data?.message || '\u9810\u7d04\u6210\u529f\uff01\u6211\u5011\u5c07\u76e1\u5feb\u8207\u60a8\u806f\u7e6b\u3002');\n                                \n                                \/\/ \u91cd\u7f6e\u8868\u55ae\n                                form.reset();\n                                this.state = {\n                                    stopovers: [],\n                                    returnStopovers: [],\n                                    calcTimeout: null,\n                                    isSubmitting: false,\n                                    lastTotalPrice: 0\n                                };\n                                $('#stops-container').empty();\n                                $('#return-stops-container').empty();\n                                $('.return-section').hide();\n                               \n                                \/\/ \u91cd\u65b0\u8a08\u7b97\u50f9\u683c\n                                this.calculatePrice();\n                            } else {\n                                alert(res?.data?.message || '\u9810\u7d04\u5931\u6557\uff0c\u8acb\u6aa2\u67e5\u6240\u6709\u5fc5\u586b\u6b04\u4f4d');\n                            }\n                        })\n                        .fail(() => {\n                            alert('\u7cfb\u7d71\u932f\u8aa4\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66');\n                        })\n                        .always(() => {\n                            this.state.isSubmitting = false;\n                            $('.btn-submit').prop('disabled', false).text('\u7acb\u5373\u9810\u7d04');\n                        });\n                }\n            };\n            \n            \/\/ \u521d\u59cb\u5316\n            if (AirportBooking.init()) {\n                console.log('\u2705 \u6a5f\u5834\u63a5\u9001\u7cfb\u7d71 V6.2 \u5df2\u555f\u52d5');\n            }\n        });\n        \n    })(jQuery);\n    <\/script>\n    \n    <?php\n}, 100);\n","scope":"front-end","active":true,"modified":"2025-09-12 15:22:38","revision":"1"}]}