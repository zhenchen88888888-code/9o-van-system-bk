{"generator":"Code Snippets v3.7.0","date_created":"2025-09-15 14:40","snippets":[{"id":94,"name":"19-Airport-Email-Templates","code":"\/**\n * ============================================================================\n * Snippet: 19-Airport-Email-Templates\n * Title: \u6a5f\u5834\u63a5\u9001\u90f5\u4ef6\u6a21\u677f\n * Description: \u63d0\u4f9b\u9810\u7d04\u78ba\u8a8d\u3001\u72c0\u614b\u66f4\u65b0\u3001\u63d0\u9192\u7b49\u90f5\u4ef6\u6a21\u677f\u8207\u767c\u9001\u529f\u80fd\n * Version: 1.0.0\n * Author: 9o Van Development Team\n * Created: 2025-09-14\n * Modified: 2025-09-14\n * Priority: 19\n * Dependencies: 00-Global-Constants, 05-Email-Template-Engine\n * Hook: Run everywhere\n * ============================================================================\n *\/\n\n\/\/ \u9632\u6b62\u76f4\u63a5\u8a2a\u554f\nif (!defined('ABSPATH')) {\n    exit;\n}\n\n\/\/ \u6aa2\u67e5\u4f9d\u8cf4\nif (!defined('_9O_VAN_VERSION')) {\n    error_log('[19-Airport-Email-Templates] \u932f\u8aa4\uff1a\u7f3a\u5c11\u5fc5\u8981\u7684\u5168\u57df\u5e38\u6578\u5b9a\u7fa9');\n    return;\n}\n\n\/**\n * ========================================\n * \u90f5\u4ef6\u6a21\u677f\u8a3b\u518a\n * ========================================\n *\/\n\n\/\/ \u8a3b\u518a\u6a5f\u5834\u63a5\u9001\u90f5\u4ef6\u6a21\u677f\nadd_action('init', '_9o_van_register_airport_email_templates');\n\nfunction _9o_van_register_airport_email_templates() {\n    if (!function_exists('_9o_van_register_email_template')) {\n        return;\n    }\n    \n    \/\/ \u9810\u7d04\u78ba\u8a8d\u4fe1\n    _9o_van_register_email_template('airport_booking_confirmation', array(\n        'name' => '\u6a5f\u5834\u63a5\u9001\u9810\u7d04\u78ba\u8a8d',\n        'subject' => '\u9810\u7d04\u78ba\u8a8d - \u8a02\u55ae\u7de8\u865f {{booking_number}}',\n        'description' => '\u5ba2\u6236\u5b8c\u6210\u9810\u7d04\u5f8c\u767c\u9001\u7684\u78ba\u8a8d\u4fe1',\n        'variables' => array(\n            'customer_name' => '\u5ba2\u6236\u59d3\u540d',\n            'booking_number' => '\u9810\u7d04\u7de8\u865f',\n            'service_type' => '\u670d\u52d9\u985e\u578b',\n            'service_date' => '\u670d\u52d9\u65e5\u671f',\n            'service_time' => '\u670d\u52d9\u6642\u9593',\n            'total_price' => '\u7e3d\u91d1\u984d'\n        )\n    ));\n    \n    \/\/ \u9810\u7d04\u63d0\u9192\u4fe1\n    _9o_van_register_email_template('airport_booking_reminder', array(\n        'name' => '\u6a5f\u5834\u63a5\u9001\u670d\u52d9\u63d0\u9192',\n        'subject' => '\u660e\u65e5\u670d\u52d9\u63d0\u9192 - {{service_date}} {{service_time}}',\n        'description' => '\u670d\u52d9\u524d\u4e00\u5929\u767c\u9001\u7684\u63d0\u9192\u4fe1',\n        'variables' => array(\n            'customer_name' => '\u5ba2\u6236\u59d3\u540d',\n            'service_date' => '\u670d\u52d9\u65e5\u671f',\n            'service_time' => '\u670d\u52d9\u6642\u9593',\n            'driver_name' => '\u53f8\u6a5f\u59d3\u540d',\n            'driver_phone' => '\u53f8\u6a5f\u96fb\u8a71'\n        )\n    ));\n    \n    \/\/ \u7ba1\u7406\u54e1\u901a\u77e5\n    _9o_van_register_email_template('airport_admin_notification', array(\n        'name' => '\u65b0\u9810\u7d04\u901a\u77e5\uff08\u7ba1\u7406\u54e1\uff09',\n        'subject' => '\u65b0\u9810\u7d04\u901a\u77e5 - {{customer_name}}',\n        'description' => '\u6709\u65b0\u9810\u7d04\u6642\u901a\u77e5\u7ba1\u7406\u54e1',\n        'variables' => array(\n            'booking_id' => '\u9810\u7d04ID',\n            'customer_name' => '\u5ba2\u6236\u59d3\u540d',\n            'customer_phone' => '\u5ba2\u6236\u96fb\u8a71',\n            'service_type' => '\u670d\u52d9\u985e\u578b',\n            'total_price' => '\u7e3d\u91d1\u984d'\n        )\n    ));\n}\n\n\/**\n * ========================================\n * \u90f5\u4ef6\u6a21\u677f\u5167\u5bb9\n * ========================================\n *\/\n\n\/**\n * \u53d6\u5f97\u9810\u7d04\u78ba\u8a8d\u4fe1\u6a21\u677f\n *\/\nfunction _9o_van_get_airport_confirmation_template($data) {\n    $html = _9o_van_get_email_header('\u9810\u7d04\u78ba\u8a8d');\n    \n    $html .= '\n    <div style=\"padding: 30px;\">\n        <h2 style=\"color: #3C3834; margin-bottom: 20px;\">\u89aa\u611b\u7684 ' . esc_html($data['customer_name']) . ' \u60a8\u597d<\/h2>\n        \n        <p style=\"color: #5C5854; line-height: 1.8; margin-bottom: 25px;\">\n            \u611f\u8b1d\u60a8\u9078\u64c7 9o Van Strip \u6a5f\u5834\u63a5\u9001\u670d\u52d9\uff01<br>\n            \u60a8\u7684\u9810\u7d04\u5df2\u6210\u529f\u78ba\u8a8d\uff0c\u4ee5\u4e0b\u662f\u60a8\u7684\u9810\u7d04\u8a73\u60c5\uff1a\n        <\/p>\n        \n        <div style=\"background: #F5F2EE; border-radius: 8px; padding: 20px; margin: 25px 0;\">\n            <h3 style=\"color: #94989C; margin-bottom: 15px; font-size: 16px;\">\ud83d\udccb \u9810\u7d04\u8cc7\u8a0a<\/h3>\n            \n            <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854; width: 35%;\">\u9810\u7d04\u7de8\u865f\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834; font-weight: bold;\">' . esc_html($data['booking_number']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u670d\u52d9\u985e\u578b\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['service_type']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u6a5f\u5834\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['airport']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u670d\u52d9\u65e5\u671f\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['service_date']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u670d\u52d9\u6642\u9593\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['service_time']) . '<\/td>\n                <\/tr>';\n    \n    \/\/ \u822a\u73ed\u8cc7\u8a0a\n    if (!empty($data['flight'])) {\n        $html .= '\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u822a\u73ed\u865f\u78bc\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['flight']) . '<\/td>\n                <\/tr>';\n    }\n    \n    \/\/ \u5730\u5740\u8cc7\u8a0a\n    if (!empty($data['address'])) {\n        $html .= '\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">' . esc_html($data['address_type']) . '\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['address']) . '<\/td>\n                <\/tr>';\n    }\n    \n    \/\/ \u505c\u9760\u9ede\n    if (!empty($data['stopovers']) && is_array($data['stopovers'])) {\n        $html .= '\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854; vertical-align: top;\">\u505c\u9760\u9ede\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">';\n        foreach ($data['stopovers'] as $i => $stop) {\n            $html .= ($i + 1) . '. ' . esc_html($stop['address']) . '<br>';\n        }\n        $html .= '<\/td>\n                <\/tr>';\n    }\n    \n    $html .= '\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u4e58\u5ba2\u4eba\u6578\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['passengers']) . ' \u4eba<\/td>\n                <\/tr>';\n    \n    \/\/ \u52a0\u8cfc\u9805\u76ee\n    if (!empty($data['addons']) && is_array($data['addons'])) {\n        $html .= '\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854; vertical-align: top;\">\u52a0\u8cfc\u9805\u76ee\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . implode('\u3001', array_map('esc_html', $data['addons'])) . '<\/td>\n                <\/tr>';\n    }\n    \n    $html .= '\n            <\/table>\n        <\/div>';\n    \n    \/\/ \u56de\u7a0b\u8cc7\u8a0a\uff08\u5982\u679c\u6709\uff09\n    if (!empty($data['has_return']) && $data['has_return']) {\n        $html .= '\n        <div style=\"background: #F5F2EE; border-radius: 8px; padding: 20px; margin: 25px 0;\">\n            <h3 style=\"color: #94989C; margin-bottom: 15px; font-size: 16px;\">\ud83d\udd04 \u56de\u7a0b\u8cc7\u8a0a<\/h3>\n            \n            <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854; width: 35%;\">\u56de\u7a0b\u65e5\u671f\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['return_date']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u56de\u7a0b\u6642\u9593\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['return_time']) . '<\/td>\n                <\/tr>';\n        \n        if (!empty($data['return_flight'])) {\n            $html .= '\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u56de\u7a0b\u822a\u73ed\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['return_flight']) . '<\/td>\n                <\/tr>';\n        }\n        \n        $html .= '\n            <\/table>\n        <\/div>';\n    }\n    \n    \/\/ \u7e3d\u91d1\u984d\n    $html .= '\n        <div style=\"background: linear-gradient(135deg, #94989C 0%, #7a7e82 100%); color: white; border-radius: 8px; padding: 20px; margin: 25px 0; text-align: center;\">\n            <div style=\"font-size: 14px; margin-bottom: 8px;\">\u7e3d\u91d1\u984d<\/div>\n            <div style=\"font-size: 28px; font-weight: bold;\">NT$ ' . number_format($data['total_price']) . '<\/div>\n        <\/div>';\n    \n    \/\/ \u6ce8\u610f\u4e8b\u9805\n    $html .= '\n        <div style=\"border-left: 4px solid #A8A094; padding-left: 15px; margin: 25px 0;\">\n            <h3 style=\"color: #94989C; margin-bottom: 10px; font-size: 16px;\">\ud83d\udccc \u6ce8\u610f\u4e8b\u9805<\/h3>\n            <ul style=\"color: #5C5854; line-height: 1.8; padding-left: 20px;\">\n                <li>\u53f8\u6a5f\u5c07\u65bc\u670d\u52d9\u524d\u4e00\u5929\u8207\u60a8\u806f\u7e6b\u78ba\u8a8d<\/li>\n                <li>\u5982\u9700\u66f4\u6539\u6216\u53d6\u6d88\uff0c\u8acb\u63d0\u524d24\u5c0f\u6642\u901a\u77e5<\/li>\n                <li>\u8acb\u65bc\u7d04\u5b9a\u6642\u9593\u6e96\u6642\u5019\u8eca<\/li>\n                <li>\u5982\u6709\u5927\u4ef6\u884c\u674e\u6216\u7279\u6b8a\u9700\u6c42\uff0c\u8acb\u63d0\u524d\u544a\u77e5<\/li>\n            <\/ul>\n        <\/div>';\n    \n    \/\/ \u806f\u7d61\u8cc7\u8a0a\n    $html .= '\n        <div style=\"text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #D4CFC4;\">\n            <p style=\"color: #5C5854; margin-bottom: 10px;\">\u5982\u6709\u4efb\u4f55\u554f\u984c\uff0c\u6b61\u8fce\u806f\u7e6b\u6211\u5011<\/p>\n            <p style=\"color: #3C3834;\">\n                <strong>\u5ba2\u670d\u96fb\u8a71\uff1a<\/strong>0800-123-456<br>\n                <strong>\u670d\u52d9\u6642\u9593\uff1a<\/strong>\u9031\u4e00\u81f3\u9031\u65e5 08:00-22:00\n            <\/p>\n        <\/div>\n    <\/div>';\n    \n    $html .= _9o_van_get_email_footer();\n    \n    return $html;\n}\n\n\/**\n * \u53d6\u5f97\u670d\u52d9\u63d0\u9192\u4fe1\u6a21\u677f\n *\/\nfunction _9o_van_get_airport_reminder_template($data) {\n    $html = _9o_van_get_email_header('\u670d\u52d9\u63d0\u9192');\n    \n    $html .= '\n    <div style=\"padding: 30px;\">\n        <h2 style=\"color: #3C3834; margin-bottom: 20px;\">\u89aa\u611b\u7684 ' . esc_html($data['customer_name']) . ' \u60a8\u597d<\/h2>\n        \n        <div style=\"background: #fff4e5; border: 1px solid #f59e0b; border-radius: 8px; padding: 20px; margin: 25px 0;\">\n            <p style=\"color: #92400e; font-size: 16px; margin: 0;\">\n                <strong>\ud83d\ude97 \u6eab\u99a8\u63d0\u9192\uff1a\u60a8\u7684\u6a5f\u5834\u63a5\u9001\u670d\u52d9\u5373\u5c07\u5230\u4f86\uff01<\/strong>\n            <\/p>\n        <\/div>\n        \n        <div style=\"background: #F5F2EE; border-radius: 8px; padding: 20px; margin: 25px 0;\">\n            <h3 style=\"color: #94989C; margin-bottom: 15px;\">\u660e\u65e5\u670d\u52d9\u8cc7\u8a0a<\/h3>\n            \n            <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                    <td style=\"padding: 10px 0; color: #5C5854; width: 35%;\">\u670d\u52d9\u65e5\u671f\uff1a<\/td>\n                    <td style=\"padding: 10px 0; color: #3C3834; font-weight: bold; font-size: 18px;\">' . esc_html($data['service_date']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 10px 0; color: #5C5854;\">\u670d\u52d9\u6642\u9593\uff1a<\/td>\n                    <td style=\"padding: 10px 0; color: #3C3834; font-weight: bold; font-size: 18px;\">' . esc_html($data['service_time']) . '<\/td>\n                <\/tr>';\n    \n    if (!empty($data['driver_name'])) {\n        $html .= '\n                <tr>\n                    <td style=\"padding: 10px 0; color: #5C5854;\">\u53f8\u6a5f\u59d3\u540d\uff1a<\/td>\n                    <td style=\"padding: 10px 0; color: #3C3834;\">' . esc_html($data['driver_name']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 10px 0; color: #5C5854;\">\u53f8\u6a5f\u96fb\u8a71\uff1a<\/td>\n                    <td style=\"padding: 10px 0; color: #3C3834; font-weight: bold;\">' . esc_html($data['driver_phone']) . '<\/td>\n                <\/tr>';\n    }\n    \n    $html .= '\n            <\/table>\n        <\/div>\n        \n        <div style=\"border-left: 4px solid #16a34a; padding-left: 15px; margin: 25px 0;\">\n            <h3 style=\"color: #16a34a; margin-bottom: 10px;\">\u2713 \u8acb\u6e96\u5099\u597d<\/h3>\n            <ul style=\"color: #5C5854; line-height: 1.8; padding-left: 20px;\">\n                <li>\u8b77\u7167\u53ca\u6a5f\u7968\uff08\u5982\u70ba\u570b\u969b\u822a\u73ed\uff09<\/li>\n                <li>\u78ba\u8a8d\u884c\u674e\u6578\u91cf<\/li>\n                <li>\u63d0\u524d5\u5206\u9418\u81f3\u7d04\u5b9a\u5730\u9ede\u7b49\u5019<\/li>\n            <\/ul>\n        <\/div>\n        \n        <div style=\"text-align: center; margin-top: 30px;\">\n            <p style=\"color: #5C5854;\">\u795d\u60a8\u65c5\u9014\u6109\u5feb\uff01<\/p>\n        <\/div>\n    <\/div>';\n    \n    $html .= _9o_van_get_email_footer();\n    \n    return $html;\n}\n\n\/**\n * \u53d6\u5f97\u7ba1\u7406\u54e1\u901a\u77e5\u6a21\u677f\n *\/\nfunction _9o_van_get_airport_admin_notification_template($data) {\n    $html = _9o_van_get_email_header('\u65b0\u9810\u7d04\u901a\u77e5', true);\n    \n    $html .= '\n    <div style=\"padding: 30px;\">\n        <h2 style=\"color: #3C3834; margin-bottom: 20px;\">\ud83d\udd14 \u65b0\u7684\u6a5f\u5834\u63a5\u9001\u9810\u7d04<\/h2>\n        \n        <div style=\"background: #e8f5e9; border: 1px solid #16a34a; border-radius: 8px; padding: 15px; margin-bottom: 20px;\">\n            <p style=\"margin: 0; color: #1b5e20; font-weight: bold;\">\n                \u9810\u7d04\u7de8\u865f\uff1a' . esc_html($data['booking_number']) . '\n            <\/p>\n        <\/div>\n        \n        <div style=\"background: #F5F2EE; border-radius: 8px; padding: 20px;\">\n            <h3 style=\"color: #94989C; margin-bottom: 15px;\">\u5ba2\u6236\u8cc7\u8a0a<\/h3>\n            \n            <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854; width: 30%;\">\u5ba2\u6236\u59d3\u540d\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834; font-weight: bold;\">' . esc_html($data['customer_name']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u5ba2\u6236\u96fb\u8a71\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834; font-weight: bold;\">' . esc_html($data['customer_phone']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u5ba2\u6236Email\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['customer_email'] ?: '\u672a\u63d0\u4f9b') . '<\/td>\n                <\/tr>\n            <\/table>\n        <\/div>\n        \n        <div style=\"background: #F5F2EE; border-radius: 8px; padding: 20px; margin-top: 15px;\">\n            <h3 style=\"color: #94989C; margin-bottom: 15px;\">\u670d\u52d9\u8cc7\u8a0a<\/h3>\n            \n            <table style=\"width: 100%; border-collapse: collapse;\">\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854; width: 30%;\">\u670d\u52d9\u985e\u578b\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834;\">' . esc_html($data['service_type']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u670d\u52d9\u65e5\u671f\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834; font-weight: bold;\">' . esc_html($data['service_date']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u670d\u52d9\u6642\u9593\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834; font-weight: bold;\">' . esc_html($data['service_time']) . '<\/td>\n                <\/tr>\n                <tr>\n                    <td style=\"padding: 8px 0; color: #5C5854;\">\u7e3d\u91d1\u984d\uff1a<\/td>\n                    <td style=\"padding: 8px 0; color: #3C3834; font-weight: bold; font-size: 18px; color: #dc2626;\">\n                        NT$ ' . number_format($data['total_price']) . '\n                    <\/td>\n                <\/tr>\n            <\/table>\n        <\/div>\n        \n        <div style=\"text-align: center; margin-top: 30px;\">\n            <a href=\"' . esc_url($data['admin_url']) . '\" \n               style=\"display: inline-block; background: #94989C; color: white; padding: 12px 30px; \n                      text-decoration: none; border-radius: 6px; font-weight: bold;\">\n                \u67e5\u770b\u8a73\u7d30\u8cc7\u6599\n            <\/a>\n        <\/div>\n        \n        <div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #D4CFC4;\">\n            <p style=\"color: #8C8884; font-size: 12px; text-align: center;\">\n                \u9810\u7d04\u6642\u9593\uff1a' . esc_html($data['booking_time']) . '<br>\n                IP \u4f4d\u5740\uff1a' . esc_html($data['ip_address']) . '\n            <\/p>\n        <\/div>\n    <\/div>';\n    \n    $html .= _9o_van_get_email_footer(true);\n    \n    return $html;\n}\n\n\/**\n * ========================================\n * \u90f5\u4ef6\u982d\u5c3e\u6a21\u677f\n * ========================================\n *\/\n\n\/**\n * \u53d6\u5f97\u90f5\u4ef6\u982d\u90e8\n *\/\nfunction _9o_van_get_email_header($title = '', $is_admin = false) {\n    $bg_color = $is_admin ? '#3C3834' : '#94989C';\n    \n    $html = '<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>' . esc_html($title) . '<\/title>\n<\/head>\n<body style=\"margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, \\'Helvetica Neue\\', Arial, sans-serif; background-color: #f5f5f5;\">\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"100%\" style=\"background-color: #f5f5f5;\">\n        <tr>\n            <td align=\"center\" style=\"padding: 20px;\">\n                <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"600\" style=\"background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n                    <tr>\n                        <td style=\"background: linear-gradient(135deg, ' . $bg_color . ' 0%, ' . $bg_color . 'dd 100%); padding: 30px; text-align: center;\">\n                            <h1 style=\"margin: 0; color: white; font-size: 28px;\">9o Van Strip<\/h1>\n                            <p style=\"margin: 10px 0 0; color: rgba(255,255,255,0.9); font-size: 14px;\">\u5c08\u696d\u6a5f\u5834\u63a5\u9001\u670d\u52d9<\/p>\n                        <\/td>\n                    <\/tr>\n                    <tr>\n                        <td>';\n    \n    return $html;\n}\n\n\/**\n * \u53d6\u5f97\u90f5\u4ef6\u5c3e\u90e8\n *\/\nfunction _9o_van_get_email_footer($is_admin = false) {\n    $html = '\n                        <\/td>\n                    <\/tr>\n                    <tr>\n                        <td style=\"background: #3C3834; padding: 20px; text-align: center;\">\n                            <p style=\"margin: 0 0 10px; color: rgba(255,255,255,0.8); font-size: 12px;\">\n                                \u00a9 ' . date('Y') . ' 9o Van Strip. All rights reserved.\n                            <\/p>';\n    \n    if (!$is_admin) {\n        $html .= '\n                            <p style=\"margin: 0; color: rgba(255,255,255,0.6); font-size: 11px;\">\n                                \u6b64\u70ba\u7cfb\u7d71\u81ea\u52d5\u767c\u9001\u7684\u90f5\u4ef6\uff0c\u8acb\u52ff\u76f4\u63a5\u56de\u8986\n                            <\/p>';\n    }\n    \n    $html .= '\n                        <\/td>\n                    <\/tr>\n                <\/table>\n            <\/td>\n        <\/tr>\n    <\/table>\n<\/body>\n<\/html>';\n    \n    return $html;\n}\n\n\/**\n * ========================================\n * \u90f5\u4ef6\u767c\u9001\u51fd\u6578\n * ========================================\n *\/\n\n\/**\n * \u767c\u9001\u6a5f\u5834\u63a5\u9001\u9810\u7d04\u78ba\u8a8d\u4fe1\n *\/\nfunction _9o_van_send_airport_confirmation($booking_id, $booking_data) {\n    if (empty($booking_data['customer_email'])) {\n        return false;\n    }\n    \n    \/\/ \u6e96\u5099\u90f5\u4ef6\u8cc7\u6599\n    $email_data = _9o_van_prepare_confirmation_data($booking_data);\n    \n    \/\/ \u53d6\u5f97\u90f5\u4ef6\u5167\u5bb9\n    $subject = str_replace('{{booking_number}}', $email_data['booking_number'], \n        '\u9810\u7d04\u78ba\u8a8d - \u8a02\u55ae\u7de8\u865f {{booking_number}}');\n    $message = _9o_van_get_airport_confirmation_template($email_data);\n    \n    \/\/ \u8a2d\u5b9a\u90f5\u4ef6\u982d\n    $headers = array(\n        'Content-Type: text\/html; charset=UTF-8',\n        'From: 9o Van Strip <noreply@' . $_SERVER['SERVER_NAME'] . '>',\n        'Reply-To: support@' . $_SERVER['SERVER_NAME']\n    );\n    \n    \/\/ \u767c\u9001\u90f5\u4ef6\n    $sent = wp_mail($booking_data['customer_email'], $subject, $message, $headers);\n    \n    if ($sent) {\n        _9o_van_log_email_sent($booking_id, 'confirmation', $booking_data['customer_email']);\n    }\n    \n    return $sent;\n}\n\n\/**\n * \u767c\u9001\u670d\u52d9\u63d0\u9192\u4fe1\n *\/\nfunction _9o_van_send_airport_reminder($booking_id, $booking_data) {\n    if (empty($booking_data['customer_email'])) {\n        return false;\n    }\n    \n    \/\/ \u6e96\u5099\u90f5\u4ef6\u8cc7\u6599\n    $email_data = array(\n        'customer_name' => $booking_data['customer_name'],\n        'service_date' => $booking_data['date'],\n        'service_time' => $booking_data['time'],\n        'driver_name' => $booking_data['driver_name'] ?? '',\n        'driver_phone' => $booking_data['driver_phone'] ?? ''\n    );\n    \n    \/\/ \u53d6\u5f97\u90f5\u4ef6\u5167\u5bb9\n    $subject = str_replace(\n        array('{{service_date}}', '{{service_time}}'),\n        array($email_data['service_date'], $email_data['service_time']),\n        '\u660e\u65e5\u670d\u52d9\u63d0\u9192 - {{service_date}} {{service_time}}'\n    );\n    $message = _9o_van_get_airport_reminder_template($email_data);\n    \n    \/\/ \u8a2d\u5b9a\u90f5\u4ef6\u982d\n    $headers = array(\n        'Content-Type: text\/html; charset=UTF-8',\n        'From: 9o Van Strip <noreply@' . $_SERVER['SERVER_NAME'] . '>',\n        'Reply-To: support@' . $_SERVER['SERVER_NAME']\n    );\n    \n    \/\/ \u767c\u9001\u90f5\u4ef6\n    $sent = wp_mail($booking_data['customer_email'], $subject, $message, $headers);\n    \n    if ($sent) {\n        _9o_van_log_email_sent($booking_id, 'reminder', $booking_data['customer_email']);\n    }\n    \n    return $sent;\n}\n\n\/**\n * \u767c\u9001\u7ba1\u7406\u54e1\u901a\u77e5\n *\/\nfunction _9o_van_send_airport_admin_notification($booking_id, $booking_data) {\n    $admin_email = get_option('admin_email');\n    \n    \/\/ \u6e96\u5099\u90f5\u4ef6\u8cc7\u6599\n    $email_data = array(\n        'booking_id' => $booking_id,\n        'booking_number' => $booking_data['booking_number'] ?? 'APT' . str_pad($booking_id, 6, '0', STR_PAD_LEFT),\n        'customer_name' => $booking_data['customer_name'],\n        'customer_phone' => $booking_data['customer_phone'],\n        'customer_email' => $booking_data['customer_email'] ?? '',\n        'service_type' => $booking_data['service_type'] === 'pickup' ? '\u63a5\u6a5f\u670d\u52d9' : '\u9001\u6a5f\u670d\u52d9',\n        'service_date' => $booking_data['date'],\n        'service_time' => $booking_data['time'],\n        'total_price' => $booking_data['total_price'],\n        'admin_url' => admin_url('admin.php?page=9o-van-bookings&action=view&id=' . $booking_id),\n        'booking_time' => $booking_data['booking_time'] ?? current_time('mysql'),\n        'ip_address' => $booking_data['ip_address'] ?? $_SERVER['REMOTE_ADDR']\n    );\n    \n    \/\/ \u53d6\u5f97\u90f5\u4ef6\u5167\u5bb9\n    $subject = str_replace('{{customer_name}}', $email_data['customer_name'], \n        '\u65b0\u9810\u7d04\u901a\u77e5 - {{customer_name}}');\n    $message = _9o_van_get_airport_admin_notification_template($email_data);\n    \n    \/\/ \u8a2d\u5b9a\u90f5\u4ef6\u982d\n    $headers = array(\n        'Content-Type: text\/html; charset=UTF-8',\n        'From: 9o Van System <system@' . $_SERVER['SERVER_NAME'] . '>'\n    );\n    \n    \/\/ \u767c\u9001\u90f5\u4ef6\n    return wp_mail($admin_email, $subject, $message, $headers);\n}\n\n\/**\n * ========================================\n * \u8f14\u52a9\u51fd\u6578\n * ========================================\n *\/\n\n\/**\n * \u6e96\u5099\u78ba\u8a8d\u4fe1\u8cc7\u6599\n *\/\nfunction _9o_van_prepare_confirmation_data($booking_data) {\n    $data = array(\n        'customer_name' => $booking_data['customer_name'],\n        'booking_number' => $booking_data['booking_number'] ?? '',\n        'service_type' => $booking_data['service_type'] === 'pickup' ? '\u63a5\u6a5f\u670d\u52d9' : '\u9001\u6a5f\u670d\u52d9',\n        'airport' => $booking_data['airport'] === 'TPE' ? '\u6843\u5712\u570b\u969b\u6a5f\u5834' : '\u53f0\u5317\u677e\u5c71\u6a5f\u5834',\n        'service_date' => $booking_data['date'],\n        'service_time' => $booking_data['time'],\n        'flight' => $booking_data['flight'] ?? '',\n        'passengers' => $booking_data['passengers'],\n        'total_price' => $booking_data['total_price']\n    );\n    \n    \/\/ \u5730\u5740\u8cc7\u8a0a\n    if ($booking_data['service_type'] === 'pickup') {\n        $data['address'] = $booking_data['dropoff_address'];\n        $data['address_type'] = '\u4e0b\u8eca\u5730\u5740';\n    } else {\n        $data['address'] = $booking_data['pickup_address'];\n        $data['address_type'] = '\u4e0a\u8eca\u5730\u5740';\n    }\n    \n    \/\/ \u505c\u9760\u9ede\n    if (!empty($booking_data['stopovers'])) {\n        $data['stopovers'] = $booking_data['stopovers'];\n    }\n    \n    \/\/ \u52a0\u8cfc\u9805\u76ee\n    $addons = array();\n    if ($booking_data['child_seats'] > 0) {\n        $addons[] = '\u5b30\u5152\u5ea7\u6905 x ' . $booking_data['child_seats'];\n    }\n    if ($booking_data['booster_seats'] > 0) {\n        $addons[] = '\u5152\u7ae5\u589e\u9ad8\u588a x ' . $booking_data['booster_seats'];\n    }\n    if ($booking_data['name_board'] === 'yes') {\n        $addons[] = '\u8209\u724c\u670d\u52d9';\n    }\n    $data['addons'] = $addons;\n    \n    \/\/ \u56de\u7a0b\u8cc7\u8a0a\n    if ($booking_data['trip_type'] === 'roundtrip' && !empty($booking_data['return_data'])) {\n        $data['has_return'] = true;\n        $data['return_date'] = $booking_data['return_data']['date'];\n        $data['return_time'] = $booking_data['return_data']['time'];\n        $data['return_flight'] = $booking_data['return_data']['flight'] ?? '';\n    }\n    \n    return $data;\n}\n\n\/**\n * \u8a18\u9304\u90f5\u4ef6\u767c\u9001\n *\/\nfunction _9o_van_log_email_sent($booking_id, $type, $recipient) {\n    if (function_exists('_9o_van_log_activity')) {\n        _9o_van_log_activity('email_sent', array(\n            'booking_id' => $booking_id,\n            'email_type' => $type,\n            'recipient' => $recipient,\n            'sent_time' => current_time('mysql')\n        ));\n    }\n}\n\n\/**\n * ========================================\n * \u6392\u7a0b\u4efb\u52d9\n * ========================================\n *\/\n\n\/\/ \u8a3b\u518a\u6392\u7a0b\u4efb\u52d9\nadd_action('init', function() {\n    if (!wp_next_scheduled('_9o_van_send_airport_reminders')) {\n        wp_schedule_event(strtotime('today 18:00'), 'daily', '_9o_van_send_airport_reminders');\n    }\n});\n\n\/\/ \u6bcf\u65e5\u767c\u9001\u9694\u5929\u670d\u52d9\u63d0\u9192\nadd_action('_9o_van_send_airport_reminders', function() {\n    global $wpdb;\n    \n    $tomorrow = date('Y-m-d', strtotime('+1 day'));\n    \n    \/\/ \u67e5\u8a62\u660e\u5929\u7684\u9810\u7d04\n    $table = _9o_van_table('bookings');\n    if (!$table) return;\n    \n    $bookings = $wpdb->get_results($wpdb->prepare(\n        \"SELECT * FROM {$table} \n         WHERE service_date = %s \n         AND service_type = 'airport' \n         AND status IN ('confirmed', 'paid')\n         AND reminder_sent = 0\",\n        $tomorrow\n    ));\n    \n    foreach ($bookings as $booking) {\n        $booking_data = json_decode($booking->service_data, true);\n        \n        if (_9o_van_send_airport_reminder($booking->id, $booking_data)) {\n            \/\/ \u66f4\u65b0\u63d0\u9192\u767c\u9001\u72c0\u614b\n            $wpdb->update(\n                $table,\n                array('reminder_sent' => 1),\n                array('id' => $booking->id)\n            );\n        }\n    }\n});\n\n\/\/ \u8a18\u9304\u6a21\u7d44\u8f09\u5165\nif (defined('_9O_VAN_DEBUG') && _9O_VAN_DEBUG) {\n    error_log('[19-Airport-Email-Templates] \u6a21\u7d44\u5df2\u8f09\u5165 - v1.0.0');\n}","active":true,"priority":19,"modified":"2025-09-14 02:50:12","revision":"1"}]}