{"generator":"Code Snippets v3.7.0","date_created":"2025-09-15 14:40","snippets":[{"id":104,"name":" 29-Charter-Email-Templates","code":"\/**\n * ============================================================================\n * Module: 29-Charter-Email-Templates\n * Title: \u5305\u8eca\u670d\u52d9\u90f5\u4ef6\u6a21\u677f\u7cfb\u7d71\n * Description: \u63d0\u4f9b\u6240\u6709\u5305\u8eca\u76f8\u95dc\u7684\u90f5\u4ef6\u6a21\u677f\uff0c\u652f\u63f4HTML\u548c\u7d14\u6587\u5b57\u683c\u5f0f\n * Version: 1.0.0\n * Author: 9o Van Development Team\n * Created: 2025-09-14\n * Priority: 29\n * Dependencies: 20-Charter-Settings, 05-Email-Template-Engine\n * ============================================================================\n *\/\n\n\/\/ \u9632\u6b62\u76f4\u63a5\u8a2a\u554f\nif (!defined('ABSPATH')) {\n    exit;\n}\n\n\/**\n * \u5305\u8eca\u90f5\u4ef6\u6a21\u677f\u985e\u5225\n *\/\nclass NineOVan_Charter_Email_Templates {\n    \n    private static $instance = null;\n    private $template_engine;\n    \n    \/**\n     * \u53d6\u5f97\u55ae\u4f8b\u5be6\u4f8b\n     *\/\n    public static function get_instance() {\n        if (null === self::$instance) {\n            self::$instance = new self();\n        }\n        return self::$instance;\n    }\n    \n    \/**\n     * \u5efa\u69cb\u51fd\u5f0f\n     *\/\n    private function __construct() {\n        $this->init_hooks();\n    }\n    \n    \/**\n     * \u521d\u59cb\u5316\u9264\u5b50\n     *\/\n    private function init_hooks() {\n        \/\/ \u8a3b\u518a\u90f5\u4ef6\u985e\u578b\n        add_filter('9o_van_email_types', array($this, 'register_email_types'));\n        \n        \/\/ \u81ea\u5b9a\u7fa9\u90f5\u4ef6\u982d\u90e8\n        add_filter('wp_mail_from', array($this, 'custom_mail_from'));\n        add_filter('wp_mail_from_name', array($this, 'custom_mail_from_name'));\n        \n        \/\/ \u8a2d\u5b9aHTML\u90f5\u4ef6\n        add_filter('wp_mail_content_type', array($this, 'set_html_content_type'));\n    }\n    \n    \/**\n     * \u8a3b\u518a\u90f5\u4ef6\u985e\u578b\n     *\/\n    public function register_email_types($types) {\n        $types['charter_customer_confirmation'] = '\u5305\u8eca\u5ba2\u6236\u78ba\u8a8d\u4fe1';\n        $types['charter_admin_notification'] = '\u5305\u8eca\u7ba1\u7406\u54e1\u901a\u77e5';\n        $types['charter_payment_reminder'] = '\u5305\u8eca\u4ed8\u6b3e\u63d0\u9192';\n        $types['charter_status_update'] = '\u5305\u8eca\u72c0\u614b\u66f4\u65b0';\n        $types['charter_cancellation'] = '\u5305\u8eca\u53d6\u6d88\u901a\u77e5';\n        return $types;\n    }\n    \n    \/**\n     * \u767c\u9001\u5ba2\u6236\u78ba\u8a8d\u4fe1\n     *\/\n    public function send_customer_confirmation($booking_id, $booking_data) {\n        \/\/ \u6aa2\u67e5\u662f\u5426\u6709 Email\n        if (empty($booking_data['customer_email'])) {\n            return false;\n        }\n        \n        $to = $booking_data['customer_email'];\n        $subject = $this->get_subject('customer_confirmation', $booking_data);\n        \n        \/\/ \u6e96\u5099\u6a21\u677f\u8b8a\u6578\n        $template_vars = $this->prepare_template_vars($booking_id, $booking_data);\n        \n        \/\/ \u751f\u6210HTML\u5167\u5bb9\n        $html_content = $this->get_html_template('customer_confirmation', $template_vars);\n        \n        \/\/ \u751f\u6210\u7d14\u6587\u5b57\u5167\u5bb9\n        $text_content = $this->get_text_template('customer_confirmation', $template_vars);\n        \n        \/\/ \u767c\u9001\u90f5\u4ef6\n        return $this->send_email($to, $subject, $html_content, $text_content);\n    }\n    \n    \/**\n     * \u767c\u9001\u7ba1\u7406\u54e1\u901a\u77e5\n     *\/\n    public function send_admin_notification($booking_id, $booking_data) {\n        $admin_email = get_option('admin_email');\n        $subject = $this->get_subject('admin_notification', $booking_data);\n        \n        $template_vars = $this->prepare_template_vars($booking_id, $booking_data);\n        \n        $html_content = $this->get_html_template('admin_notification', $template_vars);\n        $text_content = $this->get_text_template('admin_notification', $template_vars);\n        \n        return $this->send_email($admin_email, $subject, $html_content, $text_content);\n    }\n    \n    \/**\n     * \u767c\u9001\u4ed8\u6b3e\u63d0\u9192\n     *\/\n    public function send_payment_reminder($booking_id, $booking_data) {\n        if (empty($booking_data['customer_email'])) {\n            return false;\n        }\n        \n        $to = $booking_data['customer_email'];\n        $subject = $this->get_subject('payment_reminder', $booking_data);\n        \n        $template_vars = $this->prepare_template_vars($booking_id, $booking_data);\n        \n        $html_content = $this->get_html_template('payment_reminder', $template_vars);\n        $text_content = $this->get_text_template('payment_reminder', $template_vars);\n        \n        return $this->send_email($to, $subject, $html_content, $text_content);\n    }\n    \n    \/**\n     * \u6e96\u5099\u6a21\u677f\u8b8a\u6578\n     *\/\n    private function prepare_template_vars($booking_id, $booking_data) {\n        $vars = array(\n            \/\/ \u57fa\u672c\u8cc7\u8a0a\n            'booking_id' => $booking_id,\n            'booking_number' => 'CHT' . str_pad($booking_id, 6, '0', STR_PAD_LEFT),\n            'booking_date' => current_time('Y-m-d H:i:s'),\n            \n            \/\/ \u5ba2\u6236\u8cc7\u8a0a\n            'customer_name' => $booking_data['customer_name'] ?? '',\n            'customer_phone' => $booking_data['customer_phone'] ?? '',\n            'customer_email' => $booking_data['customer_email'] ?? '',\n            \n            \/\/ \u884c\u7a0b\u8cc7\u8a0a\n            'trip_days' => $booking_data['trip_days'] ?? 1,\n            'start_date' => $booking_data['start_date'] ?? '',\n            'start_time' => $booking_data['start_time'] ?? '',\n            'end_date' => $booking_data['end_date'] ?? '',\n            'passengers' => $booking_data['passengers'] ?? 1,\n            \n            \/\/ \u50f9\u683c\u8cc7\u8a0a\n            'total_price' => $booking_data['total_price'] ?? 0,\n            'deposit' => $booking_data['deposit'] ?? 0,\n            'balance' => $booking_data['balance'] ?? 0,\n            \n            \/\/ \u52a0\u8cfc\u9805\u76ee\n            'child_seats' => $booking_data['child_seats'] ?? 0,\n            'booster_seats' => $booking_data['booster_seats'] ?? 0,\n            \n            \/\/ \u53f8\u6a5f\u5b89\u6392\n            'driver_accommodation' => $booking_data['driver_accommodation'] ?? 'self',\n            'driver_meals' => $booking_data['driver_meals'] ?? 'provided',\n            \n            \/\/ \u5176\u4ed6\n            'notes' => $booking_data['notes'] ?? '',\n            'daily_routes' => $booking_data['daily_routes'] ?? array(),\n            \n            \/\/ \u516c\u53f8\u8cc7\u8a0a\n            'company_name' => '9o Van Strip',\n            'company_phone' => '0900-000-000',\n            'company_email' => 'service@9ovan.com',\n            'company_website' => home_url(),\n            \n            \/\/ \u7cfb\u7d71\u9023\u7d50\n            'booking_link' => admin_url('post.php?post=' . $booking_id . '&action=edit'),\n            'payment_link' => home_url('\/payment?booking=' . $booking_id),\n        );\n        \n        return apply_filters('9o_van_charter_email_vars', $vars, $booking_id, $booking_data);\n    }\n    \n    \/**\n     * \u53d6\u5f97\u90f5\u4ef6\u4e3b\u65e8\n     *\/\n    private function get_subject($type, $booking_data) {\n        $subjects = array(\n            'customer_confirmation' => '\u30109o Van\u3011\u5305\u8eca\u65c5\u904a\u9810\u7d04\u78ba\u8a8d - \u8a02\u55ae\u7de8\u865f {booking_number}',\n            'admin_notification' => '\u3010\u65b0\u9810\u7d04\u3011{customer_name} - {start_date} - {trip_days}\u5929',\n            'payment_reminder' => '\u30109o Van\u3011\u4ed8\u6b3e\u63d0\u9192 - \u8a02\u55ae\u7de8\u865f {booking_number}',\n            'status_update' => '\u30109o Van\u3011\u8a02\u55ae\u72c0\u614b\u66f4\u65b0 - {booking_number}',\n            'cancellation' => '\u30109o Van\u3011\u9810\u7d04\u53d6\u6d88\u901a\u77e5 - {booking_number}'\n        );\n        \n        $subject = $subjects[$type] ?? '\u30109o Van\u3011\u5305\u8eca\u670d\u52d9\u901a\u77e5';\n        \n        \/\/ \u66ff\u63db\u8b8a\u6578\n        foreach ($booking_data as $key => $value) {\n            if (!is_array($value)) {\n                $subject = str_replace('{' . $key . '}', $value, $subject);\n            }\n        }\n        \n        return $subject;\n    }\n    \n    \/**\n     * \u53d6\u5f97HTML\u6a21\u677f\n     *\/\n    private function get_html_template($type, $vars) {\n        ob_start();\n        ?>\n<!DOCTYPE html>\n<html lang=\"zh-TW\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title><?php echo esc_html($vars['company_name']); ?><\/title>\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            line-height: 1.6;\n            color: #3C3834;\n            background-color: #f5f5f5;\n        }\n        .email-wrapper {\n            max-width: 600px;\n            margin: 0 auto;\n            background: #ffffff;\n        }\n        .email-header {\n            background: linear-gradient(135deg, #94989C 0%, #7a7e82 100%);\n            color: white;\n            padding: 30px;\n            text-align: center;\n        }\n        .email-header h1 {\n            margin: 0;\n            font-size: 28px;\n        }\n        .email-body {\n            padding: 30px;\n        }\n        .greeting {\n            font-size: 18px;\n            margin-bottom: 20px;\n        }\n        .section {\n            margin-bottom: 25px;\n            padding: 15px;\n            background: #f9f9f9;\n            border-radius: 8px;\n        }\n        .section-title {\n            font-size: 16px;\n            font-weight: bold;\n            color: #94989C;\n            margin-bottom: 10px;\n            border-bottom: 2px solid #e5e5e5;\n            padding-bottom: 5px;\n        }\n        .info-row {\n            display: flex;\n            justify-content: space-between;\n            padding: 8px 0;\n            border-bottom: 1px solid #eee;\n        }\n        .info-row:last-child {\n            border-bottom: none;\n        }\n        .info-label {\n            color: #666;\n            font-size: 14px;\n        }\n        .info-value {\n            font-weight: 500;\n            font-size: 14px;\n        }\n        .route-day {\n            margin: 15px 0;\n            padding: 10px;\n            background: white;\n            border-left: 3px solid #94989C;\n        }\n        .route-day-title {\n            font-weight: bold;\n            color: #94989C;\n            margin-bottom: 5px;\n        }\n        .price-highlight {\n            background: #fef3c7;\n            padding: 15px;\n            border-radius: 8px;\n            margin: 20px 0;\n        }\n        .total-price {\n            font-size: 24px;\n            font-weight: bold;\n            color: #94989C;\n        }\n        .deposit-amount {\n            color: #dc2626;\n            font-weight: bold;\n        }\n        .btn {\n            display: inline-block;\n            padding: 12px 30px;\n            background: #94989C;\n            color: white;\n            text-decoration: none;\n            border-radius: 6px;\n            margin: 10px 0;\n        }\n        .footer {\n            background: #f5f5f5;\n            padding: 20px;\n            text-align: center;\n            font-size: 12px;\n            color: #666;\n        }\n        .footer a {\n            color: #94989C;\n            text-decoration: none;\n        }\n        .notice {\n            background: #fee2e2;\n            border-left: 4px solid #dc2626;\n            padding: 10px;\n            margin: 15px 0;\n            color: #991b1b;\n        }\n        .success {\n            background: #dcfce7;\n            border-left: 4px solid #16a34a;\n            padding: 10px;\n            margin: 15px 0;\n            color: #166534;\n        }\n    <\/style>\n<\/head>\n<body>\n    <div class=\"email-wrapper\">\n        <?php\n        switch ($type) {\n            case 'customer_confirmation':\n                echo $this->get_customer_confirmation_content($vars);\n                break;\n            case 'admin_notification':\n                echo $this->get_admin_notification_content($vars);\n                break;\n            case 'payment_reminder':\n                echo $this->get_payment_reminder_content($vars);\n                break;\n            default:\n                echo $this->get_default_content($vars);\n        }\n        ?>\n        \n        <div class=\"footer\">\n            <p><?php echo esc_html($vars['company_name']); ?> - \u5c08\u696d\u5305\u8eca\u65c5\u904a\u670d\u52d9<\/p>\n            <p>\n                \u96fb\u8a71\uff1a<?php echo esc_html($vars['company_phone']); ?> | \n                Email\uff1a<a href=\"mailto:<?php echo esc_attr($vars['company_email']); ?>\">\n                    <?php echo esc_html($vars['company_email']); ?>\n                <\/a>\n            <\/p>\n            <p>\n                <a href=\"<?php echo esc_url($vars['company_website']); ?>\">\n                    <?php echo esc_html($vars['company_website']); ?>\n                <\/a>\n            <\/p>\n            <p style=\"margin-top: 15px; font-size: 11px; color: #999;\">\n                \u6b64\u90f5\u4ef6\u7531\u7cfb\u7d71\u81ea\u52d5\u767c\u9001\uff0c\u8acb\u52ff\u76f4\u63a5\u56de\u8986\n            <\/p>\n        <\/div>\n    <\/div>\n<\/body>\n<\/html>\n        <?php\n        return ob_get_clean();\n    }\n    \n    \/**\n     * \u5ba2\u6236\u78ba\u8a8d\u4fe1\u5167\u5bb9\n     *\/\n    private function get_customer_confirmation_content($vars) {\n        ob_start();\n        ?>\n        <div class=\"email-header\">\n            <h1>\ud83d\ude90 \u9810\u7d04\u78ba\u8a8d<\/h1>\n            <p>\u611f\u8b1d\u60a8\u9078\u64c7 <?php echo esc_html($vars['company_name']); ?><\/p>\n        <\/div>\n        \n        <div class=\"email-body\">\n            <div class=\"greeting\">\n                \u89aa\u611b\u7684 <?php echo esc_html($vars['customer_name']); ?> \u60a8\u597d\uff0c\n            <\/div>\n            \n            <div class=\"success\">\n                \u2705 \u60a8\u7684\u5305\u8eca\u65c5\u904a\u9810\u7d04\u5df2\u6210\u529f\u63d0\u4ea4\uff01<br>\n                \u8a02\u55ae\u7de8\u865f\uff1a<strong><?php echo esc_html($vars['booking_number']); ?><\/strong>\n            <\/div>\n            \n            <!-- \u884c\u7a0b\u8cc7\u8a0a -->\n            <div class=\"section\">\n                <div class=\"section-title\">\ud83d\udcc5 \u884c\u7a0b\u8cc7\u8a0a<\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u884c\u7a0b\u5929\u6578<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['trip_days']); ?>\u5929<\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u51fa\u767c\u65e5\u671f<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['start_date']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u51fa\u767c\u6642\u9593<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['start_time']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u7d50\u675f\u65e5\u671f<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['end_date']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u4e58\u5ba2\u4eba\u6578<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['passengers']); ?>\u4eba<\/span>\n                <\/div>\n            <\/div>\n            \n            <!-- \u6bcf\u65e5\u884c\u7a0b -->\n            <div class=\"section\">\n                <div class=\"section-title\">\ud83d\uddfa\ufe0f \u884c\u7a0b\u5b89\u6392<\/div>\n                <?php foreach ($vars['daily_routes'] as $day => $route): ?>\n                <div class=\"route-day\">\n                    <div class=\"route-day-title\">Day <?php echo $day + 1; ?><\/div>\n                    <div>\u8d77\u9ede\uff1a<?php echo esc_html($route['origin'] ?? '\u5f85\u78ba\u8a8d'); ?><\/div>\n                    <div>\u7d42\u9ede\uff1a<?php echo esc_html($route['destination'] ?? '\u5f85\u78ba\u8a8d'); ?><\/div>\n                    <?php if (!empty($route['stops'])): ?>\n                    <div>\u505c\u9760\u9ede\uff1a<?php echo esc_html(implode('\u3001', $route['stops'])); ?><\/div>\n                    <?php endif; ?>\n                <\/div>\n                <?php endforeach; ?>\n            <\/div>\n            \n            <!-- \u8cbb\u7528\u660e\u7d30 -->\n            <div class=\"price-highlight\">\n                <div class=\"section-title\">\ud83d\udcb0 \u8cbb\u7528\u660e\u7d30<\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u7e3d\u91d1\u984d<\/span>\n                    <span class=\"total-price\">NT$ <?php echo number_format($vars['total_price']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u8a02\u91d1 (30%)<\/span>\n                    <span class=\"deposit-amount\">NT$ <?php echo number_format($vars['deposit']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u5c3e\u6b3e (70%)<\/span>\n                    <span class=\"info-value\">NT$ <?php echo number_format($vars['balance']); ?><\/span>\n                <\/div>\n                <small>\u203b \u6240\u6709\u50f9\u683c\u5747\u5df2\u542b 5% \u71df\u696d\u7a05<\/small>\n            <\/div>\n            \n            <!-- \u4ed8\u6b3e\u8aaa\u660e -->\n            <div class=\"notice\">\n                <strong>\u26a0\ufe0f \u91cd\u8981\u63d0\u9192<\/strong><br>\n                \u8acb\u65bc 24 \u5c0f\u6642\u5167\u652f\u4ed8\u8a02\u91d1\u4ee5\u78ba\u4fdd\u60a8\u7684\u9810\u7d04\u3002<br>\n                \u6211\u5011\u5c07\u5728\u6536\u5230\u8a02\u91d1\u5f8c\u8207\u60a8\u96fb\u8a71\u78ba\u8a8d\u8a73\u7d30\u884c\u7a0b\u3002\n            <\/div>\n            \n            <!-- \u4ed8\u6b3e\u6309\u9215 -->\n            <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"<?php echo esc_url($vars['payment_link']); ?>\" class=\"btn\">\n                    \u7acb\u5373\u652f\u4ed8\u8a02\u91d1\n                <\/a>\n            <\/div>\n            \n            <!-- \u806f\u7d61\u8cc7\u8a0a -->\n            <div class=\"section\">\n                <div class=\"section-title\">\ud83d\udcde \u806f\u7d61\u8cc7\u8a0a<\/div>\n                <p>\u5982\u6709\u4efb\u4f55\u554f\u984c\uff0c\u6b61\u8fce\u8207\u6211\u5011\u806f\u7e6b\uff1a<\/p>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u5ba2\u670d\u5c08\u7dda<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['company_phone']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u5ba2\u670d\u4fe1\u7bb1<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['company_email']); ?><\/span>\n                <\/div>\n            <\/div>\n            \n            <?php if (!empty($vars['notes'])): ?>\n            <div class=\"section\">\n                <div class=\"section-title\">\ud83d\udcdd \u5099\u8a3b<\/div>\n                <p><?php echo nl2br(esc_html($vars['notes'])); ?><\/p>\n            <\/div>\n            <?php endif; ?>\n        <\/div>\n        <?php\n        return ob_get_clean();\n    }\n    \n    \/**\n     * \u7ba1\u7406\u54e1\u901a\u77e5\u5167\u5bb9\n     *\/\n    private function get_admin_notification_content($vars) {\n        ob_start();\n        ?>\n        <div class=\"email-header\">\n            <h1>\ud83d\udccc \u65b0\u5305\u8eca\u9810\u7d04\u901a\u77e5<\/h1>\n            <p>\u8a02\u55ae\u7de8\u865f\uff1a<?php echo esc_html($vars['booking_number']); ?><\/p>\n        <\/div>\n        \n        <div class=\"email-body\">\n            <div class=\"notice\">\n                <strong>\ud83d\udd14 \u6709\u65b0\u7684\u5305\u8eca\u9810\u7d04\u9700\u8981\u8655\u7406<\/strong>\n            <\/div>\n            \n            <!-- \u5ba2\u6236\u8cc7\u8a0a -->\n            <div class=\"section\">\n                <div class=\"section-title\">\u5ba2\u6236\u8cc7\u8a0a<\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u59d3\u540d<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['customer_name']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u96fb\u8a71<\/span>\n                    <span class=\"info-value\">\n                        <a href=\"tel:<?php echo esc_attr($vars['customer_phone']); ?>\">\n                            <?php echo esc_html($vars['customer_phone']); ?>\n                        <\/a>\n                    <\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">Email<\/span>\n                    <span class=\"info-value\">\n                        <?php if (!empty($vars['customer_email'])): ?>\n                            <a href=\"mailto:<?php echo esc_attr($vars['customer_email']); ?>\">\n                                <?php echo esc_html($vars['customer_email']); ?>\n                            <\/a>\n                        <?php else: ?>\n                            <span style=\"color: #dc2626;\">\u26a0\ufe0f \u672a\u63d0\u4f9b\uff08\u7121\u6cd5\u767c\u9001\u78ba\u8a8d\u4fe1\uff09<\/span>\n                        <?php endif; ?>\n                    <\/span>\n                <\/div>\n            <\/div>\n            \n            <!-- \u884c\u7a0b\u8cc7\u8a0a -->\n            <div class=\"section\">\n                <div class=\"section-title\">\u884c\u7a0b\u8a73\u60c5<\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u884c\u7a0b\u5929\u6578<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['trip_days']); ?>\u5929<\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u51fa\u767c\u65e5\u671f<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['start_date']); ?> <?php echo esc_html($vars['start_time']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u4e58\u5ba2\u4eba\u6578<\/span>\n                    <span class=\"info-value\"><?php echo esc_html($vars['passengers']); ?>\u4eba<\/span>\n                <\/div>\n                \n                <?php if ($vars['child_seats'] > 0 || $vars['booster_seats'] > 0): ?>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u52a0\u8cfc\u9805\u76ee<\/span>\n                    <span class=\"info-value\">\n                        <?php if ($vars['child_seats'] > 0): ?>\n                            \u5b30\u5152\u5ea7\u6905 x<?php echo esc_html($vars['child_seats']); ?>\n                        <?php endif; ?>\n                        <?php if ($vars['booster_seats'] > 0): ?>\n                            \u589e\u9ad8\u588a x<?php echo esc_html($vars['booster_seats']); ?>\n                        <?php endif; ?>\n                    <\/span>\n                <\/div>\n                <?php endif; ?>\n                \n                <?php if ($vars['driver_accommodation'] === 'book'): ?>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u53f8\u6a5f\u4f4f\u5bbf<\/span>\n                    <span class=\"info-value\">\u9700\u4ee3\u8a02\u4f4f\u5bbf<\/span>\n                <\/div>\n                <?php endif; ?>\n                \n                <?php if ($vars['driver_meals'] === 'allowance'): ?>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u53f8\u6a5f\u9910\u8cbb<\/span>\n                    <span class=\"info-value\">\u9700\u8981\u88dc\u8cbc<\/span>\n                <\/div>\n                <?php endif; ?>\n            <\/div>\n            \n            <!-- \u6bcf\u65e5\u8def\u7dda\u7c21\u8981 -->\n            <div class=\"section\">\n                <div class=\"section-title\">\u8def\u7dda\u5b89\u6392<\/div>\n                <?php foreach ($vars['daily_routes'] as $day => $route): ?>\n                <div style=\"margin: 10px 0;\">\n                    <strong>Day <?php echo $day + 1; ?>\uff1a<\/strong>\n                    <?php echo esc_html($route['origin'] ?? ''); ?> \u2192 \n                    <?php echo esc_html($route['destination'] ?? ''); ?>\n                <\/div>\n                <?php endforeach; ?>\n            <\/div>\n            \n            <!-- \u8cbb\u7528\u8cc7\u8a0a -->\n            <div class=\"price-highlight\">\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u7e3d\u91d1\u984d<\/span>\n                    <span class=\"total-price\">NT$ <?php echo number_format($vars['total_price']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u8a02\u91d1<\/span>\n                    <span class=\"info-value\">NT$ <?php echo number_format($vars['deposit']); ?><\/span>\n                <\/div>\n            <\/div>\n            \n            <!-- \u7ba1\u7406\u9023\u7d50 -->\n            <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"<?php echo esc_url($vars['booking_link']); ?>\" class=\"btn\">\n                    \u67e5\u770b\u9810\u7d04\u8a73\u60c5\n                <\/a>\n            <\/div>\n            \n            <!-- \u63d0\u9192\u4e8b\u9805 -->\n            <div class=\"notice\">\n                <strong>\u8655\u7406\u5efa\u8b70\uff1a<\/strong>\n                <ol style=\"margin: 5px 0; padding-left: 20px;\">\n                    <li>\u78ba\u8a8d\u884c\u7a0b\u8def\u7dda\u8207\u65e5\u671f<\/li>\n                    <li>\u806f\u7e6b\u5ba2\u6236\u78ba\u8a8d\u7d30\u7bc0<\/li>\n                    <li>\u5b89\u6392\u53f8\u6a5f\u8207\u8eca\u8f1b<\/li>\n                    <li>\u8ffd\u8e64\u8a02\u91d1\u4ed8\u6b3e\u72c0\u614b<\/li>\n                <\/ol>\n            <\/div>\n        <\/div>\n        <?php\n        return ob_get_clean();\n    }\n    \n    \/**\n     * \u4ed8\u6b3e\u63d0\u9192\u5167\u5bb9\n     *\/\n    private function get_payment_reminder_content($vars) {\n        ob_start();\n        ?>\n        <div class=\"email-header\">\n            <h1>\ud83d\udcb3 \u4ed8\u6b3e\u63d0\u9192<\/h1>\n            <p>\u8a02\u55ae\u7de8\u865f\uff1a<?php echo esc_html($vars['booking_number']); ?><\/p>\n        <\/div>\n        \n        <div class=\"email-body\">\n            <div class=\"greeting\">\n                \u89aa\u611b\u7684 <?php echo esc_html($vars['customer_name']); ?> \u60a8\u597d\uff0c\n            <\/div>\n            \n            <div class=\"notice\">\n                <strong>\u63d0\u9192\u60a8\uff1a<\/strong><br>\n                \u60a8\u7684\u5305\u8eca\u9810\u7d04\u8a02\u91d1\u5c1a\u672a\u652f\u4ed8\uff0c\u8acb\u5118\u5feb\u5b8c\u6210\u4ed8\u6b3e\u4ee5\u78ba\u4fdd\u60a8\u7684\u9810\u7d04\u3002\n            <\/div>\n            \n            <div class=\"price-highlight\">\n                <div class=\"section-title\">\u5f85\u4ed8\u6b3e\u9805<\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u61c9\u4ed8\u8a02\u91d1<\/span>\n                    <span class=\"deposit-amount\">NT$ <?php echo number_format($vars['deposit']); ?><\/span>\n                <\/div>\n                <div class=\"info-row\">\n                    <span class=\"info-label\">\u4ed8\u6b3e\u671f\u9650<\/span>\n                    <span class=\"info-value\">\u9810\u7d04\u5f8c24\u5c0f\u6642\u5167<\/span>\n                <\/div>\n            <\/div>\n            \n            <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"<?php echo esc_url($vars['payment_link']); ?>\" class=\"btn\">\n                    \u7acb\u5373\u4ed8\u6b3e\n                <\/a>\n            <\/div>\n            \n            <p style=\"text-align: center; color: #666;\">\n                \u5982\u60a8\u5df2\u5b8c\u6210\u4ed8\u6b3e\uff0c\u8acb\u5ffd\u7565\u6b64\u4fe1\u4ef6<br>\n                \u82e5\u6709\u4efb\u4f55\u554f\u984c\uff0c\u8acb\u806f\u7e6b\u5ba2\u670d\uff1a<?php echo esc_html($vars['company_phone']); ?>\n            <\/p>\n        <\/div>\n        <?php\n        return ob_get_clean();\n    }\n    \n    \/**\n     * \u9810\u8a2d\u5167\u5bb9\n     *\/\n    private function get_default_content($vars) {\n        return '<div class=\"email-body\"><p>\u90f5\u4ef6\u5167\u5bb9<\/p><\/div>';\n    }\n    \n    \/**\n     * \u53d6\u5f97\u7d14\u6587\u5b57\u6a21\u677f\n     *\/\n    private function get_text_template($type, $vars) {\n        $content = '';\n        \n        switch ($type) {\n            case 'customer_confirmation':\n                $content = $this->get_customer_confirmation_text($vars);\n                break;\n            case 'admin_notification':\n                $content = $this->get_admin_notification_text($vars);\n                break;\n            case 'payment_reminder':\n                $content = $this->get_payment_reminder_text($vars);\n                break;\n        }\n        \n        return $content;\n    }\n    \n    \/**\n     * \u5ba2\u6236\u78ba\u8a8d\u4fe1\u7d14\u6587\u5b57\u7248\n     *\/\n    private function get_customer_confirmation_text($vars) {\n        $text = \"\u89aa\u611b\u7684 {$vars['customer_name']} \u60a8\u597d\uff0c\\n\\n\";\n        $text .= \"\u60a8\u7684\u5305\u8eca\u65c5\u904a\u9810\u7d04\u5df2\u6210\u529f\u63d0\u4ea4\uff01\\n\";\n        $text .= \"\u8a02\u55ae\u7de8\u865f\uff1a{$vars['booking_number']}\\n\\n\";\n        \n        $text .= \"\u3010\u884c\u7a0b\u8cc7\u8a0a\u3011\\n\";\n        $text .= \"\u884c\u7a0b\u5929\u6578\uff1a{$vars['trip_days']}\u5929\\n\";\n        $text .= \"\u51fa\u767c\u65e5\u671f\uff1a{$vars['start_date']} {$vars['start_time']}\\n\";\n        $text .= \"\u7d50\u675f\u65e5\u671f\uff1a{$vars['end_date']}\\n\";\n        $text .= \"\u4e58\u5ba2\u4eba\u6578\uff1a{$vars['passengers']}\u4eba\\n\\n\";\n        \n        $text .= \"\u3010\u884c\u7a0b\u5b89\u6392\u3011\\n\";\n        foreach ($vars['daily_routes'] as $day => $route) {\n            $dayNum = $day + 1;\n            $text .= \"Day {$dayNum}\uff1a\\n\";\n            $text .= \"  \u8d77\u9ede\uff1a\" . ($route['origin'] ?? '\u5f85\u78ba\u8a8d') . \"\\n\";\n            $text .= \"  \u7d42\u9ede\uff1a\" . ($route['destination'] ?? '\u5f85\u78ba\u8a8d') . \"\\n\";\n            if (!empty($route['stops'])) {\n                $text .= \"  \u505c\u9760\u9ede\uff1a\" . implode('\u3001', $route['stops']) . \"\\n\";\n            }\n            $text .= \"\\n\";\n        }\n        \n        $text .= \"\u3010\u8cbb\u7528\u660e\u7d30\u3011\\n\";\n        $text .= \"\u7e3d\u91d1\u984d\uff1aNT$ \" . number_format($vars['total_price']) . \"\\n\";\n        $text .= \"\u8a02\u91d1(30%)\uff1aNT$ \" . number_format($vars['deposit']) . \"\\n\";\n        $text .= \"\u5c3e\u6b3e(70%)\uff1aNT$ \" . number_format($vars['balance']) . \"\\n\";\n        $text .= \"\u203b \u6240\u6709\u50f9\u683c\u5747\u5df2\u542b 5% \u71df\u696d\u7a05\\n\\n\";\n        \n        $text .= \"\u3010\u91cd\u8981\u63d0\u9192\u3011\\n\";\n        $text .= \"\u8acb\u65bc24\u5c0f\u6642\u5167\u652f\u4ed8\u8a02\u91d1\u4ee5\u78ba\u4fdd\u60a8\u7684\u9810\u7d04\u3002\\n\";\n        $text .= \"\u6211\u5011\u5c07\u5728\u6536\u5230\u8a02\u91d1\u5f8c\u8207\u60a8\u96fb\u8a71\u78ba\u8a8d\u8a73\u7d30\u884c\u7a0b\u3002\\n\\n\";\n        \n        if (!empty($vars['notes'])) {\n            $text .= \"\u3010\u5099\u8a3b\u3011\\n{$vars['notes']}\\n\\n\";\n        }\n        \n        $text .= \"\u611f\u8b1d\u60a8\u9078\u64c7 {$vars['company_name']}\\n\";\n        $text .= \"\u5ba2\u670d\u5c08\u7dda\uff1a{$vars['company_phone']}\\n\";\n        $text .= \"\u5ba2\u670d\u4fe1\u7bb1\uff1a{$vars['company_email']}\\n\";\n        \n        return $text;\n    }\n    \n    \/**\n     * \u7ba1\u7406\u54e1\u901a\u77e5\u7d14\u6587\u5b57\u7248\n     *\/\n    private function get_admin_notification_text($vars) {\n        $text = \"\u6709\u65b0\u7684\u5305\u8eca\u9810\u7d04\u901a\u77e5\\n\";\n        $text .= \"\u8a02\u55ae\u7de8\u865f\uff1a{$vars['booking_number']}\\n\\n\";\n        \n        $text .= \"\u3010\u5ba2\u6236\u8cc7\u8a0a\u3011\\n\";\n        $text .= \"\u59d3\u540d\uff1a{$vars['customer_name']}\\n\";\n        $text .= \"\u96fb\u8a71\uff1a{$vars['customer_phone']}\\n\";\n        $text .= \"Email\uff1a\" . ($vars['customer_email'] ?: '\u672a\u63d0\u4f9b') . \"\\n\\n\";\n        \n        $text .= \"\u3010\u884c\u7a0b\u8cc7\u8a0a\u3011\\n\";\n        $text .= \"\u884c\u7a0b\u5929\u6578\uff1a{$vars['trip_days']}\u5929\\n\";\n        $text .= \"\u51fa\u767c\u65e5\u671f\uff1a{$vars['start_date']} {$vars['start_time']}\\n\";\n        $text .= \"\u4e58\u5ba2\u4eba\u6578\uff1a{$vars['passengers']}\u4eba\\n\";\n        \n        if ($vars['child_seats'] > 0) {\n            $text .= \"\u5b30\u5152\u5ea7\u6905\uff1a{$vars['child_seats']}\u5f35\\n\";\n        }\n        if ($vars['booster_seats'] > 0) {\n            $text .= \"\u589e\u9ad8\u588a\uff1a{$vars['booster_seats']}\u5f35\\n\";\n        }\n        \n        $text .= \"\\n\u3010\u7e3d\u91d1\u984d\u3011NT$ \" . number_format($vars['total_price']) . \"\\n\";\n        $text .= \"\u3010\u8a02\u91d1\u3011NT$ \" . number_format($vars['deposit']) . \"\\n\\n\";\n        \n        $text .= \"\u8acb\u7acb\u5373\u8655\u7406\u6b64\u9810\u7d04\u3002\\n\";\n        $text .= \"\u7ba1\u7406\u9023\u7d50\uff1a{$vars['booking_link']}\\n\";\n        \n        return $text;\n    }\n    \n    \/**\n     * \u4ed8\u6b3e\u63d0\u9192\u7d14\u6587\u5b57\u7248\n     *\/\n    private function get_payment_reminder_text($vars) {\n        $text = \"\u89aa\u611b\u7684 {$vars['customer_name']} \u60a8\u597d\uff0c\\n\\n\";\n        $text .= \"\u9019\u662f\u4ed8\u6b3e\u63d0\u9192\u901a\u77e5\u3002\\n\\n\";\n        $text .= \"\u60a8\u7684\u5305\u8eca\u9810\u7d04\u8a02\u91d1\u5c1a\u672a\u652f\u4ed8\u3002\\n\";\n        $text .= \"\u8a02\u55ae\u7de8\u865f\uff1a{$vars['booking_number']}\\n\";\n        $text .= \"\u61c9\u4ed8\u8a02\u91d1\uff1aNT$ \" . number_format($vars['deposit']) . \"\\n\\n\";\n        $text .= \"\u8acb\u65bc\u9810\u7d04\u5f8c24\u5c0f\u6642\u5167\u5b8c\u6210\u4ed8\u6b3e\uff0c\u4ee5\u78ba\u4fdd\u60a8\u7684\u9810\u7d04\u3002\\n\\n\";\n        $text .= \"\u4ed8\u6b3e\u9023\u7d50\uff1a{$vars['payment_link']}\\n\\n\";\n        $text .= \"\u5982\u60a8\u5df2\u5b8c\u6210\u4ed8\u6b3e\uff0c\u8acb\u5ffd\u7565\u6b64\u4fe1\u4ef6\u3002\\n\";\n        $text .= \"\u82e5\u6709\u4efb\u4f55\u554f\u984c\uff0c\u8acb\u806f\u7e6b\u5ba2\u670d\uff1a{$vars['company_phone']}\\n\";\n        \n        return $text;\n    }\n    \n    \/**\n     * \u767c\u9001\u90f5\u4ef6\n     *\/\n    private function send_email($to, $subject, $html_content, $text_content = '') {\n        \/\/ \u6e96\u5099\u90f5\u4ef6\u6a19\u982d\n        $headers = array(\n            'Content-Type: text\/html; charset=UTF-8',\n            'From: ' . $this->custom_mail_from_name() . ' <' . $this->custom_mail_from() . '>'\n        );\n        \n        \/\/ \u5982\u679c\u6709\u7d14\u6587\u5b57\u7248\u672c\uff0c\u4f7f\u7528 multipart\n        if (!empty($text_content)) {\n            \/\/ \u9019\u88e1\u7c21\u5316\u8655\u7406\uff0c\u5be6\u969b\u53ef\u80fd\u9700\u8981\u66f4\u8907\u96dc\u7684 multipart \u8655\u7406\n            $message = $html_content;\n        } else {\n            $message = $html_content;\n        }\n        \n        \/\/ \u767c\u9001\u90f5\u4ef6\n        $result = wp_mail($to, $subject, $message, $headers);\n        \n        \/\/ \u8a18\u9304\u767c\u9001\u7d50\u679c\n        if (!$result) {\n            error_log('[29-Charter-Email] Failed to send email to: ' . $to);\n        }\n        \n        return $result;\n    }\n    \n    \/**\n     * \u81ea\u5b9a\u7fa9\u767c\u4ef6\u4eba\u90f5\u7bb1\n     *\/\n    public function custom_mail_from($email = '') {\n        return 'noreply@' . $_SERVER['SERVER_NAME'];\n    }\n    \n    \/**\n     * \u81ea\u5b9a\u7fa9\u767c\u4ef6\u4eba\u540d\u7a31\n     *\/\n    public function custom_mail_from_name($name = '') {\n        return '9o Van Strip \u5305\u8eca\u670d\u52d9';\n    }\n    \n    \/**\n     * \u8a2d\u5b9aHTML\u5167\u5bb9\u985e\u578b\n     *\/\n    public function set_html_content_type() {\n        return 'text\/html';\n    }\n}\n\n\/\/ \u521d\u59cb\u5316\nNineOVan_Charter_Email_Templates::get_instance();\n\n\/**\n * \u5168\u57df\u8f14\u52a9\u51fd\u5f0f\n *\/\n\n\/\/ \u767c\u9001\u5305\u8eca\u78ba\u8a8d\u4fe1\nif (!function_exists('_9o_van_send_charter_confirmation')) {\n    function _9o_van_send_charter_confirmation($booking_id, $booking_data) {\n        return NineOVan_Charter_Email_Templates::get_instance()\n            ->send_customer_confirmation($booking_id, $booking_data);\n    }\n}\n\n\/\/ \u767c\u9001\u7ba1\u7406\u54e1\u901a\u77e5\nif (!function_exists('_9o_van_send_charter_admin_notification')) {\n    function _9o_van_send_charter_admin_notification($booking_id, $booking_data) {\n        return NineOVan_Charter_Email_Templates::get_instance()\n            ->send_admin_notification($booking_id, $booking_data);\n    }\n}\n\n\/\/ \u767c\u9001\u4ed8\u6b3e\u63d0\u9192\nif (!function_exists('_9o_van_send_charter_payment_reminder')) {\n    function _9o_van_send_charter_payment_reminder($booking_id, $booking_data) {\n        return NineOVan_Charter_Email_Templates::get_instance()\n            ->send_payment_reminder($booking_id, $booking_data);\n    }\n}\n\n\/\/ \u8a18\u9304\u6a21\u7d44\u8f09\u5165\nif (defined('_9O_VAN_DEBUG') && _9O_VAN_DEBUG) {\n    error_log('[29-Charter-Email-Templates] \u6a21\u7d44\u5df2\u8f09\u5165 - v1.0.0');\n}","active":true,"priority":29,"modified":"2025-09-14 14:55:12","revision":"1"}]}