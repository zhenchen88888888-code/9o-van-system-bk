{"generator":"Code Snippets v3.7.0","date_created":"2025-09-13 04:54","snippets":[{"id":37,"name":"Charter Frontend System","code":"add_action('wp_head', function() {\n    global $post;\n    $content = isset($post->post_content) ? $post->post_content : '';\n    \n    if (!is_page('\u5305\u8eca\u65c5\u904a\u9810\u7d04') && !is_page('charter-booking') && !has_shortcode($content, 'charter_booking_form')) {\n        return;\n    }\n    ?>\n    \n    <!-- \u8f09\u5165 Google Maps API -->\n    <script src=\"https:\/\/maps.googleapis.com\/maps\/api\/js?key=AIzaSyD7m-umnnMHhXTi11_uvI14Rel6mCN1Dz4&libraries=places&language=zh-TW\"><\/script>\n    \n    <style type=\"text\/css\">\n    \/* \u5305\u8eca\u65c5\u904a\u7cfb\u7d71 CSS V6 - \u5b8c\u6574\u512a\u5316\u7248 *\/\n    :root {\n        --primary: #94989C;\n        --primary-dark: #7a7e82;\n        --secondary: #A8A094;\n        --danger: #dc2626;\n        --warning: #f59e0b;\n        --success: #16a34a;\n        --border: #D4CFC4;\n        --bg-light: #F5F2EE;\n        --text-main: #3C3834;\n        --text-sub: #5C5854;\n        --accent: #C8C2B8;\n        --radius: 8px;\n        --shadow: 0 1px 3px rgba(148,152,156,0.1);\n    }\n\n    #charter-booking-app {\n        max-width: 1400px;\n        margin: 0 auto;\n        padding: 20px;\n    }\n\n    .booking-container {\n        display: grid;\n        grid-template-columns: 2.5fr 1fr;\n        gap: 30px;\n    }\n\n    #charter-booking-form {\n        background: white;\n        border-radius: 12px;\n        box-shadow: var(--shadow);\n        overflow: hidden;\n        border: 1px solid var(--border);\n    }\n\n    .form-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 500px;\n        color: var(--text-sub);\n        font-size: 18px;\n    }\n\n    .form-header {\n        background: var(--primary);\n        color: white;\n        padding: 30px;\n        text-align: center;\n    }\n\n    .form-header h2 {\n        margin: 0 0 10px;\n        font-size: 28px;\n        font-weight: 600;\n    }\n\n    .form-header p {\n        margin: 0;\n        opacity: 0.95;\n        font-size: 16px;\n    }\n\n    .form-section {\n        padding: 25px;\n        border-bottom: 1px solid #f0f0f0;\n    }\n\n    .form-section:last-child {\n        border: none;\n    }\n\n    .form-section h3 {\n        margin: 0 0 20px;\n        font-size: 20px;\n        color: var(--text-main);\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-weight: 600;\n    }\n\n    .form-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n        gap: 15px;\n        margin-bottom: 15px;\n    }\n\n    .form-row.full-width {\n        grid-template-columns: 1fr;\n    }\n\n    .form-row.triple {\n        display: grid;\n        grid-template-columns: repeat(3, 1fr);\n        gap: 15px;\n    }\n\n    .form-group {\n        display: flex;\n        flex-direction: column;\n    }\n\n    .form-group label {\n        margin-bottom: 6px;\n        color: var(--text-sub);\n        font-size: 14px;\n        font-weight: 500;\n    }\n\n    .form-group label .required {\n        color: var(--danger);\n    }\n\n    .form-group input,\n    .form-group select,\n    .form-group textarea {\n        padding: 10px 12px;\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n        font-size: 15px;\n        transition: all 0.2s;\n        min-height: 44px;\n        width: 100%;\n        box-sizing: border-box;\n        background: white;\n        -webkit-appearance: none;\n    }\n\n    .form-group input:focus,\n    .form-group select:focus,\n    .form-group textarea:focus {\n        outline: none;\n        border-color: var(--primary);\n        box-shadow: 0 0 0 3px rgba(148,152,156,0.1);\n    }\n\n    \/* \u65e5\u671f\u6642\u9593\u8f38\u5165\u512a\u5316 *\/\n    input[type=\"date\"],\n    input[type=\"time\"] {\n        width: 100%;\n        max-width: 100%;\n        box-sizing: border-box;\n        -webkit-appearance: none;\n        appearance: none;\n    }\n\n    .day-route-container {\n        background: var(--bg-light);\n        border-radius: 10px;\n        padding: 20px;\n        margin-bottom: 15px;\n        border: 1px solid var(--border);\n        transition: all 0.2s;\n    }\n\n    .day-route-container:hover {\n        border-color: var(--primary);\n        box-shadow: 0 2px 8px rgba(0,0,0,0.05);\n    }\n\n    .day-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 15px;\n        flex-wrap: wrap;\n        gap: 10px;\n    }\n\n    .day-title {\n        font-size: 16px;\n        font-weight: 600;\n        color: var(--primary);\n    }\n\n    .day-badge {\n        background: var(--primary);\n        color: white;\n        padding: 2px 8px;\n        border-radius: 4px;\n        font-size: 11px;\n        display: inline-block;\n        margin-left: 8px;\n    }\n\n    .day-date {\n        color: var(--text-sub);\n        font-size: 14px;\n        white-space: nowrap;\n    }\n\n    .stops-container {\n        margin-top: 12px;\n    }\n\n    .stop-item {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-bottom: 8px;\n        background: white;\n        padding: 8px;\n        border-radius: var(--radius);\n        border: 1px solid var(--border);\n    }\n\n    .stop-item input {\n        flex: 1;\n        min-width: 0;\n        border: none !important;\n        padding: 8px !important;\n        background: transparent !important;\n    }\n\n    .stop-controls {\n        display: flex;\n        gap: 4px;\n    }\n\n    .stop-btn {\n        width: 32px;\n        height: 32px;\n        padding: 0;\n        background: white;\n        border: 1px solid var(--border);\n        border-radius: 4px;\n        color: var(--text-sub);\n        cursor: pointer;\n        font-size: 16px;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .stop-btn:hover:not(:disabled) {\n        background: var(--primary);\n        color: white;\n        border-color: var(--primary);\n    }\n\n    .stop-btn:disabled {\n        opacity: 0.3;\n        cursor: not-allowed;\n    }\n\n    .stop-btn.delete {\n        color: var(--danger);\n    }\n\n    .stop-btn.delete:hover {\n        background: var(--danger);\n        color: white;\n        border-color: var(--danger);\n    }\n\n    .address-input-wrapper {\n        position: relative;\n    }\n\n    .address-suggestions {\n        position: absolute;\n        top: 100%;\n        left: 0;\n        right: 0;\n        background: white;\n        border: 1px solid var(--border);\n        border-top: none;\n        border-radius: 0 0 var(--radius) var(--radius);\n        max-height: 200px;\n        overflow-y: auto;\n        z-index: 1000;\n        display: none;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n    }\n\n    .address-suggestions.show {\n        display: block;\n    }\n\n    .suggestion-item {\n        padding: 10px 12px;\n        cursor: pointer;\n        border-bottom: 1px solid #f0f0f0;\n        transition: background 0.2s;\n    }\n\n    .suggestion-item:hover {\n        background: var(--bg-light);\n    }\n\n    .suggestion-main {\n        font-weight: 500;\n        color: var(--text-main);\n    }\n\n    .suggestion-secondary {\n        font-size: 12px;\n        color: var(--text-sub);\n        margin-top: 2px;\n    }\n\n    \/* \u53f8\u6a5f\u9078\u9805\u6309\u9215 - \u53c3\u8003\u5716\u7247\u7684\u5361\u7247\u5f0f\u8a2d\u8a08 *\/\n    .radio-group {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 10px;\n        max-width: 400px;\n    }\n\n    .radio-item {\n        position: relative;\n        background: white;\n        border: 1px solid var(--border);\n        border-radius: var(--radius);\n        padding: 12px 14px;\n        cursor: pointer;\n        transition: all 0.2s;\n        text-align: center;\n    }\n\n    .radio-item:hover {\n        border-color: var(--primary);\n        background: var(--bg-light);\n        transform: translateY(-1px);\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n\n    .radio-item input[type=\"radio\"] {\n        position: absolute;\n        opacity: 0;\n        width: 0;\n        height: 0;\n    }\n\n    .radio-item label {\n        display: block;\n        cursor: pointer;\n        font-size: 13px;\n        color: var(--text-main);\n        line-height: 1.4;\n        margin: 0;\n        font-weight: 500;\n    }\n\n    .radio-item label .price {\n        display: block;\n        font-size: 11px;\n        color: var(--text-sub);\n        margin-top: 4px;\n        font-weight: 400;\n    }\n\n    .radio-item.selected {\n        border-color: var(--primary);\n        background: var(--bg-light);\n        box-shadow: 0 0 0 2px rgba(148,152,156,0.15);\n    }\n\n    .radio-item.selected::after {\n        content: \"\u2713\";\n        position: absolute;\n        top: 8px;\n        right: 8px;\n        width: 20px;\n        height: 20px;\n        background: var(--primary);\n        color: white;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 12px;\n    }\n\n    .btn-add-stop {\n        padding: 10px 16px;\n        background: var(--secondary);\n        color: white;\n        border: none;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 14px;\n        transition: all 0.2s;\n        font-weight: 500;\n    }\n\n    .btn-add-stop:hover {\n        background: #968876;\n        transform: translateY(-1px);\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n    }\n\n    .btn-submit {\n        background: var(--primary);\n        color: white;\n        width: 100%;\n        padding: 15px;\n        border: none;\n        border-radius: 10px;\n        font-size: 16px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.3s;\n        margin-top: 20px;\n        min-height: 50px;\n    }\n\n    .btn-submit:hover {\n        background: var(--primary-dark);\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(148,152,156,0.3);\n    }\n\n    .btn-submit:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n        transform: none;\n    }\n\n    .alert-box {\n        padding: 12px 16px;\n        border-radius: 6px;\n        margin: 10px 0;\n        font-size: 14px;\n        line-height: 1.5;\n        display: none;\n    }\n\n    .alert-box.show {\n        display: block;\n    }\n\n    .mountain-alert {\n        background: #fef3c7;\n        border-left: 4px solid var(--warning);\n        color: #92400e;\n    }\n\n    .excluded-alert {\n        background: #fee2e2;\n        border-left: 4px solid var(--danger);\n        color: #991b1b;\n    }\n\n    .info-box, .safety-alert {\n        background: var(--bg-light);\n        border-left: 4px solid var(--secondary);\n        padding: 14px 18px;\n        border-radius: 6px;\n        font-size: 14px;\n        line-height: 1.6;\n        color: var(--text-main);\n        margin-top: 12px;\n    }\n    \n    .safety-alert {\n        background: rgba(245, 158, 11, 0.08);\n        border-left-color: var(--warning);\n        color: #92400e;\n        margin-bottom: 15px;\n    }\n    \n    .safety-alert strong {\n        color: #b45309;\n    }\n\n\t.email-notice {\n\t\tfont-size: 12px;\n\t\tcolor: #6b7280;\n\t\tmargin-top: 5px;\n\t\tfont-style: italic;\n\t\tdisplay: block;\n\t}\n\t\t   \n    \/* ========================================\n       \u5373\u6642\u5831\u50f9\u9762\u677f V6\n       ======================================== *\/\n    #price-panel {\n        background: white;\n        border-radius: 12px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        padding: 0;\n        position: sticky;\n        top: 20px;\n        height: fit-content;\n        overflow: hidden;\n        border: 1px solid var(--border);\n    }\n\n    #price-panel h3 {\n        margin: 0;\n        padding: 20px 25px;\n        background: var(--primary);\n        color: white;\n        font-size: 18px;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n\n    #price-panel h3:before {\n        content: \"\ud83d\udcb0\";\n        font-size: 20px;\n    }\n\n    .price-content {\n        padding: 20px 25px 25px;\n        background: white;\n    }\n\n    .price-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 150px;\n        color: var(--text-sub);\n        font-size: 14px;\n    }\n\n    \/* \u50f9\u683c\u9805\u76ee *\/\n    .price-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 0;\n        border-bottom: 1px solid #f3f4f6;\n        font-size: 14px;\n        transition: all 0.2s;\n    }\n\n    .price-item:hover {\n        padding-left: 5px;\n    }\n\n    .price-item span:first-child {\n        color: var(--text-main);\n        font-weight: 500;\n    }\n\n    .price-item span:last-child {\n        color: var(--primary);\n        font-weight: 600;\n        white-space: nowrap;\n    }\n\n    \/* \u7d30\u7bc0\u9805\u76ee *\/\n    .price-item.detail {\n        padding-left: 20px;\n        font-size: 13px;\n        border-bottom: 1px dashed #f9fafb;\n    }\n\n    .price-item.detail span:first-child {\n        color: var(--text-sub);\n        font-weight: 400;\n    }\n\n    .price-item.detail span:last-child {\n        color: var(--text-sub);\n    }\n\n    \/* \u5730\u5340\u6a19\u8a18 *\/\n    .price-region {\n        background: #f3f4f6;\n        padding: 10px 14px;\n        margin: 8px 0;\n        border-radius: 8px;\n        font-size: 14px;\n        color: var(--text-main);\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-weight: 500;\n    }\n\n    .price-region:before {\n        content: \"\ud83d\udccd\";\n        font-size: 16px;\n    }\n\n    .price-region.south {\n        background: #fef3c7;\n        color: #92400e;\n    }\n\n    \/* \u5c71\u5340\u9805\u76ee *\/\n    .price-item.mountain {\n        background: #fef3c7;\n        padding: 10px 14px;\n        margin: 8px 0;\n        border-radius: 8px;\n        border-left: 3px solid var(--warning);\n        border-bottom: none;\n    }\n\n    .price-item.mountain span:first-child {\n        color: #92400e;\n        font-weight: 600;\n    }\n\n    .price-item.mountain span:last-child {\n        color: #92400e;\n        font-weight: 700;\n    }\n\n    \/* \u7e3d\u8a08\u5340\u584a - \u512a\u5316\u6587\u5b57\u5927\u5c0f *\/\n    .price-total {\n        margin-top: 20px;\n        padding: 16px 14px;\n        background: var(--bg-light);\n        border-radius: 10px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border: 2px solid var(--primary);\n    }\n\n    .price-total span:first-child {\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-main);\n        white-space: nowrap;\n    }\n\n    .price-total span:last-child {\n        font-size: 24px;\n        font-weight: bold;\n        color: var(--primary);\n        white-space: nowrap;\n    }\n\n    \/* \u8a02\u91d1\u8cc7\u8a0a *\/\n    .deposit-info {\n        margin-top: 15px;\n        padding: 15px;\n        background: white;\n        border-radius: 8px;\n        border: 1px solid var(--border);\n    }\n\n    .deposit-item {\n        display: flex;\n        justify-content: space-between;\n        padding: 10px 0;\n        font-size: 14px;\n    }\n\n    .deposit-item:first-child {\n        border-bottom: 1px solid var(--border);\n        padding-bottom: 12px;\n    }\n\n    .deposit-item:last-child {\n        padding-top: 12px;\n    }\n\n    .deposit-item span:first-child {\n        color: var(--text-sub);\n    }\n\n    .deposit-item span:last-child {\n        font-weight: 600;\n        color: var(--text-main);\n    }\n\n    \/* \u63d0\u9192\u6846 *\/\n    .notice-box {\n        background: #fef3c7;\n        border-left: 4px solid var(--warning);\n        padding: 12px 15px;\n        margin-top: 15px;\n        border-radius: 6px;\n        font-size: 13px;\n        color: #92400e;\n        line-height: 1.5;\n    }\n\n    .notice-box strong {\n        color: #b45309;\n    }\n\n    .spinner {\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        border: 2px solid rgba(255,255,255,.3);\n        border-radius: 50%;\n        border-top-color: #fff;\n        animation: spin 0.8s linear infinite;\n    }\n\n    @keyframes spin {\n        to { transform: rotate(360deg); }\n    }\n\n    \/* \u97ff\u61c9\u5f0f\u8a2d\u8a08 *\/\n    @media (max-width: 1024px) {\n        .booking-container {\n            grid-template-columns: 1fr;\n        }\n        \n        #price-panel {\n            position: relative;\n            margin-top: 20px;\n        }\n    }\n\n    @media (max-width: 768px) {\n        #charter-booking-app {\n            padding: 10px;\n        }\n        \n        .form-section {\n            padding: 15px;\n        }\n        \n        .form-header {\n            padding: 20px 15px;\n        }\n        \n        .form-header h2 {\n            font-size: 22px;\n        }\n        \n        \/* \u8868\u55ae\u5217\u6539\u70ba\u55ae\u6b04 *\/\n        .form-row,\n        .form-row.triple {\n            grid-template-columns: 1fr !important;\n        }\n        \n        \/* \u624b\u6a5f\u7248radio\u6309\u9215\u4fdd\u63012\u5217 *\/\n        .radio-group {\n            grid-template-columns: 1fr 1fr;\n            gap: 8px;\n        }\n        \n        .radio-item {\n            padding: 10px 8px;\n        }\n        \n        .radio-item label {\n            font-size: 12px;\n        }\n        \n        .day-route-container {\n            padding: 15px;\n        }\n        \n        \/* \u65e5\u671f\u6b04\u4f4d\u512a\u5316 *\/\n        .day-header {\n            flex-direction: column;\n            align-items: flex-start;\n        }\n        \n        .day-date {\n            font-size: 13px;\n            word-break: break-word;\n        }\n        \n        .stop-item {\n            padding: 6px;\n            gap: 6px;\n        }\n        \n        .stop-btn {\n            width: 30px;\n            height: 30px;\n            font-size: 14px;\n        }\n        \n        .form-group input,\n        .form-group select,\n        .form-group textarea {\n            font-size: 16px;\n            padding: 12px;\n            min-height: 48px;\n        }\n        \n        \/* \u7279\u5225\u8655\u7406\u65e5\u671f\u8f38\u5165 *\/\n        input[type=\"date\"],\n        input[type=\"time\"] {\n            font-size: 16px;\n        }\n        \n        .btn-add-stop {\n            width: 100%;\n            padding: 12px;\n            font-size: 15px;\n        }\n        \n        .btn-submit {\n            padding: 16px;\n            font-size: 17px;\n            min-height: 54px;\n        }\n        \n        \/* \u50f9\u683c\u9762\u677f\u624b\u6a5f\u7248\u8abf\u6574 *\/\n        #price-panel h3 {\n            padding: 15px 20px;\n            font-size: 16px;\n        }\n        \n        .price-content {\n            padding: 15px 20px 20px;\n        }\n        \n        .price-total {\n            padding: 15px 12px;\n        }\n        \n        .price-total span:first-child {\n            font-size: 12px;\n        }\n        \n        .price-total span:last-child {\n            font-size: 20px;\n        }\n    }\n\n    @media (max-width: 380px) {\n        .form-section {\n            padding: 12px;\n        }\n        \n        .form-section h3 {\n            font-size: 18px;\n        }\n        \n        .radio-item {\n            padding: 8px 6px;\n        }\n        \n        .radio-item label {\n            font-size: 11px;\n        }\n        \n        .stop-btn {\n            width: 28px;\n            height: 28px;\n            font-size: 12px;\n        }\n        \n        .form-group label {\n            font-size: 13px;\n        }\n        \n        .price-total span:last-child {\n            font-size: 18px;\n        }\n    }\n    <\/style>\n    <?php\n});\n\n\/\/ ====================================\n\/\/ \u8f09\u5165JavaScript\n\/\/ ====================================\nadd_action('wp_footer', function() {\n    global $post;\n    $content = isset($post->post_content) ? $post->post_content : '';\n    \n    if (!is_page('\u5305\u8eca\u65c5\u904a\u9810\u7d04') && !is_page('charter-booking') && !has_shortcode($content, 'charter_booking_form')) {\n        return;\n    }\n    ?>\n    \n    <script type=\"text\/javascript\">\n    (function($) {\n        'use strict';\n        \n        \/\/ \u7b49\u5f85jQuery\u8f09\u5165\n        if (typeof jQuery === 'undefined') {\n            setTimeout(arguments.callee, 100);\n            return;\n        }\n        \n        $(document).ready(function() {\n            \/\/ \u5168\u57df\u914d\u7f6e\n            const CONFIG = {\n                ajaxUrl: '<?php echo admin_url(\"admin-ajax.php\"); ?>',\n                minDate: '<?php echo date(\"Y-m-d\", strtotime(\"+2 days\")); ?>',\n                maxDays: 7,\n                maxStops: 6\n            };\n            \n            \/\/ \u5305\u8eca\u9810\u7d04\u61c9\u7528\u7a0b\u5f0f\n            const CharterBooking = {\n                \/\/ \u72c0\u614b\u7ba1\u7406\n                state: {\n                    tripDays: 1,\n                    dailyRoutes: [],\n                    isSubmitting: false,\n                    lastTotalPrice: 0,\n                    calcTimeout: null,\n                    mountainDetection: {}\n                },\n                \n                \/\/ \u521d\u59cb\u5316\n                init() {\n                    if (!$('#charter-booking-form').length) return false;\n                    \n                    this.buildForm();\n                    this.bindEvents();\n                    \n                    \/\/ \u5ef6\u9072\u521d\u59cb\u8a08\u7b97\n                    setTimeout(() => this.calculatePrice(), 1000);\n                    \n                    return true;\n                },\n                \n                \/\/ \u5efa\u7acb\u8868\u55ae\n                buildForm() {\n                    const formHTML = this.getFormTemplate();\n                    $('#charter-booking-form').html(formHTML);\n                    \n                    this.updateDriverSection();\n                    this.updateDailyRoutes();\n                },\n                \n                \/\/ \u8868\u55ae\u6a21\u677f\n                getFormTemplate() {\n                    return `\n                        <div class=\"form-header\">\n                            <h2>\ud83d\ude90 \u5305\u8eca\u65c5\u904a\u9810\u7d04<\/h2>\n                            <p>\u5c08\u696d\u53f8\u6a5f\u00b7\u8212\u9069\u4e5d\u4eba\u5ea7\u00b7\u5168\u53f0\u8d70\u900f\u900f<\/p>\n                        <\/div>\n                        \n                        ${this.getSectionTemplate('basic')}\n                        ${this.getSectionTemplate('routes')}\n                        ${this.getSectionTemplate('driver')}\n                        ${this.getSectionTemplate('addon')}\n                        ${this.getSectionTemplate('contact')}\n                        \n                        <button type=\"submit\" class=\"btn-submit\">\u63d0\u4ea4\u9810\u7d04<\/button>\n                    `;\n                },\n                \n                \/\/ \u53d6\u5f97\u5340\u584a\u6a21\u677f\n                getSectionTemplate(type) {\n                    const templates = {\n                        basic: `\n                            <div class=\"form-section\">\n                                <h3>\ud83d\udcc5 \u57fa\u672c\u8cc7\u8a0a<\/h3>\n                                <div class=\"form-row triple\">\n                                    <div class=\"form-group\">\n                                        <label>\u4f7f\u7528\u5929\u6578 <span class=\"required\">*<\/span><\/label>\n                                        <select name=\"trip_days\" id=\"trip_days\" required>\n                                            ${[...Array(7)].map((_, i) => \n                                                `<option value=\"${i+1}\">${i+1}\u5929<\/option>`\n                                            ).join('')}\n                                        <\/select>\n                                    <\/div>\n                                    <div class=\"form-group\">\n                                        <label>\u51fa\u767c\u65e5\u671f <span class=\"required\">*<\/span><\/label>\n                                        <input type=\"date\" name=\"start_date\" id=\"start_date\" \n                                               min=\"${CONFIG.minDate}\" value=\"${CONFIG.minDate}\" required>\n                                    <\/div>\n                                    <div class=\"form-group\">\n                                        <label>\u51fa\u767c\u6642\u9593 <span class=\"required\">*<\/span><\/label>\n                                        <input type=\"time\" name=\"start_time\" id=\"start_time\" value=\"08:00\" required>\n                                    <\/div>\n                                <\/div>\n                                <div class=\"form-row full-width\">\n                                    <div class=\"form-group\">\n                                        <label>\u4e58\u5ba2\u4eba\u6578 <span class=\"required\">*<\/span><\/label>\n                                        <input type=\"number\" name=\"passengers\" id=\"passengers\" \n                                               min=\"1\" max=\"8\" value=\"4\" required>\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                        `,\n                        routes: `\n                            <div class=\"form-section\">\n                                <h3>\ud83d\uddfa\ufe0f \u6bcf\u65e5\u884c\u7a0b\u898f\u5283<\/h3>\n                                <div id=\"daily-routes-container\"><\/div>\n                            <\/div>\n                        `,\n                        driver: `\n                            <div class=\"form-section\" id=\"driver-section\">\n                                <h3>\ud83c\udfe8 \u53f8\u6a5f\u5b89\u6392<\/h3>\n                                <div class=\"form-row\" id=\"driver-options\"><\/div>\n                                <div class=\"info-box\" id=\"driver-info\"><\/div>\n                            <\/div>\n                        `,\n                        addon: `\n                            <div class=\"form-section\">\n                                <h3>\ud83d\udd27 \u52a0\u8cfc\u9805\u76ee<\/h3>\n                                <div class=\"safety-alert\">\n                                    \u6839\u64da\u300a\u5c0f\u578b\u8eca\u9644\u8f09\u5e7c\u7ae5\u5b89\u5168\u4e58\u5750\u5be6\u65bd\u53ca\u5ba3\u5c0e\u8fa6\u6cd5\u300b\uff0c<strong>4\u6b72\u4ee5\u4e0b\u5b69\u7ae5\u7686\u9700\u4f7f\u7528\u5b89\u5168\u5ea7\u6905<\/strong>\n                                <\/div>\n                                <div class=\"form-row\">\n                                    <div class=\"form-group\">\n                                        <label>\u5b30\u5152\u5b89\u5168\u5ea7\u6905 (\u6bcf\u5f35NT$100)<\/label>\n                                        <input type=\"number\" name=\"child_seats\" id=\"child_seats\" min=\"0\" max=\"4\" value=\"0\">\n                                    <\/div>\n                                    <div class=\"form-group\">\n                                        <label>\u5152\u7ae5\u589e\u9ad8\u588a (\u6bcf\u5f35NT$100)<\/label>\n                                        <input type=\"number\" name=\"booster_seats\" id=\"booster_seats\" min=\"0\" max=\"4\" value=\"0\">\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                        `,\n                        contact: `\n\t\t\t\t\t\t\t<div class=\"form-section\">\n\t\t\t\t\t\t\t\t<h3>\ud83d\udcde \u806f\u7d61\u8cc7\u8a0a<\/h3>\n\t\t\t\t\t\t\t\t<div class=\"form-row\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<label>\u806f\u7d61\u4eba\u59d3\u540d <span class=\"required\">*<\/span><\/label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"text\" name=\"customer_name\" id=\"customer_name\" \n\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"\u8acb\u8f38\u5165\u60a8\u7684\u59d3\u540d\" required>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<label>\u96fb\u8a71 <span class=\"required\">*<\/span> (\u542b\u570b\u969b\u5340\u865f)<\/label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"tel\" name=\"customer_phone\" id=\"customer_phone\" \n\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"+886912345678 \u6216 0912345678\" required\n\t\t\t\t\t\t\t\t\t\t\t   pattern=\"(\\\\+[0-9]{1,4})?[0-9]{9,15}\"\n\t\t\t\t\t\t\t\t\t\t\t   title=\"\u8acb\u8f38\u5165\u6709\u6548\u96fb\u8a71\u865f\u78bc\uff0c\u53ef\u542b\u570b\u969b\u5340\u865f\">\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class=\"form-row full-width\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<label>Email\uff08\u9078\u586b\uff09<\/label>\n\t\t\t\t\t\t\t\t\t\t<input type=\"email\" name=\"customer_email\" id=\"customer_email\"\n\t\t\t\t\t\t\t\t\t\t\t   placeholder=\"example@email.com\">\n\t\t\t\t\t\t\t\t\t\t<span class=\"email-notice\">\u203b \u672a\u586b\u5beb\u5c07\u4e0d\u6703\u6536\u5230\u78ba\u8a8d\u4fe1\u4ef6\u901a\u77e5<\/span>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class=\"form-row full-width\">\n\t\t\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t\t\t<label>\u5099\u8a3b\u8aaa\u660e<\/label>\n\t\t\t\t\t\t\t\t\t\t<textarea name=\"notes\" id=\"notes\" rows=\"3\"><\/textarea>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t`\n                                          \n                    };\n                    return templates[type] || '';\n                },\n                \n                \/\/ \u66f4\u65b0\u53f8\u6a5f\u5340\u584a - \u5361\u7247\u5f0f\u6309\u9215\u8a2d\u8a08\n                updateDriverSection() {\n                    const tripDays = parseInt($('#trip_days').val()) || 1;\n                    const isMultiDay = tripDays > 1;\n                    \n                    const optionsHTML = `\n                        ${isMultiDay ? `\n                            <div class=\"form-group\">\n                                <label>\u53f8\u6a5f\u4f4f\u5bbf<\/label>\n                                <div class=\"radio-group\">\n                                    <div class=\"radio-item\">\n                                        <input type=\"radio\" name=\"driver_accommodation\" value=\"self\" id=\"accommodation_self\" checked>\n                                        <label for=\"accommodation_self\">\n                                            \u63d0\u4f9b\u4f4f\u5bbf\n                                            <span class=\"price\">\u7531\u5ba2\u6236\u5b89\u6392<\/span>\n                                        <\/label>\n                                    <\/div>\n                                    <div class=\"radio-item\">\n                                        <input type=\"radio\" name=\"driver_accommodation\" value=\"book\" id=\"accommodation_book\">\n                                        <label for=\"accommodation_book\">\n                                            \u4ee3\u8a02\u4f4f\u5bbf\n                                            <span class=\"price\">+2,000\/\u665a<\/span>\n                                        <\/label>\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                        ` : '<input type=\"hidden\" name=\"driver_accommodation\" value=\"self\">'}\n                        \n                        <div class=\"form-group\">\n                            <label>\u53f8\u6a5f\u7528\u9910<\/label>\n                            <div class=\"radio-group\">\n                                <div class=\"radio-item\">\n                                    <input type=\"radio\" name=\"driver_meals\" value=\"provided\" id=\"meals_provided\" checked>\n                                    <label for=\"meals_provided\">\n                                        \u63d0\u4f9b\u9910\u9ede\n                                        <span class=\"price\">\u7531\u5ba2\u6236\u5b89\u6392<\/span>\n                                    <\/label>\n                                <\/div>\n                                <div class=\"radio-item\">\n                                    <input type=\"radio\" name=\"driver_meals\" value=\"allowance\" id=\"meals_allowance\">\n                                    <label for=\"meals_allowance\">\n                                        \u9910\u8cbb\u88dc\u8cbc\n                                        <span class=\"price\">+400\/\u65e5<\/span>\n                                    <\/label>\n                                <\/div>\n                            <\/div>\n                        <\/div>\n                    `;\n                    \n                    $('#driver-options').html(optionsHTML);\n                    $('#driver-info').html(isMultiDay ? \n                        '\u591a\u65e5\u884c\u7a0b\u9700\u5b89\u6392\u53f8\u6a5f\u4f4f\u5bbf\uff0c\u53ef\u9078\u64c7\u7531\u6211\u5011\u4ee3\u8a02\u6216\u63d0\u4f9b\u4f4f\u5bbf\u3002' : \n                        '\u9910\u9ede\u90e8\u5206\u53ef\u76f4\u63a5\u63d0\u4f9b\u6216\u7d66\u4e88\u9910\u8cbb\u88dc\u8cbc\u3002'\n                    );\n                    \n                    this.updateRadioStyles();\n                },\n                \n                \/\/ \u66f4\u65b0\u6bcf\u65e5\u8def\u7dda\n                updateDailyRoutes() {\n                    const days = parseInt($('#trip_days').val()) || 1;\n                    const container = $('#daily-routes-container');\n                    \n                    \/\/ \u78ba\u4fdd\u8def\u7dda\u9663\u5217\u5927\u5c0f\u6b63\u78ba\n                    while (this.state.dailyRoutes.length < days) {\n                        this.state.dailyRoutes.push({ origin: '', destination: '', stops: [] });\n                    }\n                    \n                    \/\/ \u751f\u6210\u6bcf\u65e5\u884c\u7a0bHTML\n                    const routesHTML = Array.from({length: days}, (_, i) => \n                        this.getDayRouteTemplate(i)\n                    ).join('');\n                    \n                    container.html(routesHTML);\n                    \n                    \/\/ \u6062\u5fa9\u505c\u9760\u9ede\n                    this.state.dailyRoutes.forEach((route, dayIndex) => {\n                        route.stops?.forEach(stop => this.addStop(dayIndex, stop));\n                    });\n                    \n                    \/\/ \u521d\u59cb\u5316\u5730\u5740\u81ea\u52d5\u5b8c\u6210\n                    this.initAllAutocomplete();\n                    this.updateDayDates();\n                },\n                \n                \/\/ \u53d6\u5f97\u55ae\u65e5\u8def\u7dda\u6a21\u677f\n                getDayRouteTemplate(dayIndex) {\n                    const dayNum = dayIndex + 1;\n                    const route = this.state.dailyRoutes[dayIndex] || {};\n                    const tripDays = parseInt($('#trip_days').val()) || 1;\n                    \n                    return `\n                        <div class=\"day-route-container\" data-day=\"${dayIndex}\">\n                            <div class=\"day-header\">\n                                <div class=\"day-title\">\n                                    <span>Day ${dayNum}<\/span>\n                                    ${dayIndex === 0 ? '<span class=\"day-badge\">\u51fa\u767c\u65e5<\/span>' : ''}\n                                    ${dayIndex === tripDays - 1 && tripDays > 1 ? '<span class=\"day-badge\">\u8fd4\u7a0b\u65e5<\/span>' : ''}\n                                <\/div>\n                                <div class=\"day-date\" id=\"day-date-${dayIndex}\"><\/div>\n                            <\/div>\n                            \n                            <div class=\"form-row\">\n                                <div class=\"form-group\">\n                                    <label>\u8d77\u9ede\u5730\u5740 <span class=\"required\">*<\/span><\/label>\n                                    <div class=\"address-input-wrapper\">\n                                        <input type=\"text\" name=\"origin_${dayIndex}\" id=\"origin_${dayIndex}\"\n                                               class=\"address-autocomplete\" placeholder=\"\u8f38\u5165\u5730\u5740\u6216\u5730\u6a19\"\n                                               value=\"${route.origin || ''}\" required>\n                                        <div class=\"address-suggestions\" id=\"origin_${dayIndex}_suggestions\"><\/div>\n                                    <\/div>\n                                <\/div>\n                                \n                                <div class=\"form-group\">\n                                    <label>\u7d42\u9ede\u5730\u5740 <span class=\"required\">*<\/span><\/label>\n                                    <div class=\"address-input-wrapper\">\n                                        <input type=\"text\" name=\"destination_${dayIndex}\" id=\"destination_${dayIndex}\"\n                                               class=\"address-autocomplete\" placeholder=\"\u8f38\u5165\u5730\u5740\u6216\u5730\u6a19\"\n                                               value=\"${route.destination || ''}\" required>\n                                        <div class=\"address-suggestions\" id=\"destination_${dayIndex}_suggestions\"><\/div>\n                                    <\/div>\n                                <\/div>\n                            <\/div>\n                            \n                            <div class=\"form-group\">\n                                <label>\u9810\u6392\u505c\u9760\u9ede\uff08\u9078\u586b\uff0c\u6700\u591a${CONFIG.maxStops}\u500b\uff09<\/label>\n                                <div class=\"stops-container\" id=\"stops-container-${dayIndex}\"><\/div>\n                                <button type=\"button\" class=\"btn-add-stop\" data-day=\"${dayIndex}\">\n                                    + \u65b0\u589e\u505c\u9760\u9ede\n                                <\/button>\n                            <\/div>\n                            \n                            <div class=\"mountain-alert alert-box\" id=\"mountain-alert-${dayIndex}\">\n                                <strong>\u26f0\ufe0f \u5c71\u5340\u8def\u7dda\u63d0\u9192\uff1a<\/strong>\n                                \u7cfb\u7d71\u5075\u6e2c\u5230\u53ef\u80fd\u5305\u542b\u5c71\u5340\u8def\u7dda\uff0c\u5c07\u81ea\u52d5\u52a0\u6536\u5c71\u5340\u670d\u52d9\u8cbb NT$1,000\/\u65e5\u3002\n                            <\/div>\n                            \n                            <div class=\"excluded-alert alert-box\" id=\"excluded-alert-${dayIndex}\">\n                                <strong>\u274c \u670d\u52d9\u7bc4\u570d\u63d0\u9192\uff1a<\/strong>\n                                \u5f88\u62b1\u6b49\uff0c\u6211\u5011\u4e0d\u63d0\u4f9b\u53f8\u99ac\u5eab\u65af\u5730\u5340\u7684\u670d\u52d9\u3002\n                            <\/div>\n                        <\/div>\n                    `;\n                },\n                \n                \/\/ \u65b0\u589e\u505c\u9760\u9ede\n                addStop(dayIndex, address = '') {\n                    const container = $(`#stops-container-${dayIndex}`);\n                    const stopCount = container.find('.stop-item').length;\n                    \n                    if (stopCount >= CONFIG.maxStops) {\n                        alert(`\u6bcf\u65e5\u6700\u591a\u53ea\u80fd\u65b0\u589e${CONFIG.maxStops}\u500b\u505c\u9760\u9ede`);\n                        return;\n                    }\n                    \n                    const stopId = `stop_${dayIndex}_${stopCount}`;\n                    const stopHTML = `\n                        <div class=\"stop-item\" data-index=\"${stopCount}\" data-day=\"${dayIndex}\">\n                            <div class=\"address-input-wrapper\" style=\"flex: 1;\">\n                                <input type=\"text\" id=\"${stopId}\" class=\"address-autocomplete stop-input\"\n                                       placeholder=\"\u505c\u9760\u9ede ${stopCount + 1}\" value=\"${address}\">\n                                <div class=\"address-suggestions\" id=\"${stopId}_suggestions\"><\/div>\n                            <\/div>\n                            <div class=\"stop-controls\">\n                                <button type=\"button\" class=\"stop-btn\" data-action=\"up\" data-day=\"${dayIndex}\" \n                                        ${stopCount === 0 ? 'disabled' : ''}>\u2191<\/button>\n                                <button type=\"button\" class=\"stop-btn\" data-action=\"down\" data-day=\"${dayIndex}\" \n                                        disabled>\u2193<\/button>\n                                <button type=\"button\" class=\"stop-btn delete\" data-action=\"delete\" data-day=\"${dayIndex}\">\u00d7<\/button>\n                            <\/div>\n                        <\/div>\n                    `;\n                    \n                    container.append(stopHTML);\n                    this.updateStopButtons(dayIndex);\n                    this.initAutocomplete(stopId);\n                },\n                \n                \/\/ \u66f4\u65b0\u505c\u9760\u9ede\u6309\u9215\u72c0\u614b\n                updateStopButtons(dayIndex) {\n                    const items = $(`#stops-container-${dayIndex} .stop-item`);\n                    \n                    items.each(function(index) {\n                        const $item = $(this);\n                        $item.attr('data-index', index);\n                        $item.find('.stop-input').attr('placeholder', `\u505c\u9760\u9ede ${index + 1}`);\n                        \n                        const $upBtn = $item.find('[data-action=\"up\"]');\n                        const $downBtn = $item.find('[data-action=\"down\"]');\n                        \n                        $upBtn.prop('disabled', index === 0);\n                        $downBtn.prop('disabled', index === items.length - 1);\n                    });\n                },\n                \n                \/\/ \u521d\u59cb\u5316\u6240\u6709\u81ea\u52d5\u5b8c\u6210\n                initAllAutocomplete() {\n                    $('.address-autocomplete').each((_, el) => {\n                        this.initAutocomplete(el.id);\n                    });\n                },\n                \n                \/\/ \u521d\u59cb\u5316\u5730\u5740\u81ea\u52d5\u5b8c\u6210\n                initAutocomplete(inputId) {\n                    const $input = $(`#${inputId}`);\n                    const $suggestions = $(`#${inputId}_suggestions`);\n                    let debounceTimer;\n                    \n                    $input\n                        .off('input blur')\n                        .on('input', function() {\n                            clearTimeout(debounceTimer);\n                            const value = $(this).val();\n                            \n                            if (value.length < 2) {\n                                $suggestions.removeClass('show');\n                                return;\n                            }\n                            \n                            debounceTimer = setTimeout(() => {\n                                CharterBooking.fetchSuggestions(value, $suggestions);\n                            }, 300);\n                        })\n                        .on('blur', function() {\n                            const address = $(this).val();\n                            if (address) CharterBooking.validateAddress(address, $(this));\n                            \n                            setTimeout(() => $suggestions.removeClass('show'), 200);\n                        });\n                    \n                    \/\/ \u9078\u64c7\u5efa\u8b70\n                    $suggestions.off('click').on('click', '.suggestion-item', function() {\n                        const address = $(this).data('description');\n                        $input.val(address);\n                        $suggestions.removeClass('show');\n                        CharterBooking.validateAddress(address, $input);\n                        CharterBooking.debouncedCalc();\n                    });\n                },\n                \n                \/\/ \u53d6\u5f97\u5730\u5740\u5efa\u8b70\n                fetchSuggestions(input, $container) {\n                    $.post(CONFIG.ajaxUrl, {\n                        action: 'autocomplete_address',\n                        input: input\n                    }).done(response => {\n                        if (response.success && response.data) {\n                            const html = response.data.map(s => `\n                                <div class=\"suggestion-item\" data-description=\"${s.description}\">\n                                    <div class=\"suggestion-main\">${s.main_text || s.description}<\/div>\n                                    ${s.secondary_text ? `<div class=\"suggestion-secondary\">${s.secondary_text}<\/div>` : ''}\n                                <\/div>\n                            `).join('');\n                            \n                            $container.html(html).addClass('show');\n                        } else {\n                            $container.removeClass('show');\n                        }\n                    });\n                },\n                \n                \/\/ \u9a57\u8b49\u5730\u5740\n                validateAddress(address, $input) {\n                    $.post(CONFIG.ajaxUrl, {\n                        action: 'validate_address',\n                        address: address\n                    }).done(response => {\n                        if (response.success && response.data) {\n                            const dayIndex = this.getDayIndex($input);\n                            if (dayIndex === -1) return;\n                            \n                            \/\/ \u66f4\u65b0\u5c71\u5340\u63d0\u9192\n                            const $alert = $(`#mountain-alert-${dayIndex}`);\n                            if (response.data.is_mountain && response.data.mountain_confidence > 70) {\n                                $alert.addClass('show');\n                            } else {\n                                $alert.removeClass('show');\n                            }\n                            \n                            this.debouncedCalc();\n                        }\n                    });\n                },\n                \n                \/\/ \u53d6\u5f97\u65e5\u671f\u7d22\u5f15\n                getDayIndex($input) {\n                    const id = $input.attr('id');\n                    const match = id.match(\/_(\\d+)(?:_\\d+)?$\/);\n                    return match ? parseInt(match[1]) : -1;\n                },\n                \n                \/\/ \u66f4\u65b0\u65e5\u671f\u986f\u793a\n                updateDayDates() {\n                    const startDate = $('#start_date').val();\n                    if (!startDate) return;\n                    \n                    const days = parseInt($('#trip_days').val()) || 1;\n                    const start = new Date(startDate);\n                    \n                    for (let i = 0; i < days; i++) {\n                        const dayDate = new Date(start);\n                        dayDate.setDate(start.getDate() + i);\n                        \n                        const dateStr = dayDate.toLocaleDateString('zh-TW', {\n                            month: 'short',\n                            day: 'numeric',\n                            weekday: 'short'\n                        });\n                        \n                        $(`#day-date-${i}`).text(dateStr);\n                    }\n                },\n                \n                \/\/ \u66f4\u65b0Radio\u6a23\u5f0f\n                updateRadioStyles() {\n                    $('.radio-item input[type=\"radio\"]:checked').closest('.radio-item').addClass('selected');\n                },\n                \n                \/\/ \u9632\u6296\u8a08\u7b97\n                debouncedCalc() {\n                    clearTimeout(this.state.calcTimeout);\n                    this.state.calcTimeout = setTimeout(() => this.calculatePrice(), 500);\n                },\n                \n                \/\/ \u8a08\u7b97\u50f9\u683c\n                calculatePrice() {\n                    \/\/ \u6536\u96c6\u6bcf\u65e5\u884c\u7a0b\u8cc7\u6599\n                    const tripDays = parseInt($('#trip_days').val()) || 1;\n                    const dailyRoutes = [];\n                    \n                    for (let i = 0; i < tripDays; i++) {\n                        const stops = [];\n                        $(`#stops-container-${i} .stop-input`).each(function() {\n                            const val = $(this).val().trim();\n                            if (val) stops.push(val);\n                        });\n                        \n                        dailyRoutes.push({\n                            origin: $(`#origin_${i}`).val() || '',\n                            destination: $(`#destination_${i}`).val() || '',\n                            stops: stops\n                        });\n                    }\n                    \n                    \/\/ \u986f\u793a\u8f09\u5165\u4e2d\n                    $('#price-panel .price-content').html('<div class=\"price-loading\">\u8a08\u7b97\u4e2d...<\/div>');\n                    \n                    \/\/ AJAX \u8acb\u6c42\n                    const formData = $('#charter-booking-form').serialize();\n                    $.post(CONFIG.ajaxUrl, \n                        formData + '&action=calculate_charter_price&daily_routes=' + \n                        encodeURIComponent(JSON.stringify(dailyRoutes))\n                    ).done(response => {\n                        if (response?.success && response.data) {\n                            this.displayPrice(response.data);\n                            this.state.lastTotalPrice = response.data.total;\n                            this.state.mountainDetection = response.data.breakdown.mountain_detection || {};\n                        } else {\n                            $('#price-panel .price-content').html('<div>\u8a08\u7b97\u5931\u6557<\/div>');\n                        }\n                    }).fail(() => {\n                        $('#price-panel .price-content').html('<div>\u7cfb\u7d71\u932f\u8aa4<\/div>');\n                    });\n                },\n                \n                \/\/ \u986f\u793a\u50f9\u683c\n                displayPrice(data) {\n                    const breakdown = data.breakdown || {};\n                    let html = '';\n                    \n                    \/\/ \u57fa\u672c\u8cbb\u7528\n                    if (breakdown.base_price > 0) {\n                        html += `\n                            <div class=\"price-item\">\n                                <span>\u57fa\u672c\u8cbb\u7528 (${data.trip_days}\u5929)<\/span>\n                                <span>NT$ ${breakdown.base_price.toLocaleString()}<\/span>\n                            <\/div>\n                        `;\n                        \n                        \/\/ \u6bcf\u65e5\u8cbb\u7387\u7d30\u7bc0\n                        if (breakdown.daily_rates) {\n                            Object.entries(breakdown.daily_rates).forEach(([day, rate]) => {\n                                html += `\n                                    <div class=\"price-item detail\">\n                                        <span>Day ${day}<\/span>\n                                        <span>NT$ ${rate.toLocaleString()}<\/span>\n                                    <\/div>\n                                `;\n                            });\n                        }\n                        \n                        \/\/ \u5730\u5340\u50f9\u683c\u5dee\u7570\n                        if (breakdown.is_south) {\n                            html += `\n                                <div class=\"price-region south\">\n                                    \u5609\u7fa9\u4ee5\u5357\/\u82b1\u6771 NT$14,000\/\u65e5\n                                <\/div>\n                            `;\n                        } else {\n                            html += `\n                                <div class=\"price-region\">\n                                    \u5609\u7fa9\u4ee5\u5317\/\u5b9c\u862d NT$12,000\/\u65e5\n                                <\/div>\n                            `;\n                        }\n                        \n                        \/\/ \u986f\u793a\u5075\u6e2c\u5230\u7684\u5730\u5340\n                        if (breakdown.detected_areas && breakdown.detected_areas.length > 0) {\n                            const areas = [...new Set(breakdown.detected_areas)].join('\u3001');\n                            html += `\n                                <div class=\"price-item detail\" style=\"font-size: 12px; color: #6b7280;\">\n                                    <span>\u5075\u6e2c\u5730\u5340\uff1a${areas}<\/span>\n                                    <span><\/span>\n                                <\/div>\n                            `;\n                        }\n                    }\n                    \n                    \/\/ \u5c71\u5340\u52a0\u50f9\n                    if (breakdown.mountain_surcharge > 0 && breakdown.mountain_days && breakdown.mountain_days.length > 0) {\n                        html += `\n                            <div class=\"price-item mountain\">\n                                <span>\u26f0\ufe0f \u5c71\u5340\u670d\u52d9\u8cbb<\/span>\n                                <span>NT$ ${breakdown.mountain_surcharge.toLocaleString()}<\/span>\n                            <\/div>\n                        `;\n                        \n                        breakdown.mountain_days.forEach(function(mountain) {\n                            html += `\n                                <div class=\"price-item detail\">\n                                    <span>Day ${mountain.day} \u5c71\u5340\u884c\u7a0b<\/span>\n                                    <span>\u6d77\u62d4 ${mountain.elevation}\u516c\u5c3a<\/span>\n                                <\/div>\n                            `;\n                            \n                            \/\/ \u986f\u793a\u5c71\u5340\u5730\u9ede\n                            if (mountain.area && mountain.area.length > 0) {\n                                const areas = mountain.area.length > 3 \n                                    ? mountain.area.slice(0, 3).join('\u3001') + '...'\n                                    : mountain.area.join('\u3001');\n                                    \n                                html += `\n                                    <div class=\"price-item detail\">\n                                        <span style=\"font-size: 12px; color: #92400e;\">\n                                            \u5c71\u5340\u5730\u9ede\uff1a${areas}\n                                        <\/span>\n                                        <span><\/span>\n                                    <\/div>\n                                `;\n                            }\n                        });\n                    }\n                    \n                    \/\/ \u53f8\u6a5f\u88dc\u8cbc\n                    if (breakdown.driver_allowance > 0) {\n                        html += `\n                            <div class=\"price-item\">\n                                <span>\u53f8\u6a5f\u88dc\u8cbc<\/span>\n                                <span>NT$ ${breakdown.driver_allowance.toLocaleString()}<\/span>\n                            <\/div>\n                        `;\n                        \n                        if (breakdown.driver_accommodation > 0) {\n                            html += `\n                                <div class=\"price-item detail\">\n                                    <span>\u4f4f\u5bbf\u4ee3\u8a02 (${data.trip_days - 1}\u665a)<\/span>\n                                    <span>NT$ ${breakdown.driver_accommodation.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                        \n                        if (breakdown.driver_meals > 0) {\n                            html += `\n                                <div class=\"price-item detail\">\n                                    <span>\u9910\u8cbb\u88dc\u8cbc (${data.trip_days}\u65e5)<\/span>\n                                    <span>NT$ ${breakdown.driver_meals.toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                    }\n                    \n                    \/\/ \u52a0\u8cfc\u9805\u76ee\n                    if (breakdown.addon_charge > 0) {\n                        html += `\n                            <div class=\"price-item\">\n                                <span>\u52a0\u8cfc\u9805\u76ee<\/span>\n                                <span>NT$ ${breakdown.addon_charge.toLocaleString()}<\/span>\n                            <\/div>\n                        `;\n                        \n                        const childSeats = parseInt($('#child_seats').val()) || 0;\n                        const boosterSeats = parseInt($('#booster_seats').val()) || 0;\n                        \n                        if (childSeats > 0) {\n                            html += `\n                                <div class=\"price-item detail\">\n                                    <span>\u5b30\u5152\u5ea7\u6905 x${childSeats}<\/span>\n                                    <span>NT$ ${(childSeats * 100).toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                        \n                        if (boosterSeats > 0) {\n                            html += `\n                                <div class=\"price-item detail\">\n                                    <span>\u589e\u9ad8\u588a x${boosterSeats}<\/span>\n                                    <span>NT$ ${(boosterSeats * 100).toLocaleString()}<\/span>\n                                <\/div>\n                            `;\n                        }\n                    }\n                    \n                    \/\/ \u7e3d\u8a08 - \u7c21\u5316\u6587\u5b57\n                    html += `\n                        <div class=\"price-total\">\n                            <span>\u7e3d\u8a08(\u542b\u7a05)<\/span>\n                            <span>NT$ ${(data.total || 0).toLocaleString()}<\/span>\n                        <\/div>\n                    `;\n                    \n                    \/\/ \u8a02\u91d1\u8cc7\u8a0a\n                    if (data.deposit && data.balance) {\n                        html += `\n                            <div class=\"deposit-info\">\n                                <div class=\"deposit-item\">\n                                    <span>\u8a02\u91d1 (30%)<\/span>\n                                    <span style=\"color: var(--danger); font-weight: bold;\">\n                                        NT$ ${data.deposit.toLocaleString()}\n                                    <\/span>\n                                <\/div>\n                                <div class=\"deposit-item\">\n                                    <span>\u5c3e\u6b3e (70%)<\/span>\n                                    <span>NT$ ${data.balance.toLocaleString()}<\/span>\n                                <\/div>\n                            <\/div>\n                        `;\n                    }\n                    \n                    \/\/ \u63d0\u9192\u4e8b\u9805\n                    if (breakdown.mountain_needs_check) {\n                        html += `\n                            <div class=\"notice-box\">\n                                <strong>\u63d0\u9192\uff1a<\/strong>\u60a8\u7684\u884c\u7a0b\u53ef\u80fd\u5305\u542b\u5c71\u5340\u8def\u7dda\uff0c\n                                \u6211\u5011\u5c07\u5728\u78ba\u8a8d\u5f8c\u544a\u77e5\u662f\u5426\u9700\u8981\u984d\u5916\u7684\u5c71\u5340\u670d\u52d9\u8cbb\u3002\n                            <\/div>\n                        `;\n                    }\n                    \n                    $('#price-panel .price-content').html(html);\n                },\n                \n                \/\/ \u7d81\u5b9a\u4e8b\u4ef6\n                bindEvents() {\n                    const self = this;\n                    \n                    \/\/ \u4f7f\u7528\u4e8b\u4ef6\u59d4\u6d3e\u6e1b\u5c11\u7d81\u5b9a\u6578\u91cf\n                    $(document)\n                        \/\/ \u8868\u55ae\u6b04\u4f4d\u8b8a\u66f4\n                        .on('change', '#trip_days', () => {\n                            self.state.tripDays = parseInt($('#trip_days').val());\n                            self.updateDailyRoutes();\n                            self.updateDriverSection();\n                            self.debouncedCalc();\n                        })\n                        .on('change', '#start_date', () => {\n                            self.updateDayDates();\n                            self.debouncedCalc();\n                        })\n                        .on('change', '#passengers, #child_seats, #booster_seats, [name^=\"driver_\"]', () => {\n                            self.debouncedCalc();\n                        })\n                        \n                        \/\/ \u505c\u9760\u9ede\u64cd\u4f5c\n                        .on('click', '.btn-add-stop', function() {\n                            self.addStop($(this).data('day'));\n                        })\n                        .on('click', '.stop-btn', function() {\n                            const $btn = $(this);\n                            const action = $btn.data('action');\n                            const dayIndex = $btn.data('day');\n                            const $item = $btn.closest('.stop-item');\n                            const itemIndex = $item.index();\n                            \n                            if (action === 'delete') {\n                                $item.fadeOut(200, function() {\n                                    $(this).remove();\n                                    self.updateStopButtons(dayIndex);\n                                    self.debouncedCalc();\n                                });\n                            } else if (action === 'up' && itemIndex > 0) {\n                                $item.insertBefore($item.prev());\n                                self.updateStopButtons(dayIndex);\n                                self.debouncedCalc();\n                            } else if (action === 'down' && itemIndex < $item.siblings().length) {\n                                $item.insertAfter($item.next());\n                                self.updateStopButtons(dayIndex);\n                                self.debouncedCalc();\n                            }\n                        })\n                        \n                        \/\/ Radio \u6a23\u5f0f\n                        .on('change', '.radio-item input[type=\"radio\"]', function() {\n                            const name = $(this).attr('name');\n                            $(`.radio-item input[name=\"${name}\"]`).closest('.radio-item').removeClass('selected');\n                            $(this).closest('.radio-item').addClass('selected');\n                        });\n                    \n                    \/\/ \u8868\u55ae\u63d0\u4ea4\n                    $('#charter-booking-form').on('submit', function(e) {\n                        e.preventDefault();\n                        self.submitBooking();\n                    });\n                },\n                \n                \/\/ \u63d0\u4ea4\u9810\u7d04\n                submitBooking() {\n                    if (this.state.isSubmitting) return;\n                    \n                    \/\/ \u9a57\u8b49\u8868\u55ae\n                    const form = $('#charter-booking-form')[0];\n                    if (!form.checkValidity()) {\n                        form.reportValidity();\n                        return;\n                    }\n                    \n                    \/\/ \u6aa2\u67e5\u6392\u9664\u5730\u5740\n                    if ($('.excluded-alert.show').length > 0) {\n                        alert('\u60a8\u7684\u884c\u7a0b\u5305\u542b\u4e0d\u63d0\u4f9b\u670d\u52d9\u7684\u5730\u5340\uff0c\u8acb\u4fee\u6539\u5f8c\u518d\u63d0\u4ea4\u3002');\n                        return;\n                    }\n                    \n                    this.state.isSubmitting = true;\n                    $('.btn-submit').prop('disabled', true).html('<span class=\"spinner\"><\/span> \u8655\u7406\u4e2d...');\n                    \n                    \/\/ \u6536\u96c6\u8cc7\u6599\n                    const tripDays = parseInt($('#trip_days').val()) || 1;\n                    const dailyRoutes = [];\n                    \n                    for (let i = 0; i < tripDays; i++) {\n                        const stops = [];\n                        $(`#stops-container-${i} .stop-input`).each(function() {\n                            const val = $(this).val().trim();\n                            if (val) stops.push(val);\n                        });\n                        \n                        dailyRoutes.push({\n                            origin: $(`#origin_${i}`).val() || '',\n                            destination: $(`#destination_${i}`).val() || '',\n                            stops: stops\n                        });\n                    }\n                    \n                    \/\/ \u63d0\u4ea4\n                    const formData = $('#charter-booking-form').serialize();\n                    $.post(CONFIG.ajaxUrl,\n                        formData + \n                        '&action=submit_charter_booking' +\n                        '&daily_routes=' + encodeURIComponent(JSON.stringify(dailyRoutes)) +\n                        '&total_price=' + this.state.lastTotalPrice +\n                        '&deposit=' + Math.round(this.state.lastTotalPrice * 0.3) +\n                        '&mountain_detection=' + encodeURIComponent(JSON.stringify(this.state.mountainDetection))\n                    ).done(res => {\n                        if (res?.success) {\n                            let message = res.data?.message || '\u9810\u7d04\u6210\u529f\uff01\u8acb\u7acb\u5373\u652f\u4ed8\u8a02\u91d1\uff0c\u6211\u5011\u5c07\u572824\u5c0f\u6642\u5167\u8207\u60a8\u806f\u7e6b\u78ba\u8a8d\u3002';\n                            \n                            if (!$('#customer_email').val()) {\n                                message += '\\n\\n\u63d0\u9192\uff1a\u60a8\u672a\u586b\u5beb Email\uff0c\u5c07\u7121\u6cd5\u6536\u5230\u9810\u7d04\u78ba\u8a8d\u4fe1\u3002';\n                            }\n                            \n                            alert(message);\n                            \n                            \/\/ \u91cd\u7f6e\u8868\u55ae\n                            form.reset();\n                            this.state = {\n                                tripDays: 1,\n                                dailyRoutes: [],\n                                isSubmitting: false,\n                                lastTotalPrice: 0,\n                                calcTimeout: null,\n                                mountainDetection: {}\n                            };\n                            this.updateDailyRoutes();\n                            this.updateDriverSection();\n                            this.calculatePrice();\n                        } else {\n                            alert(res?.data?.message || '\u9810\u7d04\u5931\u6557\uff0c\u8acb\u6aa2\u67e5\u6240\u6709\u5fc5\u586b\u6b04\u4f4d');\n                        }\n                    }).fail(() => {\n                        alert('\u7cfb\u7d71\u932f\u8aa4\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66');\n                    }).always(() => {\n                        this.state.isSubmitting = false;\n                        $('.btn-submit').prop('disabled', false).text('\u63d0\u4ea4\u9810\u7d04');\n                    });\n                }\n            };\n            \n            \/\/ \u521d\u59cb\u5316\n            if (CharterBooking.init()) {\n                console.log('\u2705 \u5305\u8eca\u65c5\u904a\u7cfb\u7d71 V6 \u5df2\u555f\u52d5');\n            }\n        });\n        \n    })(jQuery);\n    <\/script>\n    \n    <?php\n}, 100);","scope":"front-end","active":true,"priority":11,"modified":"2025-09-12 15:54:05","revision":"1"}]}